import{p as N,g as m,i as I,j as G,c as d,o as u,b as e,a as l,t as a,s as O,v as P,x as q,w as v,f as n,n as R,F as J,r as K,e as j,W as T}from"./app-Xu1-QTPS.js";import{_ as p}from"./PrimaryButton-CQvisOOW.js";import{_ as A}from"./SecondaryButton-B4_LijSy.js";import{M as B}from"./Modal-CsHRj0Ox.js";import{S as Q}from"./SelectInput-C0-STkNZ.js";import{_ as c}from"./InputLabel-BxIgZQZ8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"space-y-6"},Y={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Z={class:"bg-white shadow rounded-lg border border-gray-200 p-6"},ee={class:"flex items-center"},te={class:"ml-4"},se={class:"text-2xl font-semibold text-gray-900"},ae={class:"bg-white shadow rounded-lg border border-gray-200 p-6"},le={class:"flex items-center"},oe={class:"ml-4"},re={class:"text-2xl font-semibold text-gray-900"},ie={class:"bg-white shadow rounded-lg border border-gray-200 p-6"},ne={class:"flex items-center"},de={class:"ml-4"},ue={class:"text-2xl font-semibold text-gray-900"},ve={class:"bg-white shadow rounded-lg border border-gray-200"},ce={class:"px-6 py-4"},me={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},xe={class:"flex items-end"},ge={key:0},fe={key:1},he={class:"bg-white shadow rounded-lg border border-gray-200"},pe={class:"px-6 py-4 border-b border-gray-200"},ye={class:"flex items-center justify-between"},_e={class:"text-sm text-gray-600"},be={class:"px-6 py-4"},we={class:"flex space-x-4 mb-4"},ke={key:0,class:"text-center py-8"},Ce={key:1,class:"text-center py-8 text-gray-500"},Me={class:"mt-2 text-sm font-medium text-gray-900"},De={class:"mt-1 text-sm text-gray-500"},Ve={key:2,class:"space-y-3"},je={class:"flex items-center space-x-4 flex-1"},Ae={class:"flex-1 min-w-0"},$e={class:"flex items-center space-x-2"},Se={class:"font-medium text-gray-900 truncate"},Be={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800"},Ne={class:"mt-1 space-y-1"},Re={key:0,class:"text-sm text-gray-600"},Te={class:"font-medium capitalize"},We={key:1,class:"text-sm text-gray-600"},ze={key:2,class:"text-sm text-gray-600"},He={class:"flex items-center space-x-4 text-xs text-gray-500"},Ee={class:"flex space-x-2"},Fe={class:"p-4"},Le={class:"mt-3 text-center"},Ue={class:"mt-2 text-sm text-gray-500"},Ie={class:"mt-4 flex justify-center space-x-3"},Ge={class:"p-4"},Oe={class:"mt-3 text-center"},Pe={class:"text-lg font-medium text-gray-900"},qe={class:"mt-2 text-sm text-gray-500"},Je={class:"mt-4 flex justify-center space-x-3"},Ke={class:"p-4"},Qe={class:"flex items-center justify-between mb-3"},Xe={class:"text-lg font-medium text-gray-900"},Ye={key:0,class:"space-y-3"},Ze={key:0,class:"grid grid-cols-2 gap-3 text-sm"},et={class:"mt-1 text-gray-900 font-mono"},tt={class:"mt-1 text-gray-900 capitalize"},st={class:"mt-1 text-gray-900"},at={class:"mt-1 text-gray-900"},lt={class:"col-span-2"},ot={class:"mt-1 text-gray-900"},rt={class:"mt-1 text-gray-900 text-xs"},it={class:"mt-1 text-gray-900 text-xs"},nt={key:1,class:"grid grid-cols-2 gap-3 text-sm"},dt={class:"mt-1 text-gray-900 font-mono"},ut={class:"mt-1 text-gray-900"},vt={class:"col-span-2"},ct={class:"mt-1 text-gray-900"},mt={class:"mt-1 text-gray-900 text-xs"},xt={class:"mt-1 text-gray-900 text-xs"},gt={class:"flex justify-end space-x-2 pt-3 border-t"},Ct={__name:"ArchiveSection",setup(ft){const f=N({archive_type:"manifests",older_than_days:30}),C=m(!1),$=m(!1),r=m("manifests"),h=m([]),k=m(!1),y=m(!1),_=m(!1),i=m(null),x=m(null),g=N({total:0,manifests:0,waybills:0}),W=I(()=>[{value:"manifests",label:"Manifests"},{value:"waybills",label:"Waybills"}]),z=()=>{C.value=!0,k.value=!1,T.post("/admin/utilities/archive",f,{preserveScroll:!0,onFinish:()=>{C.value=!1,M(r.value),S()}})},H=o=>{x.value=o,y.value=!0},E=o=>{x.value=o,_.value=!1,y.value=!0},F=async()=>{if(!x.value)return;const o=x.value.id;y.value=!1,await L(o),x.value=null},L=o=>{T.patch("/admin/utilities/archive",{archive_type:r.value,id:o,action:"restore"},{preserveScroll:!0,onSuccess:()=>{h.value=h.value.filter(t=>t.id!==o),S()},onError:t=>{alert("Failed to restore record: "+(t.message||"Unknown error"))}})},M=async o=>{r.value=o,$.value=!0;try{const t=await fetch(`/admin/utilities/archive/data?archive_type=${o}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.json();if(s.error)throw new Error(s.error);h.value=s.archivedData||[]}catch(t){console.error("Error loading archived data:",t),h.value=[]}finally{$.value=!1}},S=async()=>{var o,t;try{const[s,w]=await Promise.all([fetch("/admin/utilities/archive/data?archive_type=manifests"),fetch("/admin/utilities/archive/data?archive_type=waybills")]),D=await s.json(),V=await w.json();g.manifests=((o=D.archivedData)==null?void 0:o.length)||0,g.waybills=((t=V.archivedData)==null?void 0:t.length)||0,g.total=g.manifests+g.waybills}catch(s){console.error("Error loading statistics:",s)}},U=o=>{i.value=o,_.value=!0},b=o=>o?new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Unknown date";return G(()=>{M("manifests"),S()}),(o,t)=>(u(),d("div",X,[e("div",Y,[e("div",Z,[e("div",ee,[t[14]||(t[14]=e("div",{class:"flex-shrink-0 p-3 bg-blue-100 rounded-lg"},[e("svg",{class:"h-6 w-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),e("div",te,[t[13]||(t[13]=e("p",{class:"text-sm font-medium text-gray-500"},"Total Archived",-1)),e("p",se,a(g.total),1)])])]),e("div",ae,[e("div",le,[t[16]||(t[16]=e("div",{class:"flex-shrink-0 p-3 bg-orange-100 rounded-lg"},[e("svg",{class:"h-6 w-6 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"})])],-1)),e("div",oe,[t[15]||(t[15]=e("p",{class:"text-sm font-medium text-gray-500"},"Manifests",-1)),e("p",re,a(g.manifests),1)])])]),e("div",ie,[e("div",ne,[t[18]||(t[18]=e("div",{class:"flex-shrink-0 p-3 bg-green-100 rounded-lg"},[e("svg",{class:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),e("div",de,[t[17]||(t[17]=e("p",{class:"text-sm font-medium text-gray-500"},"Waybills",-1)),e("p",ue,a(g.waybills),1)])])])]),e("div",ve,[t[19]||(t[19]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h3",{class:"text-lg font-medium text-gray-900"},"Archive Data"),e("p",{class:"mt-1 text-sm text-gray-500"}," Archive old manifests and waybills to keep your active records clean ")],-1)),e("div",ce,[e("form",{onSubmit:t[2]||(t[2]=O(s=>k.value=!0,["prevent"])),class:"space-y-4"},[e("div",me,[e("div",null,[l(c,{value:"",class:"mb-2"}),l(Q,{modelValue:f.archive_type,"onUpdate:modelValue":t[0]||(t[0]=s=>f.archive_type=s),options:W.value,"option-value":"value","option-label":"label",placeholder:"Select data type",class:"w-full"},null,8,["modelValue","options"])]),e("div",null,[l(c,{value:"Older Than (days)",class:"mb-2"}),P(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>f.older_than_days=s),type:"number",min:"1",class:"w-full rounded-md border border-gray-300 px-3 py-2 focus:border-green-500 focus:ring-1 focus:ring-green-500",required:""},null,512),[[q,f.older_than_days,void 0,{number:!0}]])]),e("div",xe,[l(p,{type:"submit",disabled:C.value,class:"w-full justify-center"},{default:v(()=>[C.value?(u(),d("span",ge,"Archiving...")):(u(),d("span",fe,"Archive Data"))]),_:1},8,["disabled"])])])],32)])]),e("div",he,[e("div",pe,[e("div",ye,[t[20]||(t[20]=e("div",null,[e("h3",{class:"text-lg font-medium text-gray-900"},"Archived Data"),e("p",{class:"mt-1 text-sm text-gray-500"}," View and manage archived records ")],-1)),e("div",_e," Showing "+a(h.value.length)+" "+a(r.value),1)])]),e("div",be,[e("div",we,[l(p,{onClick:t[3]||(t[3]=s=>M("manifests")),class:R([r.value==="manifests"?"bg-green-600 hover:bg-green-700":"bg-gray-600 hover:bg-gray-700"])},{default:v(()=>t[21]||(t[21]=[n(" Manifests ")])),_:1},8,["class"]),l(p,{onClick:t[4]||(t[4]=s=>M("waybills")),class:R([r.value==="waybills"?"bg-green-600 hover:bg-green-700":"bg-gray-600 hover:bg-gray-700"])},{default:v(()=>t[22]||(t[22]=[n(" Waybills ")])),_:1},8,["class"])]),$.value?(u(),d("div",ke,t[23]||(t[23]=[e("svg",{class:"animate-spin mx-auto h-6 w-6 text-green-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),e("p",{class:"mt-2 text-sm text-gray-500"},"Loading archived data...",-1)]))):h.value.length===0?(u(),d("div",Ce,[t[24]||(t[24]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("h3",Me,"No archived "+a(r.value)+" found",1),e("p",De," Archived "+a(r.value)+" will appear here. ",1)])):(u(),d("div",Ve,[(u(!0),d(J,null,K(h.value,s=>(u(),d("div",{key:s.id,class:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-green-50 transition-colors group"},[e("div",je,[t[26]||(t[26]=e("div",{class:"flex-shrink-0 p-2 bg-blue-100 rounded-lg group-hover:bg-green-100 transition-colors"},[e("svg",{class:"h-5 w-5 text-blue-600 group-hover:text-green-600 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})])],-1)),e("div",Ae,[e("div",$e,[e("h4",Se,a(r.value==="manifests"?s.manifest_number:s.waybill_number),1),e("span",Be,a(r.value.slice(0,-1)),1)]),e("div",Ne,[r.value==="manifests"?(u(),d("p",Re,[t[25]||(t[25]=n(" Status: ")),e("span",Te,a(s.status),1)])):j("",!0),r.value==="manifests"&&s.driver?(u(),d("p",We," Driver: "+a(s.driver.name),1)):j("",!0),r.value==="waybills"&&s.generator?(u(),d("p",ze," Generated by: "+a(s.generator.name),1)):j("",!0),e("div",He,[e("span",null,"Created: "+a(b(s.created_at)),1),e("span",null,"Archived: "+a(b(s.archived_at)),1)])])])]),e("div",Ee,[l(A,{onClick:w=>U(s),class:"text-sm"},{default:v(()=>t[27]||(t[27]=[n(" View Details ")])),_:2},1032,["onClick"]),l(p,{onClick:w=>H(s),class:"bg-green-600 hover:bg-green-700 text-sm"},{default:v(()=>t[28]||(t[28]=[n(" Restore ")])),_:2},1032,["onClick"])])]))),128))]))])]),l(B,{show:k.value,onClose:t[6]||(t[6]=s=>k.value=!1),maxWidth:"sm"},{default:v(()=>[e("div",Fe,[t[33]||(t[33]=e("div",{class:"flex items-center justify-center w-12 h-12 mx-auto bg-yellow-100 rounded-full"},[e("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",Le,[t[30]||(t[30]=e("h3",{class:"text-lg font-medium text-gray-900"},"Archive Data",-1)),e("p",Ue,[n(" Are you sure you want to archive "+a(f.archive_type)+" older than ",1),e("strong",null,a(f.older_than_days)+" days",1),t[29]||(t[29]=n("? "))])]),e("div",Ie,[l(A,{onClick:t[5]||(t[5]=s=>k.value=!1)},{default:v(()=>t[31]||(t[31]=[n(" Cancel ")])),_:1}),l(p,{onClick:z,class:"bg-green-600 hover:bg-green-700"},{default:v(()=>t[32]||(t[32]=[n(" Confirm Archive ")])),_:1})])])]),_:1},8,["show"]),l(B,{show:y.value,onClose:t[8]||(t[8]=s=>y.value=!1),maxWidth:"sm"},{default:v(()=>[e("div",Ge,[t[38]||(t[38]=e("div",{class:"flex items-center justify-center w-12 h-12 mx-auto bg-blue-100 rounded-full"},[e("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])],-1)),e("div",Oe,[e("h3",Pe,"Restore "+a(r.value.slice(0,-1)),1),e("p",qe,[t[34]||(t[34]=n(" Are you sure you want to restore ")),e("strong",null,a(x.value?r.value==="manifests"?x.value.manifest_number:x.value.waybill_number:""),1),t[35]||(t[35]=n("? "))])]),e("div",Je,[l(A,{onClick:t[7]||(t[7]=s=>y.value=!1)},{default:v(()=>t[36]||(t[36]=[n(" Cancel ")])),_:1}),l(p,{onClick:F,class:"bg-green-600 hover:bg-green-700"},{default:v(()=>t[37]||(t[37]=[n(" Confirm Restore ")])),_:1})])])]),_:1},8,["show"]),l(B,{show:_.value,onClose:t[12]||(t[12]=s=>_.value=!1),maxWidth:"lg"},{default:v(()=>{var s,w,D;return[e("div",Ke,[e("div",Qe,[e("h3",Xe,a(i.value?r.value==="manifests"?"Manifest Details":"Waybill Details":""),1),e("button",{onClick:t[9]||(t[9]=V=>_.value=!1),class:"text-gray-400 hover:text-gray-500"},t[39]||(t[39]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),i.value?(u(),d("div",Ye,[r.value==="manifests"?(u(),d("div",Ze,[e("div",null,[l(c,{value:"Manifest Number",class:"text-xs"}),e("p",et,a(i.value.manifest_number),1)]),e("div",null,[l(c,{value:"Status",class:"text-xs"}),e("p",tt,a(i.value.status),1)]),e("div",null,[l(c,{value:"Driver",class:"text-xs"}),e("p",st,a(((s=i.value.driver)==null?void 0:s.name)||"Not assigned"),1)]),e("div",null,[l(c,{value:"Truck",class:"text-xs"}),e("p",at,a(((w=i.value.truck)==null?void 0:w.plate_number)||"Not assigned"),1)]),e("div",lt,[l(c,{value:"Notes",class:"text-xs"}),e("p",ot,a(i.value.notes||"No notes"),1)]),e("div",null,[l(c,{value:"Created",class:"text-xs"}),e("p",rt,a(b(i.value.created_at)),1)]),e("div",null,[l(c,{value:"Archived",class:"text-xs"}),e("p",it,a(b(i.value.archived_at)),1)])])):(u(),d("div",nt,[e("div",null,[l(c,{value:"Waybill Number",class:"text-xs"}),e("p",dt,a(i.value.waybill_number),1)]),e("div",null,[l(c,{value:"Generated By",class:"text-xs"}),e("p",ut,a(((D=i.value.generator)==null?void 0:D.name)||"System"),1)]),e("div",vt,[l(c,{value:"Notes",class:"text-xs"}),e("p",ct,a(i.value.notes||"No notes"),1)]),e("div",null,[l(c,{value:"Created",class:"text-xs"}),e("p",mt,a(b(i.value.created_at)),1)]),e("div",null,[l(c,{value:"Archived",class:"text-xs"}),e("p",xt,a(b(i.value.archived_at)),1)])])),e("div",gt,[l(A,{onClick:t[10]||(t[10]=V=>_.value=!1),class:"text-sm px-3 py-1"},{default:v(()=>t[40]||(t[40]=[n(" Close ")])),_:1}),l(p,{onClick:t[11]||(t[11]=V=>E(i.value)),class:"bg-green-600 hover:bg-green-700 text-sm px-3 py-1"},{default:v(()=>t[41]||(t[41]=[n(" Restore ")])),_:1})])])):j("",!0)])]}),_:1},8,["show"])]))}};export{Ct as default};
