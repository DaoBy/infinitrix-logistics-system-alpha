import{E as ee}from"./EmployeeLayout-B8SQYBgj.js";import{_ as B}from"./PrimaryButton-CBiTPJhk.js";import{_ as R}from"./SecondaryButton-BS-rbRq0.js";import{S as te}from"./SelectInput-DbD3HIzo.js";import{M as se}from"./Modal-CyMVj4bP.js";import{g as p,i as W,j as oe,d as le,o as v,w as i,b as e,a as n,c as x,t as l,f as a,F as re,r as ie,k as ae,n as ne,e as de,W as F,l as ue}from"./app-SYI-8bdC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./NavLink-D6cPZaLM.js";import"./DangerButton-CNs3xLhr.js";const ce={class:"flex justify-between items-center"},pe={class:"flex space-x-2"},me={class:"py-6"},ve={key:0,class:"flex justify-center items-center py-12"},fe={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6 text-center"},xe={class:"mt-1 text-sm text-red-600"},ge={key:2,class:"bg-white shadow-sm rounded-lg overflow-hidden"},ye={class:"px-6 py-12 text-center"},he={class:"mt-1 text-sm text-gray-500"},_e={class:"mt-6"},ke={key:3,class:"bg-white shadow-sm rounded-lg overflow-hidden"},be={class:"px-6 py-4 border-b border-gray-200 bg-purple-50"},we={class:"flex justify-between items-center"},Ce={class:"text-sm text-purple-700"},je={class:"flex space-x-2"},Me={class:"overflow-x-auto"},Be={class:"min-w-full divide-y divide-gray-200"},De={class:"bg-white divide-y divide-gray-200"},Ae={class:"px-6 py-4 whitespace-nowrap"},Le={class:"flex items-center"},Ee={class:"flex-shrink-0 h-10 w-10 bg-purple-100 rounded-full flex items-center justify-center"},Re={class:"text-purple-800 font-medium text-sm"},Fe={class:"ml-4"},$e={class:"text-sm font-medium text-gray-900"},Ne={class:"text-sm text-gray-500"},Ve={class:"px-6 py-4 whitespace-nowrap"},Se={class:"text-sm text-gray-900"},Te={class:"text-sm text-gray-500"},ze={class:"text-xs text-gray-400"},He={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ie={class:"font-medium text-purple-600"},Ue={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Oe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Pe={class:"text-xs text-gray-400"},We={class:"px-6 py-4 whitespace-nowrap text-sm"},qe={class:"flex items-center space-x-2"},Ge={class:"w-24 bg-gray-200 rounded-full h-2"},Je={class:"text-xs text-gray-600"},Ke={class:"text-xs text-gray-500 mt-1"},Qe={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Xe={class:"flex justify-end space-x-2"},Ye={class:"px-6 py-4 bg-gray-50 border-t border-gray-200"},Ze={class:"flex items-center justify-between text-sm text-gray-600"},et={key:0,class:"p-6"},tt={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},st={class:"bg-gray-50 rounded-lg p-4"},ot={class:"space-y-2 text-sm"},lt={class:"flex justify-between"},rt={class:"font-medium"},it={class:"flex justify-between"},at={class:"font-medium"},nt={class:"flex justify-between"},dt={class:"font-medium text-purple-600"},ut={class:"flex justify-between"},ct={class:"font-medium"},pt={class:"bg-gray-50 rounded-lg p-4"},mt={class:"space-y-2 text-sm"},vt={class:"flex justify-between"},ft={class:"font-medium"},xt={class:"flex justify-between"},gt={class:"font-medium"},yt={class:"flex justify-between"},ht={class:"font-medium"},_t={class:"flex justify-between"},kt={class:"font-medium"},bt={class:"bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6"},wt={class:"text-sm text-purple-700 space-y-1"},Ct={class:"text-xs text-purple-600 mt-2"},jt={class:"flex justify-end space-x-2"},Nt={__name:"BackhaulEligible",props:{assignments:{type:Array,default:()=>[]},regions:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})}},setup(q){const D=q,g=p(!1),$=p(!1),N=p(!1),d=p(null),A=p(!1),r=p(null),y=p(null),V=p(new Date().toLocaleTimeString()),h=p({region_id:D.filters.region_id||""}),G=W(()=>[{value:"",label:"All Regions"},...D.regions.map(s=>({value:s.id,label:s.name}))]),L=W(()=>D.assignments);function J(){F.get(route("driver-truck-assignments.backhaul-eligible.show"),h.value,{preserveState:!0,replace:!0,onStart:()=>g.value=!0,onFinish:()=>g.value=!1,onError:s=>{d.value="Failed to filter assignments",console.error("Filter error:",s)}})}async function S(){$.value=!0;try{await F.reload({only:["assignments"],onSuccess:()=>{V.value=new Date().toLocaleTimeString(),d.value=null},onError:s=>{d.value="Failed to refresh data",console.error("Refresh error:",s)}})}catch(s){d.value="Network error while refreshing",console.error("Refresh failed:",s)}finally{$.value=!1}}async function T(){g.value=!0,d.value=null;try{await F.reload({only:["assignments"],onError:s=>{d.value="Failed to load assignments",console.error("Load error:",s)}})}catch(s){d.value="Network error while loading data",console.error("Load failed:",s)}finally{g.value=!1}}async function z(s){y.value=s.id;try{F.visit(route("cargo-assignment.index",{driver_truck_assignment_id:s.id,region_id:s.current_region_id,assignment_type:"backhaul"}),{onError:t=>{alert("Failed to start backhaul assignment. Please try again."),console.error("Backhaul assignment error:",t)}})}catch(t){alert("Network error while starting backhaul assignment"),console.error("Backhaul assignment failed:",t)}finally{y.value=null}}function K(s){r.value=s,A.value=!0}async function Q(){N.value=!0;try{const s=await ue.post(route("driver-truck-assignments.backhaul-eligible.export"),{region_id:h.value.region_id},{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([s.data])),o=document.createElement("a");o.href=t,o.setAttribute("download",`backhaul-eligible-assignments-${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(t)}catch(s){alert("Failed to export data"),console.error("Export error:",s)}finally{N.value=!1}}function X(s){return s?s.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2):"??"}function H(s){return s?new Date(s).toLocaleString():"N/A"}function Y(s){if(!s)return"";const t=new Date(s),u=new Date-t,c=Math.floor(u/6e4),m=Math.floor(u/36e5),f=Math.floor(u/864e5);return c<1?"just now":c<60?`${c}m ago`:m<24?`${m}h ago`:`${f}d ago`}function _(s){if(!s||!s.volume_capacity)return 0;const t=s.current_volume||0;return Math.round(t/s.volume_capacity*100)}return oe(()=>{D.assignments.length===0&&T()}),(s,t)=>(v(),le(ee,null,{header:i(()=>[e("div",ce,[t[6]||(t[6]=e("div",null,[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Backhaul Eligible Assignments "),e("p",{class:"text-sm text-gray-600 mt-1"}," Driver-truck sets available for backhaul assignments ")],-1)),e("div",pe,[n(te,{modelValue:h.value.region_id,"onUpdate:modelValue":t[0]||(t[0]=o=>h.value.region_id=o),options:G.value,placeholder:"Filter by Region",class:"w-48",onChange:J},null,8,["modelValue","options"]),n(R,{onClick:t[1]||(t[1]=o=>s.$inertia.visit(s.route("driver-truck-assignments.index")))},{default:i(()=>t[5]||(t[5]=[a(" View All Assignments ")])),_:1})])])]),default:i(()=>[e("div",me,[g.value?(v(),x("div",ve,t[7]||(t[7]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"},null,-1)]))):d.value?(v(),x("div",fe,[t[9]||(t[9]=e("svg",{class:"mx-auto h-12 w-12 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)),t[10]||(t[10]=e("h3",{class:"mt-2 text-sm font-medium text-red-800"},"Failed to load assignments",-1)),e("p",xe,l(d.value),1),n(B,{onClick:T,class:"mt-4"},{default:i(()=>t[8]||(t[8]=[a(" Try Again ")])),_:1})])):L.value.length===0?(v(),x("div",ge,[e("div",ye,[t[12]||(t[12]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t[13]||(t[13]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No backhaul eligible assignments",-1)),e("p",he,l(h.value.region_id?"No backhaul eligible assignments found in this region.":"No driver-truck sets are currently available for backhaul assignments."),1),e("div",_e,[n(B,{onClick:S},{default:i(()=>t[11]||(t[11]=[a(" Refresh ")])),_:1})])])])):(v(),x("div",ke,[e("div",be,[e("div",we,[e("div",null,[t[14]||(t[14]=e("h3",{class:"text-lg font-medium text-purple-900"}," Available for Backhaul ",-1)),e("p",Ce,l(L.value.length)+" driver-truck set"+l(L.value.length!==1?"s":"")+" ready for backhaul assignments ",1)]),e("div",je,[n(R,{onClick:Q,loading:N.value},{default:i(()=>t[15]||(t[15]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),a(" Export ")])),_:1},8,["loading"]),n(B,{onClick:S,loading:$.value},{default:i(()=>t[16]||(t[16]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),a(" Refresh ")])),_:1},8,["loading"])])])]),e("div",Me,[e("table",Be,[t[22]||(t[22]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Driver"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Truck"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Current Region"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Home Region"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Eligible Since"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Truck Capacity"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",De,[(v(!0),x(re,null,ie(L.value,o=>{var u,c,m,f,k,b,w,C,j,M,E,I,U,O,P;return v(),x("tr",{key:o.id,class:"hover:bg-gray-50"},[e("td",Ae,[e("div",Le,[e("div",Ee,[e("span",Re,l(X((u=o.driver)==null?void 0:u.name)),1)]),e("div",Fe,[e("div",$e,l((c=o.driver)==null?void 0:c.name),1),e("div",Ne,l((f=(m=o.driver)==null?void 0:m.employee_profile)==null?void 0:f.employee_id),1),t[17]||(t[17]=e("div",{class:"text-xs text-purple-600 font-semibold mt-1"}," Backhaul Ready ",-1))])])]),e("td",Ve,[e("div",Se,l((k=o.truck)==null?void 0:k.license_plate),1),e("div",Te,l((b=o.truck)==null?void 0:b.make)+" "+l((w=o.truck)==null?void 0:w.model),1),e("div",ze,l((C=o.truck)==null?void 0:C.year)+" • "+l((M=(j=o.truck)==null?void 0:j.vin)==null?void 0:M.substring(0,8))+"... ",1)]),e("td",He,[e("span",Ie,l((E=o.current_region)==null?void 0:E.name),1),t[18]||(t[18]=e("div",{class:"text-xs text-gray-500 mt-1"}," Current Location ",-1))]),e("td",Ue,[a(l((I=o.region)==null?void 0:I.name)+" ",1),t[19]||(t[19]=e("div",{class:"text-xs text-gray-500 mt-1"}," Home Base ",-1))]),e("td",Oe,[e("div",null,l(H(o.backhaul_eligible_at)),1),e("div",Pe,l(Y(o.backhaul_eligible_at)),1)]),e("td",We,[e("div",qe,[e("div",Ge,[e("div",{class:ne(["bg-green-600 h-2 rounded-full",{"bg-yellow-500":_(o.truck)>60,"bg-red-500":_(o.truck)>85}]),style:ae({width:`${_(o.truck)}%`})},null,6)]),e("span",Je,l(_(o.truck))+"% ",1)]),e("div",Ke,l((O=(U=o.truck)==null?void 0:U.current_volume)==null?void 0:O.toFixed(1))+"m³ / "+l((P=o.truck)==null?void 0:P.volume_capacity)+"m³ ",1)]),e("td",Qe,[e("div",Xe,[n(R,{onClick:Z=>K(o),size:"xs",title:"View Details"},{default:i(()=>t[20]||(t[20]=[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])),_:2},1032,["onClick"]),n(B,{onClick:Z=>z(o),size:"xs",loading:y.value===o.id,disabled:y.value!==null},{default:i(()=>t[21]||(t[21]=[e("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),a(" Assign Backhaul ")])),_:2},1032,["onClick","loading","disabled"])])])])}),128))])])]),e("div",Ye,[e("div",Ze,[e("div",null," Last updated: "+l(V.value),1),t[23]||(t[23]=e("div",{class:"flex items-center space-x-4"},[e("span",{class:"flex items-center"},[e("div",{class:"w-3 h-3 bg-green-500 rounded-full mr-1"}),a(" Available (<60%) ")]),e("span",{class:"flex items-center"},[e("div",{class:"w-3 h-3 bg-yellow-500 rounded-full mr-1"}),a(" Moderate (60-85%) ")]),e("span",{class:"flex items-center"},[e("div",{class:"w-3 h-3 bg-red-500 rounded-full mr-1"}),a(" Limited (>85%) ")])],-1))])])]))]),n(se,{show:A.value,onClose:t[4]||(t[4]=o=>A.value=!1),"max-width":"2xl"},{default:i(()=>{var o,u,c,m,f,k,b,w,C,j,M;return[r.value?(v(),x("div",et,[t[40]||(t[40]=e("h2",{class:"text-xl font-semibold mb-4 text-gray-800"},"Assignment Details",-1)),e("div",tt,[e("div",st,[t[28]||(t[28]=e("h3",{class:"font-semibold text-gray-700 mb-3 border-b pb-2"},"Driver Information",-1)),e("div",ot,[e("div",lt,[t[24]||(t[24]=e("span",{class:"text-gray-500"},"Name:",-1)),e("span",rt,l((o=r.value.driver)==null?void 0:o.name),1)]),e("div",it,[t[25]||(t[25]=e("span",{class:"text-gray-500"},"Employee ID:",-1)),e("span",at,l((c=(u=r.value.driver)==null?void 0:u.employee_profile)==null?void 0:c.employee_id),1)]),e("div",nt,[t[26]||(t[26]=e("span",{class:"text-gray-500"},"Current Region:",-1)),e("span",dt,l((m=r.value.current_region)==null?void 0:m.name),1)]),e("div",ut,[t[27]||(t[27]=e("span",{class:"text-gray-500"},"Home Region:",-1)),e("span",ct,l((f=r.value.region)==null?void 0:f.name),1)])])]),e("div",pt,[t[33]||(t[33]=e("h3",{class:"font-semibold text-gray-700 mb-3 border-b pb-2"},"Truck Information",-1)),e("div",mt,[e("div",vt,[t[29]||(t[29]=e("span",{class:"text-gray-500"},"License Plate:",-1)),e("span",ft,l((k=r.value.truck)==null?void 0:k.license_plate),1)]),e("div",xt,[t[30]||(t[30]=e("span",{class:"text-gray-500"},"Make/Model:",-1)),e("span",gt,l((b=r.value.truck)==null?void 0:b.make)+" "+l((w=r.value.truck)==null?void 0:w.model),1)]),e("div",yt,[t[31]||(t[31]=e("span",{class:"text-gray-500"},"Capacity:",-1)),e("span",ht,l((C=r.value.truck)==null?void 0:C.volume_capacity)+"m³",1)]),e("div",_t,[t[32]||(t[32]=e("span",{class:"text-gray-500"},"Current Load:",-1)),e("span",kt,l((M=(j=r.value.truck)==null?void 0:j.current_volume)==null?void 0:M.toFixed(1))+"m³ ("+l(_(r.value.truck))+"%)",1)])])])]),e("div",bt,[t[37]||(t[37]=e("h3",{class:"font-semibold text-purple-800 mb-2"},"Backhaul Eligibility",-1)),e("div",wt,[t[34]||(t[34]=e("div",null,"✓ All packages delivered and verified",-1)),t[35]||(t[35]=e("div",null,"✓ Driver is away from home region",-1)),t[36]||(t[36]=e("div",null,"✓ Cooldown period completed",-1)),e("div",Ct," Eligible since: "+l(H(r.value.backhaul_eligible_at)),1)])]),e("div",jt,[n(R,{onClick:t[2]||(t[2]=E=>A.value=!1)},{default:i(()=>t[38]||(t[38]=[a(" Close ")])),_:1}),n(B,{onClick:t[3]||(t[3]=E=>z(r.value)),loading:y.value===r.value.id},{default:i(()=>t[39]||(t[39]=[a(" Assign Backhaul ")])),_:1},8,["loading"])])])):de("",!0)]}),_:1},8,["show"])]),_:1}))}};export{Nt as default};
