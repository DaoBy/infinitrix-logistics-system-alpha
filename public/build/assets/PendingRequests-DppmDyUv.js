import{g as c,i as j,h as re,W as f,d as ie,o as i,w as o,b as a,a as l,c as u,e as x,t as n,f as r,k as I,v as ue,L as de}from"./app-SYI-8bdC.js";import{E as ce}from"./EmployeeLayout-B8SQYBgj.js";import{_ as M}from"./PrimaryButton-CBiTPJhk.js";import{_ as q}from"./SecondaryButton-BS-rbRq0.js";import{D as $}from"./DangerButton-CNs3xLhr.js";import{P as pe}from"./Pagination-DOkO8BU-.js";import{_ as me}from"./SearchInput-CAeLERWr.js";import{S as U}from"./SelectInput-DbD3HIzo.js";import{_ as ve}from"./DataTable-CWybtFnL.js";import{_ as E}from"./InputLabel-B9o7tVDo.js";import{_ as fe}from"./TextArea-D6EdXTx9.js";import{M as z}from"./Modal-CyMVj4bP.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./NavLink-D6cPZaLM.js";const ye={class:"flex justify-between items-center w-full px-6 md:px-8"},ge={class:"flex gap-2"},he={class:"zoom-content"},xe={class:"px-6 py-4"},be={key:0,class:"mb-6"},ke={key:0,class:"p-4 bg-blue-100 text-blue-800 rounded"},we={key:1,class:"p-4 bg-green-100 text-green-800 rounded"},Re={key:2,class:"p-4 bg-red-100 text-red-800 rounded"},Ce={class:"mb-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2"},je={class:"flex flex-wrap gap-2 w-full md:w-auto"},Pe={class:"bg-white shadow-sm sm:rounded-lg"},Ae={class:"p-4 bg-white border-b border-gray-200"},Se={class:"font-mono text-sm text-gray-600"},qe={class:"flex items-center"},Ve={class:"text-gray-700"},Ne={class:"flex items-center"},Te={class:"text-gray-700"},De={class:"capitalize"},Me={key:0},$e={key:1},Ue={class:"flex space-x-2"},Oe={class:"mt-4 flex justify-center"},Le={class:"p-6"},Be={class:"mt-1 text-sm text-gray-600"},Fe={key:0,class:"mt-4"},Ie={class:"mt-2 text-sm text-gray-700"},Ee={class:"mt-6 flex justify-end space-x-4"},ze={key:0},We={key:1},Ge={class:"p-6"},Ye={class:"mt-1 text-sm text-gray-600"},He={class:"mt-4"},Je={key:0,class:"mt-4"},Ke={class:"mt-6 flex justify-end space-x-4"},Qe={key:0},Xe={key:1},Ze={__name:"PendingRequests",props:{requests:{type:Array,required:!0,default:()=>[]},pagination:{type:Object,default:()=>({current_page:1,last_page:1,links:[]})},filters:{type:Object,default:()=>({search:"",payment_method:"",date_range:"all"})},status:String,success:String,error:String},setup(m){const b=m,v=c(b.filters.search||""),k=c(b.filters.payment_method||""),P=c(b.filters.date_range||"all"),_=c("created_at"),A=c("desc"),V=c(!1),N=c(!1),d=c(null),w=c(null),y=c(!1),g=c(""),S=c(""),R=c(""),W=[{value:"",text:"All Payment Types"},{value:"prepaid",text:"Prepaid"},{value:"postpaid",text:"Postpaid"}],O=j(()=>{var s;return Number((s=b.pagination)==null?void 0:s.current_page)||1}),L=j(()=>{var s;return Number((s=b.pagination)==null?void 0:s.last_page)||1}),G=j(()=>{var s;return{current_page:O.value,last_page:L.value,links:((s=b.pagination)==null?void 0:s.links)||[]}}),Y=[{value:"",text:"All Methods"},{value:"cash",text:"Cash"},{value:"gcash",text:"GCash"},{value:"bank",text:"Bank Transfer"}],H=[{value:"all",text:"All Time"},{value:"today",text:"Today"},{value:"week",text:"This Week"},{value:"month",text:"This Month"},{value:"year",text:"This Year"}],J=[{field:"id",header:"Request ID",sortable:!0},{field:"receiver",header:"Receiver",sortable:!0},{field:"pick_up_region",header:"Pick-up",sortable:!0},{field:"drop_off_region",header:"Drop-off",sortable:!0},{field:"total_price",header:"Amount",sortable:!0},{field:"payment_method",header:"Payment Method",sortable:!0},{field:"payment_type",header:"Payment Type",sortable:!0},{field:"created_at",header:"Date",sortable:!0},{field:"payment_terms",header:"Payment Terms",sortable:!1},{field:"actions",header:"Actions",sortable:!1}],B=j(()=>(b.requests||[]).map(s=>({...s,payment_type:s.payment_type??(["cash","gcash","bank"].includes(s.payment_method)?"prepaid":"postpaid")}))),K=j(()=>B.value?B.value.filter(s=>{var h,C;const t=v.value===""||((h=s.sender)==null?void 0:h.toLowerCase().includes(v.value.toLowerCase()))||((C=s.receiver)==null?void 0:C.toLowerCase().includes(v.value.toLowerCase()))||s.id.toString().includes(v.value),e=k.value===""||s.payment_method===k.value,p=R.value===""||s.payment_type===R.value;return t&&e&&p}).sort((s,t)=>{if(!_.value)return 0;const e=A.value==="asc"?1:-1;return s[_.value]<t[_.value]?-1*e:s[_.value]>t[_.value]?1*e:0}):[]),F=j(()=>g.value==="other"?S.value.trim().length>0:g.value!=="");re([v,k,P,R],()=>{f.get(route("deliveries.pending"),{search:v.value,payment_method:k.value,date_range:P.value,payment_type:R.value,page:1},{preserveState:!0,replace:!0})});function Q(s){_.value===s?A.value=A.value==="asc"?"desc":"asc":(_.value=s,A.value="asc")}function X(s){f.get(route("deliveries.show",s))}function Z(s){f.get(route("deliveries.edit",s))}function ee(){f.get(route("deliveries.index"))}function te(){f.get(route("deliveries.rejected"))}function ae(s){f.get(route("deliveries.pending"),{page:s,search:v.value,payment_method:k.value,date_range:P.value},{preserveState:!0})}function se(s){d.value=s,V.value=!0}function T(){V.value=!1,d.value=null}function oe(s){w.value=s,N.value=!0}function D(){N.value=!1,w.value=null,g.value="",S.value=""}async function le(){if(d.value){y.value=!0;try{await f.post(route("deliveries.approve",d.value.id),{},{preserveScroll:!0,onSuccess:()=>{T(),f.reload({only:["requests","pagination","status","success","error"]})}})}catch{}finally{y.value=!1}}}async function ne(){if(!(!w.value||!F.value)){y.value=!0;try{const s=g.value==="other"?S.value:g.value;await f.post(route("deliveries.reject",w.value.id),{rejection_reason:s},{preserveScroll:!0,onSuccess:()=>{D()}})}catch(s){console.error("Rejection failed:",s)}finally{y.value=!1}}}return(s,t)=>(i(),ie(ce,null,{header:o(()=>[a("div",ye,[t[8]||(t[8]=a("div",null,[a("h2",{class:"text-xl font-semibold leading-tight text-gray-800"},"Pending Delivery Requests"),a("p",{class:"mt-1 text-sm text-gray-500"}," Review and manage pending delivery requests ")],-1)),a("div",ge,[l(q,{onClick:ee},{default:o(()=>t[6]||(t[6]=[r(" Approved Requests ")])),_:1}),l($,{onClick:te},{default:o(()=>t[7]||(t[7]=[r(" Rejected Requests ")])),_:1})])])]),default:o(()=>[a("div",he,[a("div",xe,[m.status||m.success||m.error?(i(),u("div",be,[m.status?(i(),u("div",ke,n(m.status),1)):x("",!0),m.success?(i(),u("div",we,n(m.success),1)):x("",!0),m.error?(i(),u("div",Re,n(m.error),1)):x("",!0)])):x("",!0),a("div",Ce,[l(me,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),placeholder:"Search requests...",class:"w-full max-w-md"},null,8,["modelValue"]),a("div",je,[l(U,{modelValue:R.value,"onUpdate:modelValue":t[1]||(t[1]=e=>R.value=e),options:W,"option-value":"value","option-label":"text",placeholder:"All Payment Types",class:"w-full md:w-48"},null,8,["modelValue"]),l(U,{modelValue:k.value,"onUpdate:modelValue":t[2]||(t[2]=e=>k.value=e),options:Y,"option-value":"value","option-label":"text",placeholder:"All Payment Methods",class:"w-full md:w-48"},null,8,["modelValue"]),l(U,{modelValue:P.value,"onUpdate:modelValue":t[3]||(t[3]=e=>P.value=e),options:H,"option-value":"value","option-label":"text",placeholder:"Filter by date",class:"w-full md:w-48"},null,8,["modelValue"])])]),a("div",Pe,[a("div",Ae,[l(ve,{columns:J,data:K.value,"sort-field":_.value,"sort-direction":A.value,onSort:Q,class:"w-full"},{id:o(({row:e})=>[a("span",Se,"DR-"+n(String(e.id).padStart(6,"0")),1)]),sender:o(({row:e})=>[r(n(e.sender),1)]),receiver:o(({row:e})=>[r(n(e.receiver),1)]),pick_up_region:o(({row:e})=>[a("div",qe,[e.pick_up_region&&e.pick_up_region_color?(i(),u("div",{key:0,class:"w-3 h-3 rounded-full mr-2 border border-gray-300",style:I({backgroundColor:e.pick_up_region_color})},null,4)):x("",!0),a("span",Ve,n(e.pick_up_region||"N/A"),1)])]),drop_off_region:o(({row:e})=>[a("div",Ne,[e.drop_off_region&&e.drop_off_region_color?(i(),u("div",{key:0,class:"w-3 h-3 rounded-full mr-2 border border-gray-300",style:I({backgroundColor:e.drop_off_region_color})},null,4)):x("",!0),a("span",Te,n(e.drop_off_region||"N/A"),1)])]),total_price:o(({row:e})=>[r(" â‚±"+n(e.total_price),1)]),payment_method:o(({row:e})=>[a("span",De,n(e.payment_method||"N/A"),1)]),payment_type:o(({row:e})=>[r(n(e.payment_type?e.payment_type.charAt(0).toUpperCase()+e.payment_type.slice(1):"N/A"),1)]),created_at:o(({row:e})=>[r(n(new Date(e.created_at).toLocaleDateString()),1)]),payment_terms:o(({row:e})=>[e.payment_terms?(i(),u("span",Me,n(e.payment_terms==="net_7"?"Net 7":e.payment_terms==="net_15"?"Net 15":e.payment_terms==="net_30"?"Net 30":e.payment_terms==="cnd"?"CND":e.payment_terms),1)):(i(),u("span",$e,"Only for Postpaid"))]),actions:o(({row:e})=>[a("div",Ue,[l(q,{onClick:p=>X(e.id)},{default:o(()=>t[9]||(t[9]=[r(" View ")])),_:2},1032,["onClick"]),l(M,{onClick:p=>Z(e.id)},{default:o(()=>t[10]||(t[10]=[r(" Edit ")])),_:2},1032,["onClick"]),l(M,{onClick:p=>se(e)},{default:o(()=>t[11]||(t[11]=[r(" Approve ")])),_:2},1032,["onClick"]),l($,{onClick:p=>oe(e)},{default:o(()=>t[12]||(t[12]=[r(" Reject ")])),_:2},1032,["onClick"])])]),_:1},8,["data","sort-field","sort-direction"])])]),a("div",Oe,[l(pe,{"current-page":O.value,"total-pages":L.value,pagination:G.value,onPageChanged:ae},null,8,["current-page","total-pages","pagination"])])])]),l(z,{show:V.value,onClose:T},{default:o(()=>{var e,p,h;return[a("div",Le,[t[17]||(t[17]=a("h2",{class:"text-lg font-medium text-gray-900"}," Approve Delivery Request? ",-1)),a("p",Be,[r(" Are you sure you want to approve request #"+n((e=d.value)==null?void 0:e.id)+" from ",1),a("strong",null,n((p=d.value)==null?void 0:p.sender),1),t[13]||(t[13]=r(" to ")),a("strong",null,n((h=d.value)==null?void 0:h.receiver),1),t[14]||(t[14]=r("? "))]),d.value?(i(),u("div",Fe,[a("div",Ie,[t[15]||(t[15]=a("span",{class:"font-semibold"},"Payment Terms:",-1)),a("span",null,n(d.value.payment_terms==="net_7"?"Net 7":d.value.payment_terms==="net_15"?"Net 15":d.value.payment_terms==="net_30"?"Net 30":d.value.payment_terms==="cnd"?"CND":d.value.payment_terms||" Only for Postpaid"),1)])])):x("",!0),a("div",Ee,[l(q,{onClick:T},{default:o(()=>t[16]||(t[16]=[r(" Cancel ")])),_:1}),l(M,{onClick:le,disabled:y.value},{default:o(()=>[y.value?(i(),u("span",ze,"Approving...")):(i(),u("span",We,"Approve"))]),_:1},8,["disabled"])])])]}),_:1},8,["show"]),l(z,{show:N.value,onClose:D},{default:o(()=>{var e,p,h;return[a("div",Ge,[t[22]||(t[22]=a("h2",{class:"text-lg font-medium text-gray-900"}," Reject Delivery Request? ",-1)),a("p",Ye,[r(" Are you sure you want to reject request #"+n((e=w.value)==null?void 0:e.id)+" from ",1),a("strong",null,n((p=w.value)==null?void 0:p.sender),1),t[18]||(t[18]=r(" to ")),a("strong",null,n((h=w.value)==null?void 0:h.receiver),1),t[19]||(t[19]=r("? "))]),a("div",He,[l(E,{for:"rejection_reason",value:"Reason for Rejection",required:""}),ue(a("select",{id:"rejection_reason","onUpdate:modelValue":t[4]||(t[4]=C=>g.value=C),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:""},t[20]||(t[20]=[a("option",{value:"",disabled:""},"Select a reason",-1),a("option",{value:"Incomplete information"},"Incomplete information",-1),a("option",{value:"Unserviceable location"},"Unserviceable location",-1),a("option",{value:"Payment issues"},"Payment issues",-1),a("option",{value:"Prohibited items"},"Prohibited items",-1),a("option",{value:"other"},"Other (specify below)",-1)]),512),[[de,g.value]])]),g.value==="other"?(i(),u("div",Je,[l(E,{for:"custom_reason",value:"Custom Reason",required:""}),l(fe,{id:"custom_reason",class:"mt-1 block w-full",modelValue:S.value,"onUpdate:modelValue":t[5]||(t[5]=C=>S.value=C),rows:3,placeholder:"Please specify the reason for rejection...",required:""},null,8,["modelValue"])])):x("",!0),a("div",Ke,[l(q,{onClick:D},{default:o(()=>t[21]||(t[21]=[r(" Cancel ")])),_:1}),l($,{onClick:ne,disabled:y.value||!F.value},{default:o(()=>[y.value?(i(),u("span",Qe,"Rejecting...")):(i(),u("span",Xe,"Reject"))]),_:1},8,["disabled"])])])]}),_:1},8,["show"])]),_:1}))}},vt=_e(Ze,[["__scopeId","data-v-5f4c9b17"]]);export{vt as default};
