import{g as c,i as j,h as ne,W as h,d as re,o as i,w as o,b as a,a as l,c as u,e as x,t as n,f as r,k as F,v as ie,L as ue}from"./app-Xu1-QTPS.js";import{E as de}from"./EmployeeLayout-HD3iRf9t.js";import{_ as I}from"./PrimaryButton-CQvisOOW.js";import{_ as V}from"./SecondaryButton-B4_LijSy.js";import{D as M}from"./DangerButton-B9GvHwCg.js";import{P as ce}from"./Pagination-BAEaYyIT.js";import{_ as pe}from"./SearchInput-CS47I9fw.js";import{S as U}from"./SelectInput-C0-STkNZ.js";import{_ as me}from"./DataTable-3JX1dhV3.js";import{_ as z}from"./InputLabel-BxIgZQZ8.js";import{_ as ve}from"./TextArea-DrfKMXJu.js";import{M as E}from"./Modal-CsHRj0Ox.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./NavLink-Dma88ZBl.js";const _e={class:"flex justify-between items-center w-full px-6 md:px-8"},ye={class:"flex gap-2"},ge={class:"zoom-content"},he={class:"px-6 py-4"},xe={key:0,class:"mb-6"},be={key:0,class:"p-4 bg-blue-100 text-blue-800 rounded"},ke={key:1,class:"p-4 bg-green-100 text-green-800 rounded"},we={key:2,class:"p-4 bg-red-100 text-red-800 rounded"},Re={class:"mb-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2"},Ce={class:"flex flex-wrap gap-2 w-full md:w-auto"},je={class:"bg-white shadow-sm sm:rounded-lg"},Pe={class:"p-4 bg-white border-b border-gray-200"},Ae={class:"font-mono text-sm text-gray-600"},Se={class:"flex items-center"},Ve={class:"text-gray-700"},qe={class:"flex items-center"},Ne={class:"text-gray-700"},Te={class:"capitalize"},De={key:0},Me={key:1},Ue={class:"flex space-x-2"},$e={class:"mt-4 flex justify-center"},Oe={class:"p-6"},Le={class:"mt-1 text-sm text-gray-600"},Be={key:0,class:"mt-4"},Fe={class:"mt-2 text-sm text-gray-700"},Ie={class:"mt-6 flex justify-end space-x-4"},ze={key:0},Ee={key:1},We={class:"p-6"},Ge={class:"mt-1 text-sm text-gray-600"},Ye={class:"mt-4"},He={key:0,class:"mt-4"},Je={class:"mt-6 flex justify-end space-x-4"},Ke={key:0},Qe={key:1},Xe={__name:"PendingRequests",props:{requests:{type:Array,required:!0,default:()=>[]},pagination:{type:Object,default:()=>({current_page:1,last_page:1,links:[]})},filters:{type:Object,default:()=>({search:"",payment_method:"",date_range:"all"})},status:String,success:String,error:String},setup(p){const b=p,v=c(b.filters.search||""),k=c(b.filters.payment_method||""),P=c(b.filters.date_range||"all"),f=c("created_at"),A=c("desc"),q=c(!1),N=c(!1),d=c(null),w=c(null),_=c(!1),y=c(""),S=c(""),R=c(""),W=[{value:"",text:"All Payment Types"},{value:"prepaid",text:"Prepaid"},{value:"postpaid",text:"Postpaid"}],$=j(()=>{var s;return Number((s=b.pagination)==null?void 0:s.current_page)||1}),O=j(()=>{var s;return Number((s=b.pagination)==null?void 0:s.last_page)||1}),G=j(()=>{var s;return{current_page:$.value,last_page:O.value,links:((s=b.pagination)==null?void 0:s.links)||[]}}),Y=[{value:"",text:"All Methods"},{value:"cash",text:"Cash"},{value:"gcash",text:"GCash"},{value:"bank",text:"Bank Transfer"}],H=[{value:"all",text:"All Time"},{value:"today",text:"Today"},{value:"week",text:"This Week"},{value:"month",text:"This Month"},{value:"year",text:"This Year"}],J=[{field:"id",header:"Request ID",sortable:!0},{field:"receiver",header:"Receiver",sortable:!0},{field:"pick_up_region",header:"Pick-up",sortable:!0},{field:"drop_off_region",header:"Drop-off",sortable:!0},{field:"total_price",header:"Amount",sortable:!0},{field:"payment_method",header:"Payment Method",sortable:!0},{field:"payment_type",header:"Payment Type",sortable:!0},{field:"created_at",header:"Date",sortable:!0},{field:"payment_terms",header:"Payment Terms",sortable:!1},{field:"actions",header:"Actions",sortable:!1}],L=j(()=>(b.requests||[]).map(s=>({...s,payment_type:s.payment_type??(["cash","gcash","bank"].includes(s.payment_method)?"prepaid":"postpaid")}))),K=j(()=>L.value?L.value.filter(s=>{var g,C;const t=v.value===""||((g=s.sender)==null?void 0:g.toLowerCase().includes(v.value.toLowerCase()))||((C=s.receiver)==null?void 0:C.toLowerCase().includes(v.value.toLowerCase()))||s.id.toString().includes(v.value),e=k.value===""||s.payment_method===k.value,m=R.value===""||s.payment_type===R.value;return t&&e&&m}).sort((s,t)=>{if(!f.value)return 0;const e=A.value==="asc"?1:-1;return s[f.value]<t[f.value]?-1*e:s[f.value]>t[f.value]?1*e:0}):[]),B=j(()=>y.value==="other"?S.value.trim().length>0:y.value!=="");ne([v,k,P,R],()=>{h.get(route("deliveries.pending"),{search:v.value,payment_method:k.value,date_range:P.value,payment_type:R.value,page:1},{preserveState:!0,replace:!0})});function Q(s){f.value===s?A.value=A.value==="asc"?"desc":"asc":(f.value=s,A.value="asc")}function X(s){h.get(route("deliveries.show",s))}function Z(){h.get(route("deliveries.index"))}function ee(){h.get(route("deliveries.rejected"))}function te(s){h.get(route("deliveries.pending"),{page:s,search:v.value,payment_method:k.value,date_range:P.value},{preserveState:!0})}function ae(s){d.value=s,q.value=!0}function T(){q.value=!1,d.value=null}function se(s){w.value=s,N.value=!0}function D(){N.value=!1,w.value=null,y.value="",S.value=""}async function oe(){if(d.value){_.value=!0;try{await h.post(route("deliveries.approve",d.value.id),{},{preserveScroll:!0,onSuccess:()=>{T(),h.reload({only:["requests","pagination","status","success","error"]})}})}catch{}finally{_.value=!1}}}async function le(){if(!(!w.value||!B.value)){_.value=!0;try{const s=y.value==="other"?S.value:y.value;await h.post(route("deliveries.reject",w.value.id),{rejection_reason:s},{preserveScroll:!0,onSuccess:()=>{D()}})}catch(s){console.error("Rejection failed:",s)}finally{_.value=!1}}}return(s,t)=>(i(),re(de,null,{header:o(()=>[a("div",_e,[t[8]||(t[8]=a("div",null,[a("h2",{class:"text-xl font-semibold leading-tight text-gray-800"},"Pending Delivery Requests"),a("p",{class:"mt-1 text-sm text-gray-500"}," Review and manage pending delivery requests ")],-1)),a("div",ye,[l(V,{onClick:Z},{default:o(()=>t[6]||(t[6]=[r(" Approved Requests ")])),_:1}),l(M,{onClick:ee},{default:o(()=>t[7]||(t[7]=[r(" Rejected Requests ")])),_:1})])])]),default:o(()=>[a("div",ge,[a("div",he,[p.status||p.success||p.error?(i(),u("div",xe,[p.status?(i(),u("div",be,n(p.status),1)):x("",!0),p.success?(i(),u("div",ke,n(p.success),1)):x("",!0),p.error?(i(),u("div",we,n(p.error),1)):x("",!0)])):x("",!0),a("div",Re,[l(pe,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),placeholder:"Search requests...",class:"w-full max-w-md"},null,8,["modelValue"]),a("div",Ce,[l(U,{modelValue:R.value,"onUpdate:modelValue":t[1]||(t[1]=e=>R.value=e),options:W,"option-value":"value","option-label":"text",placeholder:"All Payment Types",class:"w-full md:w-48"},null,8,["modelValue"]),l(U,{modelValue:k.value,"onUpdate:modelValue":t[2]||(t[2]=e=>k.value=e),options:Y,"option-value":"value","option-label":"text",placeholder:"All Payment Methods",class:"w-full md:w-48"},null,8,["modelValue"]),l(U,{modelValue:P.value,"onUpdate:modelValue":t[3]||(t[3]=e=>P.value=e),options:H,"option-value":"value","option-label":"text",placeholder:"Filter by date",class:"w-full md:w-48"},null,8,["modelValue"])])]),a("div",je,[a("div",Pe,[l(me,{columns:J,data:K.value,"sort-field":f.value,"sort-direction":A.value,onSort:Q,class:"w-full"},{id:o(({row:e})=>[a("span",Ae,"DR-"+n(String(e.id).padStart(6,"0")),1)]),sender:o(({row:e})=>[r(n(e.sender),1)]),receiver:o(({row:e})=>[r(n(e.receiver),1)]),pick_up_region:o(({row:e})=>[a("div",Se,[e.pick_up_region&&e.pick_up_region_color?(i(),u("div",{key:0,class:"w-3 h-3 rounded-full mr-2 border border-gray-300",style:F({backgroundColor:e.pick_up_region_color})},null,4)):x("",!0),a("span",Ve,n(e.pick_up_region||"N/A"),1)])]),drop_off_region:o(({row:e})=>[a("div",qe,[e.drop_off_region&&e.drop_off_region_color?(i(),u("div",{key:0,class:"w-3 h-3 rounded-full mr-2 border border-gray-300",style:F({backgroundColor:e.drop_off_region_color})},null,4)):x("",!0),a("span",Ne,n(e.drop_off_region||"N/A"),1)])]),total_price:o(({row:e})=>[r(" â‚±"+n(e.total_price),1)]),payment_method:o(({row:e})=>[a("span",Te,n(e.payment_method||"N/A"),1)]),payment_type:o(({row:e})=>[r(n(e.payment_type?e.payment_type.charAt(0).toUpperCase()+e.payment_type.slice(1):"N/A"),1)]),created_at:o(({row:e})=>[r(n(new Date(e.created_at).toLocaleDateString()),1)]),payment_terms:o(({row:e})=>[e.payment_terms?(i(),u("span",De,n(e.payment_terms==="net_7"?"Net 7":e.payment_terms==="net_15"?"Net 15":e.payment_terms==="net_30"?"Net 30":e.payment_terms==="cnd"?"CND":e.payment_terms),1)):(i(),u("span",Me,"Only for Postpaid"))]),actions:o(({row:e})=>[a("div",Ue,[l(V,{onClick:m=>X(e.id)},{default:o(()=>t[9]||(t[9]=[r(" View ")])),_:2},1032,["onClick"]),l(I,{onClick:m=>ae(e)},{default:o(()=>t[10]||(t[10]=[r(" Approve ")])),_:2},1032,["onClick"]),l(M,{onClick:m=>se(e)},{default:o(()=>t[11]||(t[11]=[r(" Reject ")])),_:2},1032,["onClick"])])]),_:1},8,["data","sort-field","sort-direction"])])]),a("div",$e,[l(ce,{"current-page":$.value,"total-pages":O.value,pagination:G.value,onPageChanged:te},null,8,["current-page","total-pages","pagination"])])])]),l(E,{show:q.value,onClose:T},{default:o(()=>{var e,m,g;return[a("div",Oe,[t[16]||(t[16]=a("h2",{class:"text-lg font-medium text-gray-900"}," Approve Delivery Request? ",-1)),a("p",Le,[r(" Are you sure you want to approve request #"+n((e=d.value)==null?void 0:e.id)+" from ",1),a("strong",null,n((m=d.value)==null?void 0:m.sender),1),t[12]||(t[12]=r(" to ")),a("strong",null,n((g=d.value)==null?void 0:g.receiver),1),t[13]||(t[13]=r("? "))]),d.value?(i(),u("div",Be,[a("div",Fe,[t[14]||(t[14]=a("span",{class:"font-semibold"},"Payment Terms:",-1)),a("span",null,n(d.value.payment_terms==="net_7"?"Net 7":d.value.payment_terms==="net_15"?"Net 15":d.value.payment_terms==="net_30"?"Net 30":d.value.payment_terms==="cnd"?"CND":d.value.payment_terms||" Only for Postpaid"),1)])])):x("",!0),a("div",Ie,[l(V,{onClick:T},{default:o(()=>t[15]||(t[15]=[r(" Cancel ")])),_:1}),l(I,{onClick:oe,disabled:_.value},{default:o(()=>[_.value?(i(),u("span",ze,"Approving...")):(i(),u("span",Ee,"Approve"))]),_:1},8,["disabled"])])])]}),_:1},8,["show"]),l(E,{show:N.value,onClose:D},{default:o(()=>{var e,m,g;return[a("div",We,[t[21]||(t[21]=a("h2",{class:"text-lg font-medium text-gray-900"}," Reject Delivery Request? ",-1)),a("p",Ge,[r(" Are you sure you want to reject request #"+n((e=w.value)==null?void 0:e.id)+" from ",1),a("strong",null,n((m=w.value)==null?void 0:m.sender),1),t[17]||(t[17]=r(" to ")),a("strong",null,n((g=w.value)==null?void 0:g.receiver),1),t[18]||(t[18]=r("? "))]),a("div",Ye,[l(z,{for:"rejection_reason",value:"Reason for Rejection",required:""}),ie(a("select",{id:"rejection_reason","onUpdate:modelValue":t[4]||(t[4]=C=>y.value=C),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:""},t[19]||(t[19]=[a("option",{value:"",disabled:""},"Select a reason",-1),a("option",{value:"Incomplete information"},"Incomplete information",-1),a("option",{value:"Unserviceable location"},"Unserviceable location",-1),a("option",{value:"Payment issues"},"Payment issues",-1),a("option",{value:"Prohibited items"},"Prohibited items",-1),a("option",{value:"other"},"Other (specify below)",-1)]),512),[[ue,y.value]])]),y.value==="other"?(i(),u("div",He,[l(z,{for:"custom_reason",value:"Custom Reason",required:""}),l(ve,{id:"custom_reason",class:"mt-1 block w-full",modelValue:S.value,"onUpdate:modelValue":t[5]||(t[5]=C=>S.value=C),rows:3,placeholder:"Please specify the reason for rejection...",required:""},null,8,["modelValue"])])):x("",!0),a("div",Je,[l(V,{onClick:D},{default:o(()=>t[20]||(t[20]=[r(" Cancel ")])),_:1}),l(M,{onClick:le,disabled:_.value||!B.value},{default:o(()=>[_.value?(i(),u("span",Ke,"Rejecting...")):(i(),u("span",Qe,"Reject"))]),_:1},8,["disabled"])])])]}),_:1},8,["show"])]),_:1}))}},mt=fe(Xe,[["__scopeId","data-v-ce46944a"]]);export{mt as default};
