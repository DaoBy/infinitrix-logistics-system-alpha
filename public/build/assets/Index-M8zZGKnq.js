import{i as R,g as L,h as Ne,j as it,d as ye,o as i,w as j,b as e,c as l,e as m,t as a,f as g,F,r as X,n as $,a as z,W as ee,p as Vt,q as Ze,s as et,k as tt,u as zt,v as jt,x as qt}from"./app-SYI-8bdC.js";import{E as Rt}from"./EmployeeLayout-B8SQYBgj.js";import{_ as be}from"./PrimaryButton-CBiTPJhk.js";import{_ as re}from"./SecondaryButton-BS-rbRq0.js";import{D as st}from"./DangerButton-CNs3xLhr.js";import{S as rt}from"./SelectInput-DbD3HIzo.js";import{_ as at}from"./SearchInput-CAeLERWr.js";import{_ as Nt,a as Bt}from"./ConfirmationModal-8nHu2nQl.js";import{M as lt}from"./Modal-CyMVj4bP.js";import{_ as Tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as Ft}from"./TruckIcon-CGlI839r.js";import"./NavLink-D6cPZaLM.js";const It={class:"p-4 max-h-[90vh] overflow-y-auto"},Lt={class:"bg-gray-50 rounded-lg p-3 mb-4"},Wt={class:"flex items-center space-x-3"},Pt={class:"flex items-center space-x-2 flex-1"},Ht={class:"h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center"},Et={class:"text-blue-600 font-medium text-xs"},Ot={class:"min-w-0 flex-1"},Ut={class:"text-sm font-medium text-gray-900 truncate"},Kt={class:"flex items-center space-x-2 flex-1"},Gt={class:"min-w-0 flex-1"},Jt={class:"text-sm font-medium text-gray-900 truncate"},Qt={class:"text-xs text-gray-500 truncate"},Xt={key:0,class:"mt-2 flex justify-center"},Yt={class:"mb-4"},Zt={key:0,class:"flex items-center justify-center py-4"},es={key:1,class:"space-y-2"},ts={class:"flex items-center"},ss={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},rs={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},as={key:2,class:"mt-3 p-2 bg-red-50 border border-red-200 rounded text-sm"},is={class:"text-red-700 text-xs list-disc list-inside space-y-1"},ls={key:0},ns={key:1},os={key:2},ds={class:"flex justify-end space-x-2 pt-3 border-t"},us={key:0,class:"flex items-center"},cs={key:1},ms={__name:"DispatchModal",props:{show:{type:Boolean,default:!1},set:{type:Object,default:null}},emits:["close","dispatched"],setup(G,{emit:I}){const q=G,Y=I,ne=R(()=>[{key:"assigned_orders",label:"Assigned Deliveries",passed:k.value.has_assigned_orders,status:k.value.has_assigned_orders?`${k.value.assigned_orders_count} orders`:"No orders"},{key:"truck",label:"Truck Available",passed:k.value.truck_available,status:k.value.truck_available?"Available":"Unavailable"},{key:"driver",label:"Driver Available",passed:k.value.driver_available,status:k.value.driver_available?"Available":"Unavailable"},{key:"waybills",label:"Waybills",passed:k.value.waybills_complete,status:k.value.waybills_complete?"Complete":"Missing"},{key:"stickers",label:"Package Stickers",passed:k.value.stickers_complete,status:k.value.stickers_complete?"Complete":"Missing"},{key:"manifest",label:"Manifest",passed:k.value.manifest_complete,status:k.value.manifest_complete?"Finalized":"Not ready"}]),k=L({can_dispatch:!1,has_assigned_orders:!1,assigned_orders_count:0,truck_available:!1,driver_available:!1,waybills_complete:!1,stickers_complete:!1,manifest_complete:!1,missing_waybills:[],unstickerized_packages:[],errors:[],warnings:[],message:"",total_volume:0,total_weight:0,capacity_percentage:0,manifest_check:null}),N=L(!1),W=L(!1),D=()=>{Y("close")},ge=async()=>{var v;if(!(!((v=q.set)!=null&&v.id)||!k.value.can_dispatch)){W.value=!0;try{await ee.post(route("cargo-assignments.dispatch.driver-truck-set",q.set.id),{},{onSuccess:()=>{Y("dispatched"),D()},onError:n=>{console.error("Dispatch failed:",n),alert("Dispatch failed. Please check the requirements and try again.")},onFinish:()=>{W.value=!1}})}catch(n){console.error("Dispatch error:",n),W.value=!1,alert("An error occurred during dispatch. Please try again.")}}},ae=async()=>{var v,n,p,J,b;if((v=q.set)!=null&&v.id){N.value=!0;try{const Q=await fetch(route("cargo-assignments.dispatch.validate",q.set.id));if(!Q.ok)throw new Error(`HTTP error! status: ${Q.status}`);const V=await Q.json(),te=V.manifest_check||{},oe=te.has_manifest&&te.manifest_valid;k.value={can_dispatch:V.is_valid||!1,has_assigned_orders:V.assigned_orders_count>0,assigned_orders_count:V.assigned_orders_count||0,truck_available:!((n=V.errors)!=null&&n.some(B=>B.includes("Truck"))),driver_available:!((p=V.errors)!=null&&p.some(B=>B.includes("Driver"))),waybills_complete:(((J=V.missing_waybills)==null?void 0:J.length)||0)===0,stickers_complete:(((b=V.unstickerized_packages)==null?void 0:b.length)||0)===0,manifest_complete:oe,missing_waybills:V.missing_waybills||[],unstickerized_packages:V.unstickerized_packages||[],errors:V.errors||[],warnings:V.warnings||[],message:V.message||"",total_volume:V.total_volume||0,total_weight:V.total_weight||0,capacity_percentage:V.capacity_percentage||0,manifest_check:te}}catch(Q){console.error("Validation error:",Q),k.value={can_dispatch:!1,has_assigned_orders:!1,assigned_orders_count:0,truck_available:!1,driver_available:!1,waybills_complete:!1,stickers_complete:!1,manifest_complete:!1,missing_waybills:[],unstickerized_packages:[],errors:["Failed to validate dispatch requirements: "+Q.message],warnings:[],message:"Failed to validate dispatch requirements",total_volume:0,total_weight:0,capacity_percentage:0,manifest_check:null}}finally{N.value=!1}}};return Ne(()=>q.show,v=>{var n;v&&((n=q.set)!=null&&n.id)&&ae()}),Ne(()=>q.set,v=>{q.show&&(v!=null&&v.id)&&ae()}),it(()=>{var v;q.show&&((v=q.set)!=null&&v.id)&&ae()}),(v,n)=>(i(),ye(lt,{show:G.show,"max-width":"lg",onClose:D},{default:j(()=>{var p,J,b,Q,V,te,oe,B,pe,P,_e,ke,xe;return[e("div",It,[e("div",{class:"flex items-center justify-between mb-3"},[n[1]||(n[1]=e("h3",{class:"text-lg font-medium text-gray-900"}," Dispatch Driver-Truck Set ",-1)),e("button",{onClick:D,class:"text-gray-400 hover:text-gray-600"},n[0]||(n[0]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",Lt,[e("div",Wt,[e("div",Pt,[e("div",Ht,[e("span",Et,a(((J=(p=G.set)==null?void 0:p.driver)==null?void 0:J.initials)||"DR"),1)]),e("div",Ot,[e("p",Ut,a(((Q=(b=G.set)==null?void 0:b.driver)==null?void 0:Q.name)||"N/A"),1)])]),e("div",Kt,[n[2]||(n[2]=e("svg",{class:"h-6 w-6 text-indigo-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})],-1)),e("div",Gt,[e("p",Jt,a(((te=(V=G.set)==null?void 0:V.truck)==null?void 0:te.license_plate)||"N/A"),1),e("p",Qt,a((B=(oe=G.set)==null?void 0:oe.truck)==null?void 0:B.make)+" "+a((P=(pe=G.set)==null?void 0:pe.truck)==null?void 0:P.model),1)])])]),(_e=G.set)!=null&&_e.available_for_backhaul?(i(),l("div",Xt,n[3]||(n[3]=[e("span",{class:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-purple-100 text-purple-800 border border-purple-300"},[e("svg",{class:"h-3 w-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})]),g(" Backhaul Assignment ")],-1)]))):m("",!0)]),e("div",Yt,[n[6]||(n[6]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"}," Dispatch Requirements ",-1)),N.value?(i(),l("div",Zt,n[4]||(n[4]=[e("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"},null,-1),e("span",{class:"text-sm text-gray-600"},"Validating requirements...",-1)]))):(i(),l("div",es,[(i(!0),l(F,null,X(ne.value,H=>(i(),l("div",{key:H.key,class:$(["flex items-center justify-between p-2 border rounded text-sm",H.passed?"border-green-200 bg-green-50":"border-red-200 bg-red-50"])},[e("div",ts,[(i(),l("svg",{class:$([H.passed?"text-green-500":"text-red-500","w-4 h-4 mr-2"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[H.passed?(i(),l("path",ss)):(i(),l("path",rs))],2)),e("span",null,a(H.label),1)]),e("span",{class:$([H.passed?"text-green-700":"text-red-700","text-xs font-medium"])},a(H.status),3)],2))),128))])),!k.value.can_dispatch&&!N.value?(i(),l("div",as,[n[5]||(n[5]=e("p",{class:"text-red-800 font-medium mb-1"},"Cannot Dispatch:",-1)),e("ul",is,[(i(!0),l(F,null,X(k.value.errors,H=>(i(),l("li",{key:H},a(H),1))),128)),((ke=k.value.missing_waybills)==null?void 0:ke.length)>0?(i(),l("li",ls," Missing waybills: "+a(k.value.missing_waybills.length)+" orders ",1)):m("",!0),((xe=k.value.unstickerized_packages)==null?void 0:xe.length)>0?(i(),l("li",ns," Missing stickers: "+a(k.value.unstickerized_packages.length)+" packages ",1)):m("",!0),k.value.manifest_complete?m("",!0):(i(),l("li",os," Manifest not finalized "))])])):m("",!0)]),e("div",ds,[z(re,{onClick:D,disabled:W.value,size:"sm"},{default:j(()=>n[7]||(n[7]=[g(" Cancel ")])),_:1},8,["disabled"]),z(be,{onClick:ge,disabled:!k.value.can_dispatch||W.value,size:"sm",class:"min-w-24"},{default:j(()=>[W.value?(i(),l("span",us,n[8]||(n[8]=[e("div",{class:"animate-spin rounded-full h-3 w-3 border-b-2 border-white mr-2"},null,-1),g(" Dispatching... ")]))):(i(),l("span",cs," Dispatch "))]),_:1},8,["disabled"])])])]}),_:1},8,["show"]))}},vs=Tt(ms,[["__scopeId","data-v-93717be2"]]),gs={class:"flex flex-wrap justify-between items-center gap-4 px-4 md:px-6 max-w-screen-xl mx-auto w-full"},ps={class:"flex flex-wrap gap-2"},_s={key:0,class:"px-4 md:px-6 py-2 max-w-screen-xl mx-auto"},xs={class:"py-6 px-2 md:px-6"},fs={key:0,class:"flex justify-center items-center py-12"},hs={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6 text-center mb-6 max-w-screen-xl mx-auto"},ys={class:"mt-1 text-sm text-red-600"},bs={class:"bg-white shadow-sm rounded-lg border border-gray-200 mb-6 max-w-screen-xl mx-auto"},ks={class:"border-b border-gray-200"},ws={class:"-mb-px flex space-x-8 px-6"},Cs=["disabled"],As=["disabled"],Ss=["disabled"],Ds={class:"p-4 border-b border-gray-200"},Ms={class:"flex flex-col lg:flex-row gap-4"},$s={class:"flex-1"},Vs={class:"flex items-center gap-2"},zs={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"},js={class:"flex justify-between items-center mt-4"},qs={class:"text-sm text-gray-500"},Rs={key:0,class:"ml-2"},Ns={key:0,class:"text-xs text-gray-600"},Bs={key:0,class:"flex justify-center items-center py-12 max-w-screen-xl mx-auto"},Ts={class:"ml-3 text-gray-600"},Fs={key:1,class:"mb-6 max-w-screen-xl mx-auto"},Is={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Ls={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Ws={class:"flex justify-between items-start mb-3"},Ps={class:"font-medium text-gray-900"},Hs={class:"text-sm text-gray-500"},Es={key:0,class:"px-2 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-800 border border-purple-300"},Os={class:"text-xs text-gray-600 mb-3"},Us={key:0,class:"mb-3 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800"},Ks={key:0,class:"max-w-screen-xl mx-auto"},Gs={class:"bg-white shadow-sm rounded-lg overflow-hidden border border-gray-200"},Js={class:"overflow-x-auto"},Qs={class:"min-w-full divide-y divide-gray-200"},Xs={class:"bg-gray-50"},Ys={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Zs=["checked"],er={class:"bg-white divide-y divide-gray-200"},tr={class:"px-6 py-4 whitespace-nowrap"},sr=["checked","onChange"],rr={class:"px-6 py-4 whitespace-nowrap"},ar={class:"flex items-center space-x-2"},ir={class:"font-bold text-green-700 tracking-wide text-sm"},lr={class:"text-xs text-gray-500 mt-1"},nr={key:0},or={key:0,class:"text-xs text-yellow-600 flex items-center mt-1"},dr={class:"px-6 py-4 whitespace-nowrap"},ur={class:"text-sm text-gray-900"},cr={class:"text-sm text-gray-500"},mr={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},vr={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},gr={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},pr={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},_r={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},xr={key:0,class:"text-center py-12"},fr={key:1,class:"max-w-screen-xl mx-auto"},hr={class:"bg-white shadow-sm rounded-lg overflow-hidden border border-gray-200"},yr={class:"overflow-x-auto"},br={class:"min-w-full divide-y divide-gray-200"},kr={class:"bg-white divide-y divide-gray-200"},wr={class:"px-6 py-4 whitespace-nowrap"},Cr={class:"flex items-center space-x-2"},Ar={class:"font-bold text-green-700 tracking-wide text-sm"},Sr={class:"text-xs text-gray-500 mt-1"},Dr={key:0},Mr={class:"px-6 py-4 whitespace-nowrap"},$r={class:"text-sm text-gray-900"},Vr={class:"text-sm text-gray-500"},zr={class:"px-6 py-4 whitespace-nowrap"},jr={class:"flex items-center"},qr={key:0,class:"flex-shrink-0 h-8 w-8 bg-green-100 rounded-full flex items-center justify-center"},Rr={class:"text-green-600 font-medium text-xs"},Nr={key:1,class:"flex-shrink-0 h-8 w-8 bg-gray-100 rounded-full flex items-center justify-center"},Br={class:"ml-3"},Tr={class:"text-sm font-medium text-gray-900"},Fr={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ir={class:"text-xs text-gray-500"},Lr={class:"px-6 py-4 whitespace-nowrap"},Wr={key:0,class:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 border border-blue-300"},Pr={key:1,class:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-800 border border-gray-300"},Hr={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Er={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Or={class:"flex justify-end space-x-2"},Ur={key:1,class:"inline-flex items-center px-2 py-1 text-xs text-gray-400 bg-gray-100 rounded border border-gray-300",title:"Cannot cancel - Manifest finalized"},Kr={key:0,class:"text-center py-12"},Gr={key:2,class:"max-w-screen-xl mx-auto"},Jr={class:"bg-white shadow-sm rounded-lg overflow-hidden border border-gray-200"},Qr={class:"overflow-x-auto"},Xr={class:"min-w-full divide-y divide-gray-200"},Yr={class:"bg-white divide-y divide-gray-200"},Zr={class:"px-6 py-4 whitespace-nowrap"},ea={class:"flex items-center space-x-2"},ta={class:"font-bold text-green-700 tracking-wide text-sm"},sa={class:"text-xs text-gray-500 mt-1"},ra={key:0},aa={class:"px-6 py-4 whitespace-nowrap"},ia={class:"text-sm text-gray-900"},la={class:"text-sm text-gray-500"},na={class:"px-6 py-4 whitespace-nowrap"},oa={class:"flex items-center"},da={class:"flex-shrink-0 h-8 w-8 bg-purple-100 rounded-full flex items-center justify-center"},ua={class:"text-purple-600 font-medium text-xs"},ca={class:"ml-3"},ma={class:"text-sm font-medium text-gray-900"},va={class:"text-xs text-gray-500"},ga={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},pa={class:"text-xs text-gray-500"},_a={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},xa={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},fa={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ha={key:0,class:"text-center py-12"},ya={class:"mt-8 max-w-screen-xl mx-auto"},ba={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ka={class:"lg:col-span-1"},wa={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4"},Ca={class:"flex justify-between items-center mb-4"},Aa={class:"text-lg font-medium text-gray-900"},Sa={class:"space-y-3 max-h-96 overflow-y-auto"},Da={class:"flex justify-between items-start"},Ma={class:"flex-1"},$a={class:"flex items-center space-x-2 mb-2"},Va={class:"font-bold text-green-700 tracking-wide text-sm"},za={class:"text-xs text-gray-500"},ja={class:"mt-1 text-xs text-gray-600"},qa={key:0,class:"mt-1 p-1 bg-yellow-100 border border-yellow-300 rounded text-xs text-yellow-800"},Ra={key:1,class:"mt-1 p-1 bg-red-100 border border-red-300 rounded text-xs text-red-800"},Na=["onClick"],Ba={key:1,class:"text-center text-gray-500 py-8"},Ta={key:0,class:"mt-4 pt-4 border-t border-gray-200"},Fa={class:"text-sm text-gray-600 space-y-1"},Ia={key:0,class:"p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800 mt-2"},La={key:1,class:"p-2 bg-red-50 border border-red-200 rounded text-xs text-red-800 mt-2"},Wa={key:2,class:"p-2 bg-red-50 border border-red-200 rounded text-xs text-red-800 mt-2"},Pa={class:"lg:col-span-2"},Ha={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4"},Ea={class:"flex justify-between items-center mb-4"},Oa={class:"flex space-x-2"},Ua=["onClick"],Ka={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ga=["onClick"],Ja={class:"flex justify-between items-start mb-3"},Qa={class:"flex items-center"},Xa={class:"ml-3"},Ya={class:"text-sm font-medium text-gray-900"},Za={key:0,class:"mt-1"},ei={key:1,class:"mt-1"},ti={class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800"},si={class:"flex flex-col items-end space-y-1"},ri={key:0,class:"px-2 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-800 border border-purple-300"},ai={class:"mb-3"},ii={class:"text-sm font-medium text-gray-900"},li={class:"text-xs text-gray-500"},ni={class:"grid grid-cols-2 gap-2 text-sm mb-3"},oi={class:"font-medium"},di={class:"mb-4 space-y-3"},ui={class:"flex justify-between text-xs text-gray-600 mb-1"},ci={class:"w-full bg-gray-200 rounded-full h-2"},mi={class:"text-xs text-gray-500 mt-1 text-right"},vi={class:"flex justify-between text-xs text-gray-600 mb-1"},gi={class:"w-full bg-gray-200 rounded-full h-2"},pi={class:"text-xs text-gray-500 mt-1 text-right"},_i={class:"text-xs text-gray-600 mb-3 space-y-1"},xi={key:0,class:"mt-2 text-center"},fi={key:0,class:"text-center py-8"},hi={class:"text-gray-400 mb-4"},yi={key:3,class:"bg-white px-4 py-3 flex items-center justify-center border-t border-gray-200 sm:px-6 mt-6 max-w-screen-xl mx-auto rounded-lg"},bi={class:"flex items-center space-x-2"},ki=["disabled"],wi=["disabled"],Ci={class:"space-y-4"},Ai={class:"flex items-start"},Si={class:"flex-shrink-0 mt-0.5"},Di={key:0,class:"h-5 w-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Mi={key:1,class:"h-5 w-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},$i={class:"ml-3 flex-1"},Vi={class:"font-medium text-sm"},zi={key:0,class:"mt-1 text-xs space-y-1"},ji={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},qi={class:"bg-gray-50 rounded-lg p-3 border border-gray-200"},Ri={class:"space-y-2 text-xs"},Ni={class:"flex justify-between"},Bi={class:"font-medium"},Ti={class:"flex justify-between"},Fi={class:"flex justify-between"},Ii={class:"font-medium"},Li={class:"flex justify-between"},Wi={class:"bg-gray-50 rounded-lg p-3 border border-gray-200"},Pi={class:"flex items-center space-x-3"},Hi={class:"flex-1 min-w-0"},Ei={class:"text-sm font-medium text-gray-900 truncate"},Oi={class:"text-xs text-gray-500 truncate"},Ui={class:"flex items-center space-x-2 mt-1"},Ki={class:"text-xs text-gray-500"},Gi={key:0,class:"px-1.5 py-0.5 rounded-full text-xs font-semibold bg-purple-100 text-purple-800 border border-purple-300"},Ji={class:"mt-1"},Qi={class:"border rounded-lg"},Xi={class:"bg-gray-50 px-3 py-2 border-b"},Yi={class:"text-sm font-medium text-gray-900 flex items-center"},Zi={class:"max-h-40 overflow-y-auto"},el={class:"flex justify-between items-start"},tl={class:"flex-1 min-w-0"},sl={class:"flex items-center space-x-2"},rl={class:"font-medium text-sm text-gray-900 truncate"},al={class:"text-xs text-gray-500 mt-0.5 truncate"},il={class:"flex items-center space-x-3 mt-1 text-xs text-gray-400"},ll={class:"flex items-center space-x-1 ml-2"},nl={key:0,class:"inline-flex items-center px-1.5 py-0.5 rounded text-xs bg-yellow-100 text-yellow-800",title:"Missing stickers"},ol={key:1,class:"inline-flex items-center px-1.5 py-0.5 rounded text-xs bg-red-100 text-red-800",title:"Region mismatch"},dl={class:"p-6"},ul={class:"mt-4 bg-red-50 border border-red-200 rounded-lg p-4"},cl={class:"flex items-start"},ml={class:"ml-3"},vl={class:"mt-2 text-sm text-red-700 space-y-1"},gl={class:"mt-4"},pl={class:"mt-6 flex justify-end space-x-4"},Ml={__name:"Index",props:{deliveries:Object,driverTruckSets:{type:Array,default:()=>[]},batchSuggestions:{type:Array,default:()=>[]},regions:{type:Array,default:()=>[]},flash:Object,filters:Object},setup(G){var Je,Qe,Xe,Ye;const I=G,q=L(!1),Y=L(null),ne=L(!1),k=L(!1),N=L(null),W=L(""),D=L(!1),ge=L(!1),ae=L(null),v=L(((Je=I.filters)==null?void 0:Je.activeTab)||"ready"),n=L([]),p=L(null),J=L("all"),b=Vt({search:((Qe=I.filters)==null?void 0:Qe.search)||"",region_id:((Xe=I.filters)==null?void 0:Xe.region_id)||"",driver_id:((Ye=I.filters)==null?void 0:Ye.driver_id)||""}),Q=R(()=>{var r;return[{value:"",label:"All Regions"},...((r=I.regions)==null?void 0:r.map(t=>({value:t.id,label:t.name})))||[]]}),V=R(()=>{const r=new Map;return v.value==="assigned"&&P.value.forEach(t=>{var o;const s=(o=t.driver_truck_assignment)==null?void 0:o.driver;s&&s.id&&r.set(s.id,{value:s.id,label:s.name,employee_id:s.employee_id})}),[{value:"",label:"All Drivers"},...Array.from(r.values())]}),te=R(()=>[{value:"all",label:"All Types"},{value:"regular",label:"Regular"},{value:"backhaul",label:"Backhaul"}]),oe=R(()=>{var r,t,s;return((r=I.flash)==null?void 0:r.success)||((t=I.flash)==null?void 0:t.error)||((s=I.flash)==null?void 0:s.warning)}),B=R(()=>I.deliveries||{data:[]}),pe=R(()=>P.value.length>0&&P.value.every(r=>ze(r.id))),P=R(()=>(B.value.data||[]).filter(s=>{switch(v.value){case"ready":return s.status==="ready";case"assigned":return s.status==="assigned";case"active":return s.status==="in_transit"||s.status==="dispatched";default:return!0}}).filter(s=>{var o,d,u,c,_,y,x,f,h,w,A,M,S,T,C,Z,se;if(b.search){const O=b.search.toLowerCase(),le=((d=(o=s.delivery_request)==null?void 0:o.reference_number)==null?void 0:d.toLowerCase())||"",Me=`do-${(c=(u=s.id)==null?void 0:u.toString())==null?void 0:c.padStart(6,"0")}`.toLowerCase(),$e=((x=(y=(_=s.delivery_request)==null?void 0:_.pick_up_region)==null?void 0:y.name)==null?void 0:x.toLowerCase())||"",Ve=((w=(h=(f=s.delivery_request)==null?void 0:f.drop_off_region)==null?void 0:h.name)==null?void 0:w.toLowerCase())||"",$t=((S=(M=(A=s.driver_truck_assignment)==null?void 0:A.driver)==null?void 0:M.name)==null?void 0:S.toLowerCase())||"";if(!le.includes(O)&&!Me.includes(O)&&!$e.includes(O)&&!Ve.includes(O)&&!$t.includes(O))return!1}return!(b.region_id&&((C=(T=s.delivery_request)==null?void 0:T.pick_up_region)==null?void 0:C.id)!=b.region_id||b.driver_id&&v.value==="assigned"&&((se=(Z=s.driver_truck_assignment)==null?void 0:Z.driver)==null?void 0:se.id)!=b.driver_id)})),_e=R(()=>Array.isArray(I.driverTruckSets)?I.driverTruckSets:[]),ke=R(()=>Array.isArray(I.batchSuggestions)?I.batchSuggestions:[]),xe=R(()=>ke.value),H=R(()=>{const r=_e.value;return!Array.isArray(r)||r.length===0?[]:r.map(t=>{const s=t.driver||{},o=t.truck||{};let d=s.initials||"";return!d&&s.name&&(d=he(s.name)),{...t,driver:{...s,name:s.name||"Driver",initials:d,delivery_orders_count:s.delivery_orders_count??s.current_assignments??0,current_assignments:s.current_assignments??s.delivery_orders_count??0,canAcceptNewAssignment:s.canAcceptNewAssignment??s.available??!1,available:s.available??!0},truck:{...o,volume_capacity:o.volume_capacity??0,weight_capacity:o.weight_capacity??0,license_plate:o.license_plate||"Truck",make:o.make||"",model:o.model||"",status:o.status||"unknown"},current_volume:t.current_volume??0,current_weight:t.current_weight??0,available_volume:t.available_volume??0,available_weight:t.available_weight??0,is_available:t.is_available??!0,available_for_backhaul:t.available_for_backhaul??!1,region:t.region??{name:"N/A"},current_region:t.current_region??{name:"N/A"},active_orders:t.active_orders??[]}}).filter(t=>J.value==="all"?!0:J.value==="backhaul"?t.available_for_backhaul:J.value==="regular"?!t.available_for_backhaul:!0)}),nt=R(()=>P.value.map(r=>{if(!r.driver_truck_assignment)return r;const t=_e.value.find(s=>s.id===r.driver_truck_assignment.id);return t?{...r,driver_truck_assignment:{...r.driver_truck_assignment,has_finalized_manifest:t.has_finalized_manifest,manifest_status:t.manifest_status}}:r})),de=R(()=>n.value.reduce((r,t)=>{var o;const s=((o=t.delivery_request)==null?void 0:o.packages)||[];return r+Ae(s)},0)),ue=R(()=>n.value.reduce((r,t)=>{var o;const s=((o=t.delivery_request)==null?void 0:o.packages)||[];return r+Se(s)},0)),Be=R(()=>n.value.some(r=>ie(r))),Te=R(()=>{if(n.value.length===0)return!1;const r=n.value.some(s=>s.is_backhaul),t=n.value.some(s=>!s.is_backhaul);return r&&t}),ot=R(()=>n.value.some(r=>De(r))),E=R(()=>{var f,h;if(!p.value||n.value.length===0)return{isValid:!1,message:"Please select deliveries and a driver-truck set",details:[],availableVolume:0,availableWeight:0};const r=[],t=p.value.truck||{},s=p.value.current_volume||0,o=p.value.current_weight||0,d=(t.volume_capacity||0)-s,u=(t.weight_capacity||0)-o;de.value>d&&r.push(`Insufficient volume capacity: ${U(de.value)} selected vs ${U(d)} available`),ue.value>u&&r.push(`Insufficient weight capacity: ${K(ue.value)} selected vs ${K(u)} available`);const c=(f=p.value.region)==null?void 0:f.id,_=(h=p.value.current_region)==null?void 0:h.id,y=p.value.available_for_backhaul;n.value.forEach(w=>{var S,T,C,Z,se,O,le;const A=(T=(S=w.delivery_request)==null?void 0:S.pick_up_region)==null?void 0:T.id,M=(Z=(C=w.delivery_request)==null?void 0:C.drop_off_region)==null?void 0:Z.id;y?(A!==_&&r.push(`Backhaul: Pickup must be from current region (${(se=p.value.current_region)==null?void 0:se.name})`),M!==c&&r.push(`Backhaul: Delivery must be to home region (${(O=p.value.region)==null?void 0:O.name})`)):A!==c&&r.push(`Regular: Pickup must be from home region (${(le=p.value.region)==null?void 0:le.name})`)}),Te.value&&r.push("Cannot mix regular and backhaul assignments in the same batch"),Be.value&&r.push("Some packages are missing stickers");const x=r.length===0;return{isValid:x,message:x?"Assignment is valid":"Assignment validation failed",details:r,availableVolume:d,availableWeight:u}});Ne(v,(r,t)=>{r!==t&&we(r)});async function dt(){q.value=!0,Y.value=null;try{const r={...b,activeTab:v.value};await ee.reload({data:r,preserveState:!0,preserveScroll:!0})}catch(r){Y.value=r.message||"Failed to load deliveries"}finally{q.value=!1}}async function we(r){if(!(r===v.value||D.value)){D.value=!0,v.value=r;try{const t={...b,activeTab:r};await ee.visit(route("cargo-assignments.index"),{data:t,preserveState:!0,preserveScroll:!0,replace:!0,only:["deliveries","filters"],onFinish:()=>{D.value=!1}})}catch{Y.value="Failed to switch tabs",D.value=!1}}}async function fe(){ne.value=!0;try{await ee.reload({only:["deliveries","driverTruckSets","batchSuggestions"],onSuccess:()=>{Y.value=null}})}catch{Y.value="Failed to refresh data"}finally{ne.value=!1}}function ce(){const r={...b,activeTab:v.value};ee.visit(route("cargo-assignments.index"),{data:r,preserveState:!0,preserveScroll:!0,replace:!0,only:["deliveries","filters"]})}let Fe=null;function Ie(){clearTimeout(Fe),Fe=setTimeout(()=>{ce()},500)}function ut(){b.search="",b.region_id="",b.driver_id="",ce()}function Le(r){if(r>=1&&r<=B.value.last_page){const t={...b,activeTab:v.value,page:r};ee.visit(route("cargo-assignments.index"),{data:t,preserveState:!0,preserveScroll:!0})}}function ct(){if(pe.value)n.value=n.value.filter(r=>!P.value.some(t=>t.id===r.id));else{const r=P.value.filter(t=>!n.value.some(s=>s.id===t.id));n.value.push(...r)}}function mt(r){n.value.some(s=>s.id===r.id)?n.value=n.value.filter(s=>s.id!==r.id):n.value.push(r)}function ze(r){return n.value.some(t=>t.id===r)}function vt(r){n.value=n.value.filter(t=>t.id!==r)}function We(){n.value=[],p.value=null}function gt(r){p.value=r}function Pe(){E.value.isValid&&(k.value=!0)}function pt(){k.value=!1}function _t(){const r=n.value.map(s=>s.delivery_request_id||s.id),t=new Date(Date.now()+6e4);ee.post(route("cargo-assignments.assign.batch"),{delivery_request_ids:r,driver_truck_assignment_id:p.value.id,estimated_departure:t.toISOString()},{onStart:()=>q.value=!0,onFinish:()=>{q.value=!1,k.value=!1,We()},onError:s=>{console.error("Batch assignment failed:",s),alert("Failed to assign deliveries. Please try again.")}})}function xt(r){ae.value=r,ge.value=!0}function He(){ge.value=!1,ae.value=null}function ft(){fe(),He()}function Ee(r){return r.active_orders&&r.active_orders.length>0}function ht(r){return r.active_orders?r.active_orders.length:0}function yt(r){var t;if((t=r.driver_truck_assignment)!=null&&t.has_finalized_manifest){alert("Cannot cancel assignment. Manifest has been finalized and this delivery is ready for dispatch.");return}N.value=r,W.value=""}function Oe(){N.value=null,W.value=""}async function bt(){if(!(!N.value||!W.value.trim()))try{await ee.post(route("cargo-assignments.deliveries.cancel",N.value.id),{reason:W.value},{onStart:()=>q.value=!0,onFinish:()=>{q.value=!1,N.value=null,W.value=""},onSuccess:()=>{fe()},onError:r=>{console.error("Failed to cancel delivery:",r),alert("Failed to cancel delivery assignment. Please try again.")}})}catch(r){console.error("Error cancelling delivery:",r),alert("An error occurred while cancelling the delivery.")}}function je(r){ee.get(route("deliveries.show",r))}function kt(){return{ready:"Search ready deliveries...",assigned:"Search assigned deliveries...",active:"Search active deliveries..."}[v.value]||"Search deliveries..."}function wt(){return{ready:"ready for assignment",assigned:"assigned",active:"active"}[v.value]||""}function Ct(r){const t=I.regions.find(s=>s.id==(r||b.region_id));return(t==null?void 0:t.name)||"Selected Region"}function he(r){return r?r.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2):"??"}function me(r){if(!r.truck||!r.truck.volume_capacity)return 0;const t=r.current_volume||0;return Math.round(t/r.truck.volume_capacity*100)}function ve(r){if(!r.truck||!r.truck.weight_capacity)return 0;const t=r.current_weight||0;return Math.round(t/r.truck.weight_capacity*100)}function At(r){if(!r)return"bg-gray-100 text-gray-800";const t=Ue(r);return t>=90?"bg-red-100 text-red-800":t>=75?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}function Ue(r){if(!r||!r.truck)return 0;const t=r.truck.volume_capacity>0?Math.round(r.current_volume/r.truck.volume_capacity*100):0,s=r.truck.weight_capacity>0?Math.round(r.current_weight/r.truck.weight_capacity*100):0;return Math.max(t,s)}function Ce(r){return r?new Date(r).toLocaleDateString():"N/A"}function qe(r){return r?new Date(r).toLocaleString():"N/A"}const U=r=>{const t=Number(r||0);return t<.001?`${(t*1e6).toFixed(0)} cm³`:t<.01?`${t.toFixed(6)} m³`:`${t.toFixed(2)} m³`},K=r=>{const t=Number(r)||0;return t===0?"0 kg":t<1?`${(t*1e3).toFixed(0)} g`:`${t.toFixed(1)} kg`},Ae=r=>!r||!Array.isArray(r)?0:r.reduce((t,s)=>{if(s.height&&s.width&&s.length){const o=parseFloat(s.height)||0,d=parseFloat(s.width)||0,u=parseFloat(s.length)||0,c=o*d*u/1e6;return t+c}return t+(Number(s.volume)||0)},0);function Se(r){return!r||!Array.isArray(r)?0:r.reduce((t,s)=>t+(Number(s.weight)||0),0)}function ie(r){var s;return(((s=r.delivery_request)==null?void 0:s.packages)||[]).some(o=>!o.sticker_printed_at)}function Ke(r){var t;return((t=r.delivery_requests)==null?void 0:t.some(s=>ie(s)))||!1}function De(r){var c,_,y,x,f,h;if(!p.value)return!1;const t=(c=p.value.region)==null?void 0:c.id,s=(_=p.value.current_region)==null?void 0:_.id,o=p.value.available_for_backhaul,d=(x=(y=r.delivery_request)==null?void 0:y.pick_up_region)==null?void 0:x.id,u=(h=(f=r.delivery_request)==null?void 0:f.drop_off_region)==null?void 0:h.id;return o?d!==s||u!==t:d!==t}function St(r){if(!r||!r.delivery_requests)return;n.value=r.delivery_requests||[];const t=Re(r);t.length>0&&(p.value=t[0]),Pe()}function Re(r){const t=H.value;return!Array.isArray(t)||t.length===0?[]:t.filter(s=>{var w,A,M,S;const o=((w=s.region)==null?void 0:w.id)===((A=r.pickup_region)==null?void 0:A.id)||s.available_for_backhaul&&((M=s.current_region)==null?void 0:M.id)===((S=r.pickup_region)==null?void 0:S.id),d=s.truck||{},u=s.current_volume||0,c=s.current_weight||0,_=(d.volume_capacity||0)-u,y=(d.weight_capacity||0)-c,x=Number(r.total_volume)||0,f=Number(r.total_weight)||0,h=_>=x&&y>=f;return s.is_available&&o&&h})}function Dt(r){var o,d,u;const t=(o=r.pickup_region)==null?void 0:o.id,s=(d=r.destination_region)==null?void 0:d.id;return((u=r.delivery_requests)==null?void 0:u.every(c=>{var x,f,h,w;const _=(f=(x=c.delivery_request)==null?void 0:x.pick_up_region)==null?void 0:f.id,y=(w=(h=c.delivery_request)==null?void 0:h.drop_off_region)==null?void 0:w.id;return _===s&&y===t}))||!1}function Mt(r){J.value=r}function Ge(r){if(r.has_finalized_manifest||!r.is_available)return!1;const t=r.truck||{},s=r.current_volume||0,o=r.current_weight||0,d=(t.volume_capacity||0)-s,u=(t.weight_capacity||0)-o;return d>=de.value&&u>=ue.value}return it(()=>{setInterval(()=>{v.value==="active"&&fe()},3e4)}),(r,t)=>(i(),ye(Rt,null,{header:j(()=>[e("div",gs,[t[11]||(t[11]=e("div",null,[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Cargo Assignment Dashboard "),e("p",{class:"text-sm text-gray-600 mt-1"}," Manage delivery assignments and track active deliveries ")],-1)),e("div",ps,[z(at,{modelValue:b.search,"onUpdate:modelValue":t[0]||(t[0]=s=>b.search=s),placeholder:"Search deliveries...",onKeyup:Ze(ce,["enter"]),onInput:Ie,class:"w-full md:w-64"},null,8,["modelValue"]),z(re,{onClick:fe,loading:ne.value},{default:j(()=>t[10]||(t[10]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),g(" Refresh ")])),_:1},8,["loading"])])])]),default:j(()=>[oe.value?(i(),l("div",_s,[z(Nt,{flash:G.flash},null,8,["flash"])])):m("",!0),e("div",xs,[q.value?(i(),l("div",fs,t[12]||(t[12]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1)]))):Y.value?(i(),l("div",hs,[t[14]||(t[14]=e("svg",{class:"mx-auto h-12 w-12 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)),t[15]||(t[15]=e("h3",{class:"mt-2 text-sm font-medium text-red-800"},"Failed to load deliveries",-1)),e("p",ys,a(Y.value),1),z(be,{onClick:dt,class:"mt-4"},{default:j(()=>t[13]||(t[13]=[g(" Try Again ")])),_:1})])):(i(),l(F,{key:2},[e("div",bs,[e("div",ks,[e("nav",ws,[e("button",{onClick:t[1]||(t[1]=s=>we("ready")),class:$(["py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200",v.value==="ready"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"]),disabled:D.value}," Assignment ",10,Cs),e("button",{onClick:t[2]||(t[2]=s=>we("assigned")),class:$(["py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200",v.value==="assigned"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"]),disabled:D.value}," Assigned ",10,As),e("button",{onClick:t[3]||(t[3]=s=>we("active")),class:$(["py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200",v.value==="active"?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"]),disabled:D.value}," Active Deliveries ",10,Ss)])]),e("div",Ds,[e("div",Ms,[e("div",$s,[z(at,{modelValue:b.search,"onUpdate:modelValue":t[4]||(t[4]=s=>b.search=s),placeholder:kt(),onKeyup:Ze(ce,["enter"]),onInput:Ie,class:"w-full",disabled:D.value},null,8,["modelValue","placeholder","disabled"])]),e("div",Vs,[z(re,{onClick:fe,loading:ne.value,disabled:D.value},{default:j(()=>t[16]||(t[16]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),g(" Refresh ")])),_:1},8,["loading","disabled"]),z(re,{onClick:ut,disabled:D.value},{default:j(()=>t[17]||(t[17]=[g(" Reset ")])),_:1},8,["disabled"])])]),e("div",zs,[z(rt,{modelValue:b.region_id,"onUpdate:modelValue":t[5]||(t[5]=s=>b.region_id=s),options:Q.value,placeholder:"Filter by Region",onChange:ce,disabled:D.value},null,8,["modelValue","options","disabled"]),v.value==="assigned"?(i(),ye(rt,{key:0,modelValue:b.driver_id,"onUpdate:modelValue":t[6]||(t[6]=s=>b.driver_id=s),options:V.value,placeholder:"Filter by Driver",onChange:ce,disabled:D.value},null,8,["modelValue","options","disabled"])):m("",!0)]),e("div",js,[e("div",qs,[g(" Showing "+a(P.value.length)+" deliveries ",1),b.region_id?(i(),l("span",Rs," in "+a(Ct(b.region_id)),1)):m("",!0)]),v.value==="ready"?(i(),l("div",Ns,t[18]||(t[18]=[e("span",{class:"flex items-center"},[e("div",{class:"w-2 h-2 bg-yellow-500 rounded-full mr-1"}),g(" Missing Stickers ")],-1)]))):m("",!0)])])]),D.value?(i(),l("div",Bs,[t[19]||(t[19]=e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),e("span",Ts,"Loading "+a(wt())+" deliveries...",1)])):v.value==="ready"&&xe.value.length>0?(i(),l("div",Fs,[e("div",Is,[t[20]||(t[20]=e("h3",{class:"text-lg font-medium text-blue-800 mb-3"},"Batch Assignment Suggestions",-1)),e("div",Ls,[(i(!0),l(F,null,X(xe.value,s=>{var o,d,u,c,_;return i(),l("div",{key:((o=s.destination_region)==null?void 0:o.id)||((d=s.pickup_region)==null?void 0:d.id),class:"bg-white border border-blue-200 rounded-lg p-4 hover:shadow-md transition-shadow"},[e("div",Ws,[e("div",null,[e("p",Ps,a(((u=s.pickup_region)==null?void 0:u.name)??"N/A")+" → "+a(((c=s.destination_region)==null?void 0:c.name)??"N/A"),1),e("p",Hs,a(((_=s.delivery_requests)==null?void 0:_.length)??0)+" deliveries",1)]),Dt(s)?(i(),l("span",Es," Backhaul ")):m("",!0)]),e("div",Os,[e("p",null,"Volume: "+a(U(s.total_volume||0)),1),e("p",null,"Weight: "+a(K(s.total_weight||0)),1)]),Ke(s)?(i(),l("div",Us," ⚠️ Some packages are missing stickers ")):m("",!0),z(be,{onClick:y=>St(s),size:"xs",class:"w-full",disabled:!Re(s).length||Ke(s)},{default:j(()=>[g(" Assign Batch ("+a(Re(s).length)+" sets available) ",1)]),_:2},1032,["onClick","disabled"])])}),128))])])])):m("",!0),D.value?m("",!0):(i(),l(F,{key:2},[v.value==="ready"?(i(),l("div",Ks,[e("div",Gs,[e("div",Js,[e("table",Qs,[e("thead",Xs,[e("tr",null,[e("th",Ys,[e("input",{type:"checkbox",checked:pe.value,onChange:ct,class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,40,Zs)]),t[21]||(t[21]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Reference #",-1)),t[22]||(t[22]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Route",-1)),t[23]||(t[23]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Packages",-1)),t[24]||(t[24]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Volume",-1)),t[25]||(t[25]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Weight",-1)),t[26]||(t[26]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Created",-1)),t[27]||(t[27]=e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions",-1))])]),e("tbody",er,[(i(!0),l(F,null,X(P.value,s=>{var o,d,u,c,_,y,x,f,h;return i(),l("tr",{key:s.id,class:$(["hover:bg-gray-50",{"bg-blue-50":ze(s.id),"bg-yellow-50":ie(s)}])},[e("td",tr,[e("input",{type:"checkbox",checked:ze(s.id),onChange:w=>mt(s),class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,40,sr)]),e("td",rr,[e("div",ar,[t[28]||(t[28]=e("span",{class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-green-100 text-green-800"}," Ref ",-1)),e("span",ir,a(((o=s.delivery_request)==null?void 0:o.reference_number)||`DR-${String(s.delivery_request_id||"").padStart(6,"0")}`),1)]),e("div",lr,[g(" ID: DO-"+a(String(s.delivery_request_id||"").padStart(6,"0"))+" ",1),s.created_at?(i(),l("span",nr," | Created: "+a(Ce(s.created_at)),1)):m("",!0)]),ie(s)?(i(),l("div",or,t[29]||(t[29]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1),g(" Missing Stickers ")]))):m("",!0)]),e("td",dr,[e("div",ur,a(((u=(d=s.delivery_request)==null?void 0:d.pick_up_region)==null?void 0:u.name)??"N/A"),1),e("div",cr,"→ "+a(((_=(c=s.delivery_request)==null?void 0:c.drop_off_region)==null?void 0:_.name)??"N/A"),1)]),e("td",mr,a(((x=(y=s.delivery_request)==null?void 0:y.packages)==null?void 0:x.length)||0),1),e("td",vr,a(U(Ae(((f=s.delivery_request)==null?void 0:f.packages)||[]))),1),e("td",gr,a(K(Se(((h=s.delivery_request)==null?void 0:h.packages)||[]))),1),e("td",pr,a(Ce(s.created_at)),1),e("td",_r,[z(re,{onClick:w=>je(s.id),size:"xs"},{default:j(()=>t[30]||(t[30]=[g(" Details ")])),_:2},1032,["onClick"])])],2)}),128))])])]),P.value.length===0?(i(),l("div",xr,t[31]||(t[31]=[e("div",{class:"text-gray-400 mb-4"},[e("svg",{class:"h-12 w-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1),e("p",{class:"text-gray-500"},"No deliveries ready for assignment",-1)]))):m("",!0)])])):v.value==="assigned"?(i(),l("div",fr,[e("div",hr,[e("div",yr,[e("table",br,[t[39]||(t[39]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Reference #"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Route"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned To"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Truck"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Manifest Status"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned At"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",kr,[(i(!0),l(F,null,X(nt.value,s=>{var o,d,u,c,_,y,x,f,h,w,A,M,S,T,C;return i(),l("tr",{key:s.id,class:$(["hover:bg-gray-50",{"bg-blue-50":(o=s.driver_truck_assignment)==null?void 0:o.has_finalized_manifest}])},[e("td",wr,[e("div",Cr,[t[32]||(t[32]=e("span",{class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-green-100 text-green-800"}," Ref ",-1)),e("span",Ar,a(((d=s.delivery_request)==null?void 0:d.reference_number)||`DR-${String(s.delivery_request_id||"").padStart(6,"0")}`),1)]),e("div",Sr,[g(" ID: DO-"+a(String(s.id||"").padStart(6,"0"))+" ",1),s.created_at?(i(),l("span",Dr," | Created: "+a(Ce(s.created_at)),1)):m("",!0)])]),e("td",Mr,[e("div",$r,a(((c=(u=s.delivery_request)==null?void 0:u.pick_up_region)==null?void 0:c.name)??"N/A"),1),e("div",Vr,"→ "+a(((y=(_=s.delivery_request)==null?void 0:_.drop_off_region)==null?void 0:y.name)??"N/A"),1)]),e("td",zr,[e("div",jr,[(x=s.driver_truck_assignment)!=null&&x.driver?(i(),l("div",qr,[e("span",Rr,a(he(s.driver_truck_assignment.driver.name)),1)])):(i(),l("div",Nr,t[33]||(t[33]=[e("span",{class:"text-gray-400 font-medium text-xs"},"??",-1)]))),e("div",Br,[e("div",Tr,a(((h=(f=s.driver_truck_assignment)==null?void 0:f.driver)==null?void 0:h.name)??"N/A"),1)])])]),e("td",Fr,[e("div",null,a(((A=(w=s.driver_truck_assignment)==null?void 0:w.truck)==null?void 0:A.license_plate)??"N/A"),1),e("div",Ir,a((M=s.driver_truck_assignment)!=null&&M.truck?`${s.driver_truck_assignment.truck.make} ${s.driver_truck_assignment.truck.model}`:"N/A"),1)]),e("td",Lr,[(S=s.driver_truck_assignment)!=null&&S.has_finalized_manifest?(i(),l("span",Wr,t[34]||(t[34]=[e("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})],-1),g(" Finalized ")]))):(i(),l("span",Pr,t[35]||(t[35]=[e("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})],-1),g(" Not Finalized ")])))]),e("td",Hr,a((T=s.driver_truck_assignment)!=null&&T.assigned_at?qe(s.driver_truck_assignment.assigned_at):"N/A"),1),e("td",Er,[e("div",Or,[z(re,{onClick:Z=>je(s.id),size:"xs"},{default:j(()=>t[36]||(t[36]=[g(" Details ")])),_:2},1032,["onClick"]),(C=s.driver_truck_assignment)!=null&&C.has_finalized_manifest?(i(),l("span",Ur,t[38]||(t[38]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-3 h-3 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z","clip-rule":"evenodd"})],-1),g(" Locked ")]))):(i(),ye(st,{key:0,onClick:Z=>yt(s),size:"xs",title:"Cancel Assignment"},{default:j(()=>t[37]||(t[37]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-3 h-3",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)])),_:2},1032,["onClick"]))])])],2)}),128))])])]),P.value.length===0?(i(),l("div",Kr,t[40]||(t[40]=[e("div",{class:"text-gray-400 mb-4"},[e("svg",{class:"h-12 w-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1),e("p",{class:"text-gray-500"},"No assigned deliveries found",-1)]))):m("",!0)])])):v.value==="active"?(i(),l("div",Gr,[e("div",Jr,[e("div",Qr,[e("table",Xr,[t[43]||(t[43]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Reference #"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Route"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Driver"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Truck"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Dispatched"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Est. Arrival"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",Yr,[(i(!0),l(F,null,X(P.value,s=>{var o,d,u,c,_,y,x,f,h,w,A,M,S,T;return i(),l("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",Zr,[e("div",ea,[t[41]||(t[41]=e("span",{class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-green-100 text-green-800"}," Ref ",-1)),e("span",ta,a(((o=s.delivery_request)==null?void 0:o.reference_number)||`DR-${String(s.delivery_request_id||"").padStart(6,"0")}`),1)]),e("div",sa,[g(" ID: DO-"+a(String(s.delivery_request_id||"").padStart(6,"0"))+" ",1),s.created_at?(i(),l("span",ra," | Created: "+a(Ce(s.created_at)),1)):m("",!0)])]),e("td",aa,[e("div",ia,a(((u=(d=s.delivery_request)==null?void 0:d.pick_up_region)==null?void 0:u.name)??"N/A"),1),e("div",la,"→ "+a(((_=(c=s.delivery_request)==null?void 0:c.drop_off_region)==null?void 0:_.name)??"N/A"),1)]),e("td",na,[e("div",oa,[e("div",da,[e("span",ua,a(he((x=(y=s.driver_truck_assignment)==null?void 0:y.driver)==null?void 0:x.name)),1)]),e("div",ca,[e("div",ma,a(((h=(f=s.driver_truck_assignment)==null?void 0:f.driver)==null?void 0:h.name)??"N/A"),1),e("div",va,a(((A=(w=s.driver_truck_assignment)==null?void 0:w.driver)==null?void 0:A.employee_id)??"N/A"),1)])])]),e("td",ga,[e("div",null,a(((S=(M=s.driver_truck_assignment)==null?void 0:M.truck)==null?void 0:S.license_plate)??"N/A"),1),e("div",pa,a((T=s.driver_truck_assignment)!=null&&T.truck?`${s.driver_truck_assignment.truck.make} ${s.driver_truck_assignment.truck.model}`:""),1)]),e("td",_a,a(qe(s.dispatched_at)),1),e("td",xa,a(qe(s.estimated_arrival)),1),e("td",fa,[z(re,{onClick:C=>je(s.id),size:"xs"},{default:j(()=>t[42]||(t[42]=[g(" Track ")])),_:2},1032,["onClick"])])])}),128))])])]),P.value.length===0?(i(),l("div",ha,t[44]||(t[44]=[e("div",{class:"text-gray-400 mb-4"},[e("svg",{class:"h-12 w-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1),e("p",{class:"text-gray-500"},"No active deliveries found",-1)]))):m("",!0)])])):m("",!0)],64)),e("div",ya,[e("div",ba,[e("div",ka,[e("div",wa,[e("div",Ca,[e("h3",Aa," Selected Deliveries ("+a(n.value.length)+") ",1),n.value.length>0?(i(),l("button",{key:0,onClick:We,class:"text-sm text-red-500 hover:text-red-700"}," Clear All ")):m("",!0)]),e("div",Sa,[n.value.length>0?(i(!0),l(F,{key:0},X(n.value,s=>{var o,d,u,c,_,y,x,f,h;return i(),l("div",{key:s.id,class:$(["p-3 border border-gray-200 rounded-lg hover:bg-gray-50",{"bg-yellow-50 border-yellow-200":ie(s),"bg-red-50 border-red-200":De(s)}])},[e("div",Da,[e("div",Ma,[e("div",$a,[t[45]||(t[45]=e("span",{class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-green-100 text-green-800"}," Ref ",-1)),e("span",Va,a(((o=s.delivery_request)==null?void 0:o.reference_number)||`DR-${(u=(d=s.delivery_request_id)==null?void 0:d.toString())==null?void 0:u.padStart(6,"0")}`),1)]),e("p",za,a((_=(c=s.delivery_request)==null?void 0:c.pick_up_region)==null?void 0:_.name)+" → "+a((x=(y=s.delivery_request)==null?void 0:y.drop_off_region)==null?void 0:x.name),1),e("div",ja,[e("p",null,"Vol: "+a(U(Ae(((f=s.delivery_request)==null?void 0:f.packages)||[]))),1),e("p",null,"Wt: "+a(K(Se(((h=s.delivery_request)==null?void 0:h.packages)||[]))),1)]),ie(s)?(i(),l("div",qa," ⚠️ Missing Stickers ")):m("",!0),De(s)?(i(),l("div",Ra," ⚠️ Region Mismatch ")):m("",!0)]),e("button",{onClick:w=>vt(s.id),class:"text-red-500 hover:text-red-700 ml-2"},t[46]||(t[46]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Na)])],2)}),128)):(i(),l("div",Ba,t[47]||(t[47]=[e("svg",{class:"h-8 w-8 mx-auto mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("p",{class:"text-sm"},"No deliveries selected",-1)])))]),n.value.length>0?(i(),l("div",Ta,[e("div",Fa,[t[48]||(t[48]=e("p",null,[e("strong",null,"Total Selected:")],-1)),e("p",null,"Volume: "+a(U(de.value)),1),e("p",null,"Weight: "+a(K(ue.value)),1),Be.value?(i(),l("div",Ia," ⚠️ Some packages are missing stickers ")):m("",!0),Te.value?(i(),l("div",La," ⚠️ Mixed assignment types (Regular + Backhaul) ")):m("",!0),ot.value?(i(),l("div",Wa," ⚠️ Region mismatch in assignments ")):m("",!0)])])):m("",!0)])]),e("div",Pa,[e("div",Ha,[e("div",Ea,[t[49]||(t[49]=e("h3",{class:"text-lg font-medium text-gray-900"}," Available Driver-Truck Sets ",-1)),e("div",Oa,[(i(!0),l(F,null,X(te.value,s=>(i(),l("button",{key:s.value,onClick:o=>Mt(s.value),class:$(["px-3 py-1 text-xs rounded border",J.value===s.value?"bg-blue-100 text-blue-800 border-blue-300":"bg-gray-100 text-gray-600 border-gray-300"])},a(s.label),11,Ua))),128))])]),e("div",Ka,[(i(!0),l(F,null,X(H.value,s=>{var o,d,u,c,_,y,x,f,h,w,A,M;return i(),l("div",{key:s.id,class:$(["border rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",((o=p.value)==null?void 0:o.id)===s.id?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 bg-white"]),onClick:S=>gt(s)},[e("div",Ja,[e("div",Qa,[e("div",{class:$(["flex-shrink-0 h-10 w-10 rounded-full flex items-center justify-center",s.available_for_backhaul?"bg-purple-100":"bg-gray-100"])},[e("span",{class:$(["text-sm font-medium",s.available_for_backhaul?"text-purple-800":"text-gray-600"])},a(((d=s.driver)==null?void 0:d.initials)||he((u=s.driver)==null?void 0:u.name)),3)],2),e("div",Xa,[e("div",Ya,a(((c=s.driver)==null?void 0:c.name)||"Driver"),1),s.has_finalized_manifest?(i(),l("div",Za,t[50]||(t[50]=[e("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 border border-blue-300"},[e("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})]),g(" Manifest Finalized ")],-1)]))):Ee(s)?(i(),l("div",ei,[e("span",ti,[t[51]||(t[51]=e("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)),g(" "+a(ht(s))+" assigned ",1)])])):m("",!0)])]),e("div",si,[s.available_for_backhaul?(i(),l("span",ri," Backhaul ")):m("",!0),Ee(s)?(i(),ye(be,{key:1,onClick:et(S=>xt(s),["stop"]),size:"xs",class:"mt-1"},{default:j(()=>t[52]||(t[52]=[e("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1),g(" Dispatch ")])),_:2},1032,["onClick"])):m("",!0)])]),e("div",ai,[e("div",ii,a(((_=s.truck)==null?void 0:_.license_plate)||"Truck"),1),e("div",li,a((y=s.truck)==null?void 0:y.make)+" "+a((x=s.truck)==null?void 0:x.model),1)]),e("div",ni,[e("div",null,[t[53]||(t[53]=e("div",{class:"text-gray-500 text-xs"},"Home Region",-1)),e("div",oi,a(((f=s.region)==null?void 0:f.name)||"N/A"),1)]),e("div",null,[t[54]||(t[54]=e("div",{class:"text-gray-500 text-xs"},"Current Region",-1)),e("div",{class:$(s.available_for_backhaul?"text-purple-600 font-medium":"font-medium")},a(((h=s.current_region)==null?void 0:h.name)||((w=s.region)==null?void 0:w.name)||"N/A"),3)])]),e("div",di,[e("div",null,[e("div",ui,[t[55]||(t[55]=e("span",null,"Volume Capacity",-1)),e("span",null,a(me(s))+"%",1)]),e("div",ci,[e("div",{class:$(["h-2 rounded-full",{"bg-green-500":me(s)<=60,"bg-yellow-500":me(s)>60&&me(s)<=85,"bg-red-500":me(s)>85}]),style:tt({width:`${me(s)}%`})},null,6)]),e("div",mi,a(U(s.current_volume||0))+" / "+a(U(((A=s.truck)==null?void 0:A.volume_capacity)||0)),1)]),e("div",null,[e("div",vi,[t[56]||(t[56]=e("span",null,"Weight Capacity",-1)),e("span",null,a(ve(s))+"%",1)]),e("div",gi,[e("div",{class:$(["h-2 rounded-full",{"bg-green-500":ve(s)<=60,"bg-yellow-500":ve(s)>60&&ve(s)<=85,"bg-red-500":ve(s)>85}]),style:tt({width:`${ve(s)}%`})},null,6)]),e("div",pi,a(K(s.current_weight||0))+" / "+a(K(((M=s.truck)==null?void 0:M.weight_capacity)||0)),1)])]),e("div",_i,[e("div",null,"Available Volume: "+a(U(s.available_volume||0)),1),e("div",null,"Available Weight: "+a(K(s.available_weight||0)),1)]),z(be,{onClick:et(S=>Pe(s),["stop"]),class:"w-full",disabled:!Ge(s)||n.value.length===0||s.has_finalized_manifest},{default:j(()=>[s.has_finalized_manifest?(i(),l(F,{key:0},[t[57]||(t[57]=e("svg",{class:"w-4 h-4 mr-1 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})],-1)),t[58]||(t[58]=g(" Manifest Finalized - Cannot Assign "))],64)):!Ge(s)&&n.value.length>0?(i(),l(F,{key:1},[g(" Cannot Assign - Capacity Issues ")],64)):n.value.length===0?(i(),l(F,{key:2},[g(" Assign Selected (0) ")],64)):(i(),l(F,{key:3},[g(" Assign Selected ("+a(n.value.length)+") ",1)],64))]),_:2},1032,["onClick","disabled"]),s.has_finalized_manifest?(i(),l("div",xi,t[59]||(t[59]=[e("p",{class:"text-xs text-blue-600"},"Ready for dispatch",-1)]))):m("",!0)],10,Ga)}),128))]),H.value.length===0?(i(),l("div",fi,[e("div",hi,[z(zt(Ft),{class:"h-12 w-12 mx-auto"})]),t[60]||(t[60]=e("p",{class:"text-gray-500"},"No available driver-truck sets found",-1))])):m("",!0)])])])]),B.value.data.length>0&&!D.value?(i(),l("div",yi,[e("div",bi,[e("button",{onClick:t[7]||(t[7]=s=>Le(B.value.current_page-1)),disabled:B.value.current_page<=1||D.value,class:"px-3 py-1 rounded border text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50"},"Previous",8,ki),e("span",null,"Page "+a(B.value.current_page)+" of "+a(B.value.last_page),1),e("button",{onClick:t[8]||(t[8]=s=>Le(B.value.current_page+1)),disabled:B.value.current_page>=B.value.last_page||D.value,class:"px-3 py-1 rounded border text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50"},"Next",8,wi)])])):m("",!0)],64))]),z(Bt,{show:k.value,onClose:pt,onConfirmed:_t,title:"Confirm Batch Assignment","confirm-text":"Assign Deliveries","confirm-disabled":!E.value.isValid,variant:"primary",size:"lg"},{default:j(()=>{var s,o,d,u,c,_,y,x,f,h,w,A,M,S,T;return[e("div",Ci,[e("div",{class:$(["p-3 rounded-lg border",{"border-green-200 bg-green-50 text-green-800":E.value.isValid,"border-red-200 bg-red-50 text-red-800":!E.value.isValid}])},[e("div",Ai,[e("div",Si,[E.value.isValid?(i(),l("svg",Di,t[61]||(t[61]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))):(i(),l("svg",Mi,t[62]||(t[62]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"},null,-1)])))]),e("div",$i,[e("p",Vi,a(E.value.message),1),E.value.details&&E.value.details.length>0?(i(),l("ul",zi,[(i(!0),l(F,null,X(E.value.details,C=>(i(),l("li",{key:C,class:"flex items-start"},[t[63]||(t[63]=e("span",{class:"mr-2"},"•",-1)),e("span",null,a(C),1)]))),128))])):m("",!0)])])],2),e("div",ji,[e("div",qi,[t[69]||(t[69]=e("h3",{class:"text-sm font-medium text-gray-900 mb-2 flex items-center"},[e("svg",{class:"h-4 w-4 mr-1.5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})]),g(" Capacity Check ")],-1)),e("div",Ri,[e("div",Ni,[t[64]||(t[64]=e("span",{class:"text-gray-600"},"Volume:",-1)),e("span",Bi,a(U(de.value)),1)]),e("div",Ti,[t[65]||(t[65]=e("span",{class:"text-gray-600"},"Available:",-1)),e("span",{class:$(de.value>E.value.availableVolume?"text-red-600":"text-green-600")},a(U(E.value.availableVolume||0)),3)]),t[68]||(t[68]=e("div",{class:"border-t pt-2 mt-2"},null,-1)),e("div",Fi,[t[66]||(t[66]=e("span",{class:"text-gray-600"},"Weight:",-1)),e("span",Ii,a(K(ue.value)),1)]),e("div",Li,[t[67]||(t[67]=e("span",{class:"text-gray-600"},"Available:",-1)),e("span",{class:$(ue.value>E.value.availableWeight?"text-red-600":"text-green-600")},a(K(E.value.availableWeight||0)),3)])])]),e("div",Wi,[t[70]||(t[70]=e("h3",{class:"text-sm font-medium text-gray-900 mb-2 flex items-center"},[e("svg",{class:"h-4 w-4 mr-1.5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})]),g(" Driver-Truck Set ")],-1)),e("div",Pi,[e("div",{class:$(["flex-shrink-0 h-10 w-10 rounded-full flex items-center justify-center",(s=p.value)!=null&&s.available_for_backhaul?"bg-purple-100":"bg-gray-100"])},[e("span",{class:$(["text-sm font-medium",(o=p.value)!=null&&o.available_for_backhaul?"text-purple-800":"text-gray-600"])},a(((u=(d=p.value)==null?void 0:d.driver)==null?void 0:u.initials)||he((_=(c=p.value)==null?void 0:c.driver)==null?void 0:_.name)),3)],2),e("div",Hi,[e("p",Ei,a(((x=(y=p.value)==null?void 0:y.driver)==null?void 0:x.name)??"N/A"),1),e("p",Oi,a(((h=(f=p.value)==null?void 0:f.truck)==null?void 0:h.license_plate)??"N/A"),1),e("div",Ui,[e("span",Ki,a((A=(w=p.value)==null?void 0:w.truck)==null?void 0:A.make)+" "+a((S=(M=p.value)==null?void 0:M.truck)==null?void 0:S.model),1),(T=p.value)!=null&&T.available_for_backhaul?(i(),l("span",Gi," Backhaul ")):m("",!0)]),e("div",Ji,[e("span",{class:$(["text-xs px-1.5 py-0.5 rounded",At(p.value)])},a(Ue(p.value))+"% capacity ",3)])])])])]),e("div",Qi,[e("div",Xi,[e("h3",Yi,[t[71]||(t[71]=e("svg",{class:"h-4 w-4 mr-1.5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1)),g(" Selected Deliveries ("+a(n.value.length)+") ",1)])]),e("div",Zi,[(i(!0),l(F,null,X(n.value,C=>{var Z,se,O,le,Me,$e,Ve;return i(),l("div",{key:C.id,class:"px-3 py-2 border-b last:border-b-0 hover:bg-gray-50"},[e("div",el,[e("div",tl,[e("div",sl,[t[72]||(t[72]=e("span",{class:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-semibold bg-green-100 text-green-800"}," Ref ",-1)),e("span",rl,a(((Z=C.delivery_request)==null?void 0:Z.reference_number)||`DR-${String(C.delivery_request_id||"").padStart(6,"0")}`),1)]),e("p",al,a(((O=(se=C.delivery_request)==null?void 0:se.pick_up_region)==null?void 0:O.name)??"N/A")+" → "+a(((Me=(le=C.delivery_request)==null?void 0:le.drop_off_region)==null?void 0:Me.name)??"N/A"),1),e("div",il,[e("span",null,"Vol: "+a(U(Ae((($e=C.delivery_request)==null?void 0:$e.packages)||[]))),1),e("span",null,"Wt: "+a(K(Se(((Ve=C.delivery_request)==null?void 0:Ve.packages)||[]))),1)])]),e("div",ll,[ie(C)?(i(),l("span",nl," ⚠️ ")):m("",!0),De(C)?(i(),l("span",ol," ❌ ")):m("",!0)])])])}),128))])]),t[73]||(t[73]=e("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-3"},[e("h3",{class:"text-sm font-medium text-blue-900 mb-2 flex items-center"},[e("svg",{class:"h-4 w-4 mr-1.5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),g(" Estimated Timeline ")]),e("div",{class:"text-xs text-blue-700 space-y-1"},[e("p",null,"• Departure: Within 1 hour of assignment"),e("p",null,"• Estimated arrival: Calculated based on route distance"),e("p",null,"• Delivery completion: Within 24-48 hours")])],-1))])]}),_:1},8,["show","confirm-disabled"]),z(lt,{show:!!N.value,onClose:Oe,"max-width":"md"},{default:j(()=>{var s,o,d,u,c,_,y,x,f,h,w,A,M,S,T;return[e("div",dl,[t[84]||(t[84]=e("h2",{class:"text-lg font-medium text-gray-900"},"Cancel Delivery Assignment",-1)),t[85]||(t[85]=e("p",{class:"mt-1 text-sm text-gray-600"}," Are you sure you want to cancel this delivery assignment? ",-1)),e("div",ul,[e("div",cl,[t[79]||(t[79]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e("div",ml,[t[78]||(t[78]=e("h3",{class:"text-sm font-medium text-red-800"},"Delivery Information",-1)),e("div",vl,[e("p",null,[t[74]||(t[74]=e("strong",null,"Reference:",-1)),g(" "+a(((o=(s=N.value)==null?void 0:s.delivery_request)==null?void 0:o.reference_number)||`DR-${String(((d=N.value)==null?void 0:d.delivery_request_id)||"").padStart(6,"0")}`),1)]),e("p",null,[t[75]||(t[75]=e("strong",null,"Route:",-1)),g(" "+a((_=(c=(u=N.value)==null?void 0:u.delivery_request)==null?void 0:c.pick_up_region)==null?void 0:_.name)+" → "+a((f=(x=(y=N.value)==null?void 0:y.delivery_request)==null?void 0:x.drop_off_region)==null?void 0:f.name),1)]),e("p",null,[t[76]||(t[76]=e("strong",null,"Driver:",-1)),g(" "+a(((A=(w=(h=N.value)==null?void 0:h.driver_truck_assignment)==null?void 0:w.driver)==null?void 0:A.name)||"N/A"),1)]),e("p",null,[t[77]||(t[77]=e("strong",null,"Truck:",-1)),g(" "+a(((T=(S=(M=N.value)==null?void 0:M.driver_truck_assignment)==null?void 0:S.truck)==null?void 0:T.license_plate)||"N/A"),1)])])])])]),e("div",gl,[t[80]||(t[80]=e("label",{for:"cancellation_reason",class:"block text-sm font-medium text-gray-700"},"Reason for Cancellation",-1)),jt(e("textarea",{id:"cancellation_reason","onUpdate:modelValue":t[9]||(t[9]=C=>W.value=C),rows:"3",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Enter reason for cancellation...",required:""},null,512),[[qt,W.value]]),t[81]||(t[81]=e("p",{class:"mt-1 text-xs text-gray-500"},"This reason will be recorded in the delivery history.",-1))]),e("div",pl,[z(re,{onClick:Oe},{default:j(()=>t[82]||(t[82]=[g(" Cancel ")])),_:1}),z(st,{onClick:bt,disabled:!W.value.trim(),loading:q.value},{default:j(()=>t[83]||(t[83]=[g(" Confirm Cancellation ")])),_:1},8,["disabled","loading"])])])]}),_:1},8,["show"]),z(vs,{show:ge.value,set:ae.value,onClose:He,onDispatched:ft},null,8,["show","set"])]),_:1}))}};export{Ml as default};
