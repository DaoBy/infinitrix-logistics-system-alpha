import{g as z,h as Te,j as Xe,d as ze,o as r,w as $,b as e,t as o,c as i,e as c,f as M,k as Ne,a as k,n as f,F as Y,r as J,W as ae,i as N,s as Be}from"./app-BRlF4EhB.js";import{E as gt}from"./EmployeeLayout-C1kqUmLf.js";import{_ as vt}from"./DataTable-C6KofKRH.js";import{P as mt}from"./Pagination-DEiiLFx0.js";import{S as je}from"./SelectInput-frmwb_XR.js";import{_ as pt}from"./SearchInput-Bk70t47v.js";import{_ as Ve}from"./PrimaryButton-D8Y0EbxS.js";import{_ as he}from"./SecondaryButton-BSdBhKLO.js";import{D as _t}from"./DangerButton-dJovAgRZ.js";import{_ as kt}from"./StatusBadge-BdVxzSf5.js";import{_ as ht,a as Qe}from"./ConfirmationModal-zOQK7IGq.js";import{L as qe}from"./LoadingSpinner-jAd42QGr.js";import{M as bt}from"./Modal-CyNUxeX5.js";import{_ as ft}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./NavLink-CmY0AIOJ.js";const xt={class:"p-6"},yt={class:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 mb-6"},wt={class:"flex items-center space-x-4"},$t={class:"flex-1"},Ct={class:"flex items-center space-x-3"},At={class:"h-12 w-12 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center"},Mt={class:"text-blue-600 dark:text-blue-300 font-medium text-sm"},St={class:"font-medium text-gray-900 dark:text-gray-100"},Dt={class:"text-sm text-gray-500 dark:text-gray-400"},Bt={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200 mt-1"},zt={class:"flex-1"},Vt={class:"flex items-center space-x-3"},Nt={class:"font-medium text-gray-900 dark:text-gray-100"},Ft={class:"text-sm text-gray-500 dark:text-gray-400"},jt={class:"mt-4 grid grid-cols-2 gap-4 text-sm"},Tt={class:"font-medium"},qt={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-1"},Rt={class:"font-medium"},Pt={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-1"},It={class:"mb-6"},Lt={key:0,class:"flex items-center justify-center py-8"},Ot={key:1,class:"space-y-3"},Wt={class:"flex items-center"},Ht={key:0,class:"w-5 h-5 text-green-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ut={key:1,class:"w-5 h-5 text-red-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Et={class:"flex items-center"},Gt={key:0,class:"w-5 h-5 text-green-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Yt={key:1,class:"w-5 h-5 text-red-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Jt={class:"flex items-center"},Kt={key:0,class:"w-5 h-5 text-green-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Qt={key:1,class:"w-5 h-5 text-red-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Xt={class:"flex items-center"},Zt={key:0,class:"w-5 h-5 text-green-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},es={key:1,class:"w-5 h-5 text-red-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ts={class:"flex items-center"},ss={key:0,class:"w-5 h-5 text-green-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},as={key:1,class:"w-5 h-5 text-red-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ls={class:"flex items-center"},rs={key:0,class:"w-5 h-5 text-green-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},is={key:1,class:"w-5 h-5 text-red-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},os={class:"flex items-center"},ns={key:0,class:"w-6 h-6 text-green-500 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ds={key:1,class:"w-6 h-6 text-red-500 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},us={key:0,class:"mt-3"},cs={class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3"},gs={class:"text-sm text-red-700 dark:text-red-300 space-y-2"},vs={key:0},ms={key:1},ps={class:"text-xs mt-1"},_s={key:1,class:"mt-3"},ks={class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3"},hs={class:"text-sm text-red-700 dark:text-red-300 list-disc list-inside space-y-1"},bs={key:2,class:"mt-3"},fs={class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3"},xs={class:"text-sm text-red-700 dark:text-red-300 list-disc list-inside space-y-1"},ys={key:3,class:"mt-3"},ws={class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3"},$s={class:"text-sm text-red-700 dark:text-red-300 list-disc list-inside space-y-1"},Cs={key:4,class:"mt-3"},As={class:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3"},Ms={class:"text-sm text-yellow-700 dark:text-yellow-300 list-disc list-inside space-y-1"},Ss={key:5,class:"mt-3"},Ds={class:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3"},Bs={class:"grid grid-cols-2 gap-4 text-sm"},zs={class:"font-medium"},Vs={class:"font-medium"},Ns={key:0,class:"mt-2"},Fs={class:"text-xs text-blue-600 dark:text-blue-400"},js={class:"flex justify-end space-x-3"},Ts={key:0,class:"flex items-center"},qs={key:1},Rs={__name:"DispatchModal",props:{show:{type:Boolean,default:!1},set:{type:Object,default:null}},emits:["close","dispatched"],setup(x,{emit:h}){const A=x,K=h,n=z({can_dispatch:!1,has_assigned_orders:!1,assigned_orders_count:0,truck_available:!1,driver_available:!1,waybills_complete:!1,stickers_complete:!1,manifest_complete:!1,missing_waybills:[],unstickerized_packages:[],errors:[],warnings:[],message:"",total_volume:0,total_weight:0,capacity_percentage:0,manifest_check:null}),q=z(!1),R=z(!1),v=()=>{K("close")},m=async()=>{var y;if(!(!((y=A.set)!=null&&y.id)||!n.value.can_dispatch)){R.value=!0;try{await ae.post(route("cargo-assignments.dispatch.driver-truck-set",A.set.id),{},{onSuccess:()=>{K("dispatched"),v()},onError:l=>{console.error("Dispatch failed:",l),alert("Dispatch failed. Please check the requirements and try again.")},onFinish:()=>{R.value=!1}})}catch(l){console.error("Dispatch error:",l),R.value=!1,alert("An error occurred during dispatch. Please try again.")}}},P=async()=>{var y,l,Z,Q,I;if((y=A.set)!=null&&y.id){q.value=!0;try{const U=await fetch(route("cargo-assignments.dispatch.validate",A.set.id));if(!U.ok)throw new Error(`HTTP error! status: ${U.status}`);const b=await U.json(),te=b.manifest_check||{},ie=te.has_manifest&&te.manifest_valid;n.value={can_dispatch:b.is_valid||!1,has_assigned_orders:b.assigned_orders_count>0,assigned_orders_count:b.assigned_orders_count||0,truck_available:!((l=b.errors)!=null&&l.some(se=>se.includes("Truck"))),driver_available:!((Z=b.errors)!=null&&Z.some(se=>se.includes("Driver"))),waybills_complete:(((Q=b.missing_waybills)==null?void 0:Q.length)||0)===0,stickers_complete:(((I=b.unstickerized_packages)==null?void 0:I.length)||0)===0,manifest_complete:ie,missing_waybills:b.missing_waybills||[],unstickerized_packages:b.unstickerized_packages||[],errors:b.errors||[],warnings:b.warnings||[],message:b.message||"",total_volume:b.total_volume||0,total_weight:b.total_weight||0,capacity_percentage:b.capacity_percentage||0,manifest_check:te}}catch(U){console.error("Validation error:",U),n.value={can_dispatch:!1,has_assigned_orders:!1,assigned_orders_count:0,truck_available:!1,driver_available:!1,waybills_complete:!1,stickers_complete:!1,manifest_complete:!1,missing_waybills:[],unstickerized_packages:[],errors:["Failed to validate dispatch requirements: "+U.message],warnings:[],message:"Failed to validate dispatch requirements",total_volume:0,total_weight:0,capacity_percentage:0,manifest_check:null}}finally{q.value=!1}}};return Te(()=>A.show,y=>{var l;y&&((l=A.set)!=null&&l.id)&&P()}),Te(()=>A.set,y=>{A.show&&(y!=null&&y.id)&&P()}),Xe(()=>{var y;A.show&&((y=A.set)!=null&&y.id)&&P()}),(y,l)=>(r(),ze(bt,{show:x.show,"max-width":"2xl",onClose:v},{default:$(()=>{var Z,Q,I,U,b,te,ie,se,ee,be,fe,ve,oe,xe,le,re,ne,de,me,ye,W,we,ue,$e,ce,Ce,Ae,pe,_e,Me,ke;return[e("div",xt,[e("div",{class:"flex items-center justify-between mb-4"},[l[1]||(l[1]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-gray-100"}," Dispatch Driver-Truck Set ",-1)),e("button",{onClick:v,class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},l[0]||(l[0]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",yt,[e("div",wt,[e("div",$t,[e("div",Ct,[e("div",At,[e("span",Mt,o(((Q=(Z=x.set)==null?void 0:Z.driver)==null?void 0:Q.initials)||"DR"),1)]),e("div",null,[e("p",St,o(((U=(I=x.set)==null?void 0:I.driver)==null?void 0:U.name)||"N/A"),1),e("p",Dt,o(((te=(b=x.set)==null?void 0:b.driver)==null?void 0:te.employee_id)||""),1),(ie=x.set)!=null&&ie.available_for_backhaul?(r(),i("span",Bt,l[2]||(l[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z","clip-rule":"evenodd"})],-1),M(" Backhaul Assignment ")]))):c("",!0)])])]),e("div",zt,[e("div",Vt,[l[3]||(l[3]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-indigo-500",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1 1 0 11-3 0 1 1 0 013 0z"}),e("path",{d:"M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1v-1a1 1 0 011-1h2a1 1 0 011 1v1a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H19a1 1 0 001-1V5a1 1 0 00-1-1H3z"})],-1)),e("div",null,[e("p",Nt,o(((ee=(se=x.set)==null?void 0:se.truck)==null?void 0:ee.license_plate)||"N/A"),1),e("p",Ft,o(((fe=(be=x.set)==null?void 0:be.truck)==null?void 0:fe.make)||"")+" "+o(((oe=(ve=x.set)==null?void 0:ve.truck)==null?void 0:oe.model)||""),1)])])])]),e("div",jt,[e("div",null,[l[4]||(l[4]=e("p",{class:"text-gray-600 dark:text-gray-400"},"Current Volume",-1)),e("p",Tt,o((((xe=x.set)==null?void 0:xe.current_volume)||0).toFixed(2))+" / "+o(((re=(le=x.set)==null?void 0:le.truck)==null?void 0:re.volume_capacity)||0)+" mÂ³",1),e("div",qt,[e("div",{class:"bg-blue-600 h-2 rounded-full",style:Ne({width:`${Math.min(100,(((ne=x.set)==null?void 0:ne.current_volume)||0)/(((me=(de=x.set)==null?void 0:de.truck)==null?void 0:me.volume_capacity)||1)*100)}%`})},null,4)])]),e("div",null,[l[5]||(l[5]=e("p",{class:"text-gray-600 dark:text-gray-400"},"Current Weight",-1)),e("p",Rt,o((((ye=x.set)==null?void 0:ye.current_weight)||0).toFixed(2))+" / "+o(((we=(W=x.set)==null?void 0:W.truck)==null?void 0:we.weight_capacity)||0)+" kg",1),e("div",Pt,[e("div",{class:"bg-green-600 h-2 rounded-full",style:Ne({width:`${Math.min(100,(((ue=x.set)==null?void 0:ue.current_weight)||0)/(((ce=($e=x.set)==null?void 0:$e.truck)==null?void 0:ce.weight_capacity)||1)*100)}%`})},null,4)])])])]),e("div",It,[l[36]||(l[36]=e("h4",{class:"text-md font-medium text-gray-900 dark:text-gray-100 mb-3"}," Dispatch Requirements ",-1)),q.value?(r(),i("div",Lt,[k(qe,{size:"lg",class:"mr-3"}),l[6]||(l[6]=e("span",{class:"text-gray-600 dark:text-gray-400"},"Validating dispatch requirements...",-1))])):(r(),i("div",Ot,[e("div",{class:f(["flex items-center justify-between p-3 border rounded-lg",n.value.has_assigned_orders?"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20":"border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-900/20"])},[e("div",Wt,[n.value.has_assigned_orders?(r(),i("svg",Ht,l[7]||(l[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(r(),i("svg",Ut,l[8]||(l[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)]))),l[9]||(l[9]=e("span",{class:"font-medium"},"Assigned Deliveries",-1))]),e("span",{class:f(["text-sm",n.value.has_assigned_orders?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"])},o(n.value.has_assigned_orders?`${n.value.assigned_orders_count} orders`:"No orders"),3)],2),e("div",{class:f(["flex items-center justify-between p-3 border rounded-lg",n.value.truck_available?"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20":"border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-900/20"])},[e("div",Et,[n.value.truck_available?(r(),i("svg",Gt,l[10]||(l[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(r(),i("svg",Yt,l[11]||(l[11]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)]))),l[12]||(l[12]=e("span",{class:"font-medium"},"Truck Available",-1))]),e("span",{class:f(["text-sm",n.value.truck_available?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"])},o(n.value.truck_available?"Available":"Unavailable"),3)],2),e("div",{class:f(["flex items-center justify-between p-3 border rounded-lg",n.value.driver_available?"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20":"border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-900/20"])},[e("div",Jt,[n.value.driver_available?(r(),i("svg",Kt,l[13]||(l[13]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(r(),i("svg",Qt,l[14]||(l[14]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)]))),l[15]||(l[15]=e("span",{class:"font-medium"},"Driver Available",-1))]),e("span",{class:f(["text-sm",n.value.driver_available?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"])},o(n.value.driver_available?"Available":"Unavailable"),3)],2),e("div",{class:f(["flex items-center justify-between p-3 border rounded-lg",n.value.waybills_complete?"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20":"border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-900/20"])},[e("div",Xt,[n.value.waybills_complete?(r(),i("svg",Zt,l[16]||(l[16]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(r(),i("svg",es,l[17]||(l[17]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)]))),l[18]||(l[18]=e("span",{class:"font-medium"},"Waybills Generated",-1))]),e("span",{class:f(["text-sm",n.value.waybills_complete?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"])},o(n.value.waybills_complete?"Complete":`${((Ce=n.value.missing_waybills)==null?void 0:Ce.length)||0} missing`),3)],2),e("div",{class:f(["flex items-center justify-between p-3 border rounded-lg",n.value.stickers_complete?"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20":"border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-900/20"])},[e("div",ts,[n.value.stickers_complete?(r(),i("svg",ss,l[19]||(l[19]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(r(),i("svg",as,l[20]||(l[20]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)]))),l[21]||(l[21]=e("span",{class:"font-medium"},"Package Stickers",-1))]),e("span",{class:f(["text-sm",n.value.stickers_complete?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"])},o(n.value.stickers_complete?"Complete":`${((Ae=n.value.unstickerized_packages)==null?void 0:Ae.length)||0} missing`),3)],2),e("div",{class:f(["flex items-center justify-between p-3 border rounded-lg",n.value.manifest_complete?"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20":"border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-900/20"])},[e("div",ls,[n.value.manifest_complete?(r(),i("svg",rs,l[22]||(l[22]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(r(),i("svg",is,l[23]||(l[23]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)]))),l[24]||(l[24]=e("span",{class:"font-medium"},"Manifest Finalized",-1))]),e("span",{class:f(["text-sm",n.value.manifest_complete?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"])},o(n.value.manifest_complete?"Complete":"Missing or invalid"),3)],2),e("div",{class:f(["mt-4 p-4 rounded-lg",n.value.can_dispatch?"bg-green-50 border border-green-200 dark:bg-green-900/20 dark:border-green-800":"bg-red-50 border border-red-200 dark:bg-red-900/20 dark:border-red-800"])},[e("div",os,[n.value.can_dispatch?(r(),i("svg",ns,l[25]||(l[25]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))):(r(),i("svg",ds,l[26]||(l[26]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))),e("div",null,[e("p",{class:f(["font-medium",n.value.can_dispatch?"text-green-800 dark:text-green-200":"text-red-800 dark:text-red-200"])},o(n.value.can_dispatch?"Ready to Dispatch":"Cannot Dispatch"),3),e("p",{class:f(["text-sm mt-1",n.value.can_dispatch?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"])},o(n.value.message||"All requirements must be met before dispatch"),3)])])],2),n.value.manifest_check&&!n.value.manifest_complete?(r(),i("div",us,[l[28]||(l[28]=e("p",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Manifest Issues:",-1)),e("div",cs,[e("div",gs,[n.value.manifest_check.has_manifest?n.value.manifest_check.manifest_valid?c("",!0):(r(),i("div",ms,[e("p",null,"âŒ Manifest is missing "+o(n.value.manifest_check.missing_package_count)+" packages from current assignments.",1),e("p",ps,"Manifest ID: "+o(n.value.manifest_check.manifest_id),1)])):(r(),i("div",vs,l[27]||(l[27]=[e("p",null,"âŒ No finalized manifest found for this driver-truck set.",-1)])))])])])):c("",!0),((pe=n.value.missing_waybills)==null?void 0:pe.length)>0?(r(),i("div",_s,[l[29]||(l[29]=e("p",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Missing Waybills:",-1)),e("div",ks,[e("ul",hs,[(r(!0),i(Y,null,J(n.value.missing_waybills,F=>(r(),i("li",{key:F}," Delivery Order DO-"+o(F.toString().padStart(6,"0")),1))),128))])])])):c("",!0),((_e=n.value.unstickerized_packages)==null?void 0:_e.length)>0?(r(),i("div",bs,[l[30]||(l[30]=e("p",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Packages Missing Stickers:",-1)),e("div",fs,[e("ul",xs,[(r(!0),i(Y,null,J(n.value.unstickerized_packages,F=>(r(),i("li",{key:F.package_id}," Package "+o(F.item_code)+" (DO-"+o(F.delivery_order_id)+") ",1))),128))])])])):c("",!0),((Me=n.value.errors)==null?void 0:Me.length)>0?(r(),i("div",ys,[l[31]||(l[31]=e("p",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Validation Errors:",-1)),e("div",ws,[e("ul",$s,[(r(!0),i(Y,null,J(n.value.errors,F=>(r(),i("li",{key:F},o(F),1))),128))])])])):c("",!0),((ke=n.value.warnings)==null?void 0:ke.length)>0?(r(),i("div",Cs,[l[32]||(l[32]=e("p",{class:"text-sm font-medium text-yellow-700 dark:text-yellow-300 mb-2"},"Warnings:",-1)),e("div",As,[e("ul",Ms,[(r(!0),i(Y,null,J(n.value.warnings,F=>(r(),i("li",{key:F},o(F),1))),128))])])])):c("",!0),n.value.total_volume>0||n.value.total_weight>0?(r(),i("div",Ss,[l[35]||(l[35]=e("p",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Load Information:",-1)),e("div",Ds,[e("div",Bs,[e("div",null,[l[33]||(l[33]=e("p",{class:"text-blue-700 dark:text-blue-300"},"Total Volume",-1)),e("p",zs,o(n.value.total_volume.toFixed(2))+" mÂ³",1)]),e("div",null,[l[34]||(l[34]=e("p",{class:"text-blue-700 dark:text-blue-300"},"Total Weight",-1)),e("p",Vs,o(n.value.total_weight.toFixed(2))+" kg",1)])]),n.value.capacity_percentage>0?(r(),i("div",Ns,[e("p",Fs," Capacity Utilization: "+o(n.value.capacity_percentage.toFixed(1))+"% ",1)])):c("",!0)])])):c("",!0)]))]),e("div",js,[k(he,{onClick:v,disabled:R.value},{default:$(()=>l[37]||(l[37]=[M(" Cancel ")])),_:1},8,["disabled"]),k(Ve,{onClick:m,disabled:!n.value.can_dispatch||R.value,class:"min-w-32"},{default:$(()=>[R.value?(r(),i("span",Ts,[k(qe,{size:"sm",class:"mr-2"}),l[38]||(l[38]=M(" Dispatching... "))])):(r(),i("span",qs," Confirm Dispatch "))]),_:1},8,["disabled"])])])]}),_:1},8,["show"]))}},Ps=ft(Rs,[["__scopeId","data-v-26476dd8"]]),Is={class:"flex justify-between items-center px-6"},Ls={class:"flex space-x-2"},Os={key:0,class:"px-6 py-2"},Ws={class:"px-6 py-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600"},Hs={class:"flex flex-row items-center gap-4"},Us={class:"flex-1 flex flex-row items-center gap-4"},Es={class:"px-6 py-4"},Gs={class:"bg-white dark:bg-gray-800 shadow-sm rounded-lg border border-gray-200 dark:border-gray-700 mb-6"},Ys={class:"p-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"},Js={class:"text-sm text-gray-500 dark:text-gray-400"},Ks={class:"flex items-center space-x-2"},Qs={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"},Xs={class:"flex flex-col items-center"},Zs={key:0,class:"text-yellow-500",title:"Some packages are missing stickers"},ea={class:"flex items-center"},ta={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"},sa={key:1,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"},aa={class:"flex space-x-1"},la={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ra={class:"lg:col-span-1"},ia={class:"bg-white dark:bg-gray-800 shadow-sm rounded-lg border border-gray-200 dark:border-gray-700"},oa={class:"p-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-700"},na={class:"flex justify-between items-center"},da={class:"font-medium text-gray-900 dark:text-gray-100"},ua={class:"divide-y divide-gray-200 dark:divide-gray-700 max-h-96 overflow-y-auto"},ca={class:"flex justify-between items-start"},ga={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},va={key:0,class:"ml-1 inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800"},ma={class:"text-xs text-gray-500 dark:text-gray-400"},pa={class:"mt-1 text-xs"},_a={key:0,class:"text-yellow-600 dark:text-yellow-400 flex items-center"},ka=["onClick"],ha={key:1,class:"p-4 text-center text-gray-500 dark:text-gray-400"},ba={key:0,class:"p-4 border-t border-gray-200 dark:border-gray-700"},fa={class:"text-sm"},xa={key:0,class:"text-yellow-600 dark:text-yellow-400 font-medium"},ya={key:1,class:"text-red-600 dark:text-red-400 font-medium"},wa={key:2,class:"text-red-600 dark:text-red-400 font-medium"},$a={class:"lg:col-span-2"},Ca={class:"bg-white dark:bg-gray-800 shadow-sm rounded-lg border border-gray-200 dark:border-gray-700"},Aa={class:"p-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-700"},Ma={class:"font-medium text-gray-900 dark:text-gray-100"},Sa={class:"mt-2 flex space-x-2"},Da=["onClick"],Ba={class:"p-4"},za={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Va=["onClick"],Na={class:"flex items-start space-x-3"},Fa={class:"flex-1"},ja={class:"flex items-center space-x-2"},Ta={class:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center"},qa={class:"text-gray-600 dark:text-gray-300 font-medium"},Ra={class:"font-medium"},Pa={class:"text-xs text-gray-500 dark:text-gray-400"},Ia={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200 mt-1"},La={class:"mt-2 text-xs"},Oa={key:0,class:"text-purple-600"},Wa={key:1,class:"text-blue-600"},Ha={class:"flex-1"},Ua={class:"flex items-center space-x-2"},Ea={class:"font-medium"},Ga={class:"text-xs text-gray-500 dark:text-gray-400"},Ya={key:0,class:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800 mt-1"},Ja={class:"mt-2 space-y-2"},Ka={class:"text-xs"},Qa={class:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5"},Xa={class:"text-xs"},Za={class:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5"},el={key:0,class:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700"},tl={key:0},sl={key:1},al={key:1,class:"p-4 text-center text-gray-500 dark:text-gray-400"},ll={class:"mt-8 bg-white dark:bg-gray-800 shadow-sm rounded-lg border border-gray-200 dark:border-gray-700"},rl={class:"p-4"},il={key:0,class:"space-y-4"},ol={class:"flex justify-between items-start"},nl={class:"font-medium"},dl={class:"text-sm text-gray-600 dark:text-gray-400"},ul={class:"text-sm mt-2"},cl={key:0,class:"text-purple-600 dark:text-purple-400 text-sm mt-1"},gl={key:1,class:"text-yellow-600 dark:text-yellow-400 text-sm mt-1"},vl={key:0,class:"mt-4"},ml={class:"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2"},pl=["onClick"],_l={class:"font-medium"},kl={class:"text-xs"},hl={class:"text-xs"},bl={class:"text-xs text-gray-500"},fl={key:0,class:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800 mt-1"},xl={key:1,class:"mt-4 text-sm text-yellow-600"},yl={key:1,class:"text-center text-gray-500 dark:text-gray-400"},wl={class:"space-y-4"},$l={class:"font-medium"},Cl={key:0,class:"mt-2 list-disc list-inside"},Al={class:"grid grid-cols-2 gap-4"},Ml={class:"text-lg"},Sl={class:"text-xs"},Dl={class:"text-lg"},Bl={class:"text-xs"},zl={class:"border-t pt-4"},Vl={class:"space-y-2 max-h-32 overflow-y-auto"},Nl={key:0,class:"text-purple-600"},Fl={class:"border-t pt-4"},jl={class:"flex items-center space-x-3"},Tl={class:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center"},ql={class:"text-gray-600 dark:text-gray-300 font-medium"},Rl={class:"font-medium"},Pl={class:"text-xs text-gray-500"},Il={key:0,class:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800 mt-1"},sr={__name:"Index",props:{deliveries:Object,driverTruckSets:{type:Array,default:()=>[]},batchSuggestions:{type:Array,default:()=>[]},regions:{type:Array,default:()=>[]},flash:Object,filters:Object},setup(x){var We,He,Ue,Ee;const h=x,A=z(((We=h.filters)==null?void 0:We.search)||""),K=z(((He=h.filters)==null?void 0:He.status)||""),n=z(((Ue=h.filters)==null?void 0:Ue.region)||""),q=z(((Ee=h.filters)==null?void 0:Ee.backhaul)||""),R=z("all"),v=z([]),m=z(null),P=z(!1),y=z(!1),l=z(!1),Z=z(null),Q=z(null),I=z(null),U=[{value:"",label:"All Backhaul Status"},{value:"backhaul",label:"Backhaul Only"},{value:"regular",label:"Regular Only"}],b=[{value:"all",label:"All Types"},{value:"regular",label:"Regular"},{value:"backhaul",label:"Backhaul"}],te=[{value:"",label:"All Statuses"},{value:"pending",label:"Pending"},{value:"assigned",label:"Assigned"},{value:"picked_up",label:"Picked Up"},{value:"in_transit",label:"In Transit"},{value:"delivered",label:"Delivered"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],ie=N(()=>{var s;return[{value:"",label:"All Regions"},...((s=h.regions)==null?void 0:s.map(t=>({value:t.id,label:t.name})))||[]]}),se=N(()=>{var s,t,d;return((s=h.flash)==null?void 0:s.success)||((t=h.flash)==null?void 0:t.error)||((d=h.flash)==null?void 0:d.warning)}),ee=N(()=>h.deliveries||{data:[]}),be=N(()=>Array.isArray(h.driverTruckSets)?h.driverTruckSets:[]),fe=N(()=>Array.isArray(h.batchSuggestions)?h.batchSuggestions:[]),ve=N(()=>{const s=fe.value;return q.value==="backhaul"?s.filter(t=>Fe(t)):q.value==="regular"?s.filter(t=>!Fe(t)):s}),oe=N(()=>{const s=be.value;return!Array.isArray(s)||s.length===0?[]:s.map(t=>{var S;const d=t.driver||{},u=t.truck||{};let C=d.initials||"";return!C&&d.name&&(C=d.name.split(" ").map(V=>V[0]).join("").substring(0,2).toUpperCase()),{...t,driver:{...d,delivery_orders_count:d.delivery_orders_count??d.current_assignments??0,current_assignments:d.current_assignments??d.delivery_orders_count??0,canAcceptNewAssignment:d.canAcceptNewAssignment??d.available??!1,available:d.available??!0,initials:C,employee_id:d.employee_id??((S=d.employeeProfile)==null?void 0:S.employee_id)??"N/A",name:d.name??"N/A"},truck:{...u,volume_capacity:u.volume_capacity??0,weight_capacity:u.weight_capacity??0,license_plate:u.license_plate??"N/A",make:u.make??"",model:u.model??"",status:u.status??"unknown"},current_volume:t.current_volume??0,current_weight:t.current_weight??0,available_volume:t.available_volume??0,available_weight:t.available_weight??0,is_available:t.is_available??!0,available_for_backhaul:t.available_for_backhaul??!1,region:t.region??{name:"N/A"},current_region:t.current_region??{name:"N/A"},active_orders:t.active_orders??[]}}).filter(t=>R.value==="all"?!0:R.value==="backhaul"?t.available_for_backhaul:R.value==="regular"?!t.available_for_backhaul:!0)}),xe=N(()=>{var s;return(((s=ee.value)==null?void 0:s.data)||[]).map(t=>{var d,u;return{...t,packages_count:((u=(d=t.delivery_request)==null?void 0:d.packages)==null?void 0:u.length)||0,assignment_type:t.is_backhaul?"Backhaul":"Regular"}})}),le=N(()=>v.value.reduce((s,t)=>{var u;const d=((u=t.delivery_request)==null?void 0:u.packages)||[];return s+Pe(d)},0)),re=N(()=>v.value.reduce((s,t)=>{var u;const d=((u=t.delivery_request)==null?void 0:u.packages)||[];return s+Ie(d)},0)),ne=N(()=>v.value.some(s=>Se(s))),de=N(()=>{if(v.value.length===0)return!1;const s=v.value.some(d=>d.is_backhaul),t=v.value.some(d=>!d.is_backhaul);return s&&t}),me=N(()=>{var u,C;if(!m.value||v.value.length===0)return!1;const s=(u=m.value.region)==null?void 0:u.id,t=(C=m.value.current_region)==null?void 0:C.id,d=m.value.available_for_backhaul;return v.value.some(S=>{var E,L,O,a;const V=(L=(E=S.delivery_request)==null?void 0:E.pick_up_region)==null?void 0:L.id,X=(a=(O=S.delivery_request)==null?void 0:O.drop_off_region)==null?void 0:a.id;return d?V!==t||X!==s:V!==s})}),ye=N(()=>m.value&&v.value.length>0&&!ne.value&&!de.value&&!me.value),W=N(()=>{var O,a;if(!m.value||v.value.length===0)return{isValid:!1,message:"Please select deliveries and a driver-truck set",details:[],availableVolume:0,availableWeight:0};const s=[],t=m.value.truck||{},d=m.value.current_volume||0,u=m.value.current_weight||0,C=(t.volume_capacity||0)-d,S=(t.weight_capacity||0)-u;le.value>C&&s.push(`Insufficient volume capacity: ${le.value.toFixed(2)}mÂ³ selected vs ${C.toFixed(2)}mÂ³ available`),re.value>S&&s.push(`Insufficient weight capacity: ${re.value.toFixed(2)}kg selected vs ${S.toFixed(2)}kg available`);const V=(O=m.value.region)==null?void 0:O.id,X=(a=m.value.current_region)==null?void 0:a.id,E=m.value.available_for_backhaul;v.value.forEach(g=>{var D,j,_,w,T,H,G;const p=(j=(D=g.delivery_request)==null?void 0:D.pick_up_region)==null?void 0:j.id,B=(w=(_=g.delivery_request)==null?void 0:_.drop_off_region)==null?void 0:w.id;E?(p!==X&&s.push(`Backhaul: Pickup must be from current region (${(T=m.value.current_region)==null?void 0:T.name})`),B!==V&&s.push(`Backhaul: Delivery must be to home region (${(H=m.value.region)==null?void 0:H.name})`)):p!==V&&s.push(`Regular: Pickup must be from home region (${(G=m.value.region)==null?void 0:G.name})`)}),de.value&&s.push("Cannot mix regular and backhaul assignments in the same batch"),ne.value&&s.push("Some packages are missing stickers");const L=s.length===0;return{isValid:L,message:L?"Assignment is valid":"Assignment validation failed",details:s,availableVolume:C,availableWeight:S}}),we=[{field:"id",header:"DO #",sortable:!0,formatter:s=>s?`DO-${s.toString().padStart(6,"0")}`:"N/A"},{field:"delivery_request.pick_up_region.name",header:"Pickup",sortable:!0},{field:"delivery_request.drop_off_region.name",header:"Dropoff",sortable:!0},{field:"status",header:"Status",sortable:!0},{field:"packages_count",header:"Packages",sortable:!1},{field:"assignment_type",header:"Type",sortable:!0},{field:"estimated_departure",header:"Est. Departure",sortable:!0,formatter:s=>s?it(s):"N/A"},{field:"actions",header:"Actions",sortable:!1}],ue=()=>{const s={};A.value&&(s.search=A.value),K.value&&(s.status=K.value),n.value&&(s.region_id=n.value),q.value&&(s.backhaul=q.value),ae.get(route("cargo-assignments.index"),s,{preserveState:!0,replace:!0})},$e=()=>{A.value="",K.value="",n.value="",q.value="",R.value="all",ue()},ce=()=>{P.value=!0,ae.reload({only:["deliveries","driverTruckSets","batchSuggestions"],onFinish:()=>{P.value=!1}})},Ce=s=>{ae.get(route("cargo-assignments.index"),{...h.filters,page:s},{preserveState:!0,preserveScroll:!0})},Ae=s=>{v.value=s},pe=s=>{m.value=s},_e=()=>{v.value=[],m.value=null},Me=s=>{v.value=v.value.filter(t=>t.id!==s)},ke=()=>{W.value.isValid&&(y.value=!0)},F=()=>{y.value=!1},Ze=()=>{const s=v.value.map(d=>d.delivery_request_id||d.id),t=new Date(Date.now()+6e4);ae.post(route("cargo-assignments.assign.batch"),{delivery_request_ids:s,driver_truck_assignment_id:m.value.id,estimated_departure:t.toISOString()},{onStart:()=>P.value=!0,onFinish:()=>{P.value=!1,y.value=!1,_e()},onError:d=>{console.error("Batch assignment failed:",d),alert("Failed to assign deliveries. Please try again.")}})},et=s=>{Z.value=s,Q.value=s.id,l.value=!0},Re=()=>{l.value=!1,Z.value=null,Q.value=null},tt=()=>{Re(),ce()},st=s=>{I.value=s},at=()=>{I.value=null},lt=()=>{I.value&&ae.post(route("cargo-assignments.deliveries.cancel",I.value.id),{onStart:()=>P.value=!0,onFinish:()=>{P.value=!1,I.value=null}})},rt=s=>{ae.get(route("cargo-assignments.show",s))},Pe=s=>!s||!Array.isArray(s)?0:s.reduce((t,d)=>t+(Number(d.volume)||0),0),Ie=s=>!s||!Array.isArray(s)?0:s.reduce((t,d)=>t+(Number(d.weight)||0),0),Se=s=>{var d;return(((d=s.delivery_request)==null?void 0:d.packages)||[]).some(u=>!u.sticker_printed_at)},Le=s=>{var t;return((t=s.delivery_requests)==null?void 0:t.some(d=>Se(d)))||!1},it=s=>{if(!s)return"N/A";const t=new Date(s);return t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},ot=s=>({pending:"bg-yellow-100 text-yellow-800",assigned:"bg-blue-100 text-blue-800",picked_up:"bg-indigo-100 text-indigo-800",in_transit:"bg-purple-100 text-purple-800",delivered:"bg-green-100 text-green-800",completed:"bg-gray-100 text-gray-800",cancelled:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800",nt=s=>({pending:"Pending",assigned:"Assigned",picked_up:"Picked Up",in_transit:"In Transit",delivered:"Delivered",completed:"Completed",cancelled:"Cancelled"})[s]||s,dt=s=>{if(!s||!s.delivery_requests)return;v.value=s.delivery_requests||[];const t=De(s);t.length>0&&(m.value=t[0]),ke()},De=s=>{const t=oe.value;return!Array.isArray(t)||t.length===0?[]:t.filter(d=>{var g,p,B,D;const u=((g=d.region)==null?void 0:g.id)===((p=s.pickup_region)==null?void 0:p.id)||d.available_for_backhaul&&((B=d.current_region)==null?void 0:B.id)===((D=s.pickup_region)==null?void 0:D.id),C=d.truck||{},S=d.current_volume||0,V=d.current_weight||0,X=(C.volume_capacity||0)-S,E=(C.weight_capacity||0)-V,L=Number(s.total_volume)||0,O=Number(s.total_weight)||0,a=X>=L&&E>=O;return d.is_available&&u&&a})},Fe=s=>{var u,C,S;const t=(u=s.pickup_region)==null?void 0:u.id,d=(C=s.destination_region)==null?void 0:C.id;return((S=s.delivery_requests)==null?void 0:S.every(V=>{var L,O,a,g;const X=(O=(L=V.delivery_request)==null?void 0:L.pick_up_region)==null?void 0:O.id,E=(g=(a=V.delivery_request)==null?void 0:a.drop_off_region)==null?void 0:g.id;return X===d&&E===t}))||!1},ut=s=>{R.value=s},ct=s=>{Oe(s)&&ae.post(route("cargo-assignments.backhaul.enable",s.id),{},{onStart:()=>P.value=!0,onFinish:()=>{P.value=!1,ce()},onError:t=>{console.error("Failed to enable backhaul:",t),alert("Failed to enable backhaul. Please try again.")}})},Oe=s=>{var t,d,u;return s.is_available&&!s.available_for_backhaul&&(((t=s.driver)==null?void 0:t.canAcceptNewAssignment)??((d=s.driver)==null?void 0:d.available))&&((u=s.truck)==null?void 0:u.status)==="available"};return Te([A,K,n,q],()=>{ue()}),Xe(()=>{h.filters&&(A.value=h.filters.search||"",K.value=h.filters.status||"",n.value=h.filters.region_id||"",q.value=h.filters.backhaul||"")}),(s,t)=>(r(),ze(gt,null,{header:$(()=>[e("div",Is,[t[5]||(t[5]=e("h2",{class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},"Cargo Assignment Dashboard",-1)),e("div",Ls,[k(pt,{modelValue:A.value,"onUpdate:modelValue":t[0]||(t[0]=d=>A.value=d),placeholder:"Search deliveries...",class:"w-64",onSearch:ue},null,8,["modelValue"]),k(he,{onClick:ce,class:"inline-flex items-center"},{default:$(()=>t[4]||(t[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),M(" Refresh ")])),_:1})])])]),default:$(()=>{var d,u,C,S,V,X,E,L,O;return[se.value?(r(),i("div",Os,[k(ht,{flash:x.flash},null,8,["flash"])])):c("",!0),e("div",Ws,[e("div",Hs,[e("div",Us,[k(je,{modelValue:K.value,"onUpdate:modelValue":t[1]||(t[1]=a=>K.value=a),options:te,placeholder:"Filter by status",class:"flex-1 min-w-0"},null,8,["modelValue"]),k(je,{modelValue:n.value,"onUpdate:modelValue":t[2]||(t[2]=a=>n.value=a),options:ie.value,placeholder:"Filter by region",class:"flex-1 min-w-0"},null,8,["modelValue","options"]),k(je,{modelValue:q.value,"onUpdate:modelValue":t[3]||(t[3]=a=>q.value=a),options:U,placeholder:"Backhaul status",class:"flex-1 min-w-0"},null,8,["modelValue"])]),k(he,{onClick:$e,size:"sm"},{default:$(()=>t[6]||(t[6]=[M(" Clear Filters ")])),_:1})])]),e("div",Es,[e("div",Gs,[e("div",Ys,[t[7]||(t[7]=e("h3",{class:"font-medium text-gray-900 dark:text-gray-100"}," Delivery Orders ",-1)),e("div",Js," Showing "+o(((d=ee.value)==null?void 0:d.from)??0)+" to "+o(((u=ee.value)==null?void 0:u.to)??0)+" of "+o(((C=ee.value)==null?void 0:C.total)??0)+" entries ",1)]),k(vt,{columns:we,data:xe.value,loading:P.value,selectable:"",onSelectionChange:Ae},{status:$(({row:a})=>[e("div",Ks,[k(kt,{status:a.status,class:f(ot(a.status))},{default:$(()=>[M(o(nt(a.status)),1)]),_:2},1032,["status","class"]),a.is_backhaul?(r(),i("span",Qs,t[8]||(t[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z","clip-rule":"evenodd"})],-1),M(" Backhaul ")]))):c("",!0)])]),packages:$(({row:a})=>{var g,p;return[e("div",Xs,[e("span",null,o(((p=(g=a.delivery_request)==null?void 0:g.packages)==null?void 0:p.length)??0),1),Se(a)?(r(),i("span",Zs,t[9]||(t[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]))):c("",!0)])]}),assignment_type:$(({row:a})=>[e("div",ea,[a.is_backhaul?(r(),i("span",ta,t[10]||(t[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z","clip-rule":"evenodd"})],-1),M(" Backhaul ")]))):(r(),i("span",sa,t[11]||(t[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1 1 0 11-3 0 1 1 0 013 0z"}),e("path",{d:"M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1v-1a1 1 0 011-1h2a1 1 0 011 1v1a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H19a1 1 0 001-1V5a1 1 0 00-1-1H3z"})],-1),M(" Regular ")])))])]),actions:$(({row:a})=>[e("div",aa,[k(he,{onClick:Be(g=>rt(a.id),["stop"]),size:"xs",title:"Details"},{default:$(()=>t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)])),_:2},1032,["onClick"]),a.status!=="completed"&&a.status!=="cancelled"?(r(),ze(_t,{key:0,onClick:Be(g=>st(a),["stop"]),size:"xs",title:"Cancel"},{default:$(()=>t[13]||(t[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)])),_:2},1032,["onClick"])):c("",!0)])]),_:1},8,["data","loading"]),((S=ee.value)==null?void 0:S.last_page)>1?(r(),ze(mt,{key:0,pagination:ee.value,onPageChanged:Ce},null,8,["pagination"])):c("",!0)]),e("div",la,[e("div",ra,[e("div",ia,[e("div",oa,[e("div",na,[e("h3",da," Selected Deliveries ("+o(((V=v.value)==null?void 0:V.length)??0)+") ",1),((X=v.value)==null?void 0:X.length)>0?(r(),i("button",{key:0,onClick:_e,class:"text-xs text-red-500 hover:text-red-700"}," Clear All ")):c("",!0)])]),e("div",ua,[((E=v.value)==null?void 0:E.length)>0?(r(!0),i(Y,{key:0},J(v.value,a=>{var g,p,B,D,j,_,w,T;return r(),i("div",{key:a.id,class:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50"},[e("div",ca,[e("div",null,[e("p",ga,[M(" DO-"+o((p=(g=a.id)==null?void 0:g.toString())==null?void 0:p.padStart(6,"0"))+" ",1),a.is_backhaul?(r(),i("span",va," Backhaul ")):c("",!0)]),e("p",ma,o(((D=(B=a.delivery_request)==null?void 0:B.pick_up_region)==null?void 0:D.name)??"N/A")+" â†’ "+o(((_=(j=a.delivery_request)==null?void 0:j.drop_off_region)==null?void 0:_.name)??"N/A"),1),e("div",pa,[e("p",null,"Volume: "+o(Pe(((w=a.delivery_request)==null?void 0:w.packages)??[]))+" mÂ³",1),e("p",null,"Weight: "+o(Ie(((T=a.delivery_request)==null?void 0:T.packages)??[]))+" kg",1),Se(a)?(r(),i("p",_a,t[14]||(t[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1),M(" Missing stickers ")]))):c("",!0)])]),e("button",{onClick:H=>Me(a.id),class:"text-red-500 hover:text-red-700",title:"Remove"},t[15]||(t[15]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]),8,ka)])])}),128)):(r(),i("div",ha," No deliveries selected "))]),((L=v.value)==null?void 0:L.length)>0?(r(),i("div",ba,[e("div",fa,[t[16]||(t[16]=e("p",{class:"font-medium"},"Total Selected:",-1)),e("p",null,"Volume: "+o(le.value)+" mÂ³",1),e("p",null,"Weight: "+o(re.value)+" kg",1),ne.value?(r(),i("p",xa," âš ï¸ Some packages are missing stickers ")):c("",!0),de.value?(r(),i("p",ya," âš ï¸ Mixed assignment types (Regular + Backhaul) ")):c("",!0),me.value?(r(),i("p",wa," âš ï¸ Region mismatch in assignments ")):c("",!0)]),k(Ve,{class:"mt-4 w-full",disabled:!ye.value,onClick:ke},{default:$(()=>t[17]||(t[17]=[M(" Assign Selected ")])),_:1},8,["disabled"])])):c("",!0)])]),e("div",$a,[e("div",Ca,[e("div",Aa,[e("h3",Ma,[t[18]||(t[18]=M(" Available Driver-Truck Sets ")),e("div",Sa,[(r(),i(Y,null,J(b,a=>e("button",{key:a.value,onClick:g=>ut(a.value),class:f(["px-2 py-1 text-xs rounded border",R.value===a.value?"bg-blue-100 text-blue-800 border-blue-300 dark:bg-blue-900 dark:text-blue-200 dark:border-blue-700":"bg-gray-100 text-gray-600 border-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:border-gray-600"])},o(a.label),11,Da)),64))])])]),e("div",Ba,[e("div",za,[((O=oe.value)==null?void 0:O.length)>0?(r(!0),i(Y,{key:0},J(oe.value,a=>{var g,p,B,D,j,_,w,T,H,G,ge,Ge,Ye,Je;return r(),i("div",{key:a.id,class:f(["border rounded-lg p-4 hover:border-blue-500 transition-colors cursor-pointer",{"border-blue-500 bg-blue-50 dark:bg-blue-900/20":((g=m.value)==null?void 0:g.id)===a.id,"border-purple-500 bg-purple-50 dark:bg-purple-900/20":a.available_for_backhaul,"opacity-50 cursor-not-allowed":!a.is_available,"cursor-pointer":a.is_available}]),onClick:Ke=>a.is_available&&pe(a)},[e("div",Na,[e("div",Fa,[e("div",ja,[e("div",Ta,[e("span",qa,o(a.driver.initials??""),1)]),e("div",null,[e("p",Ra,o(a.driver.name??"N/A"),1),e("p",Pa,o(a.driver.employee_id??""),1),a.available_for_backhaul?(r(),i("span",Ia,t[19]||(t[19]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z","clip-rule":"evenodd"})],-1),M(" Backhaul Available ")]))):c("",!0)])]),e("div",La,[e("p",null,"Current Assignments: "+o(((p=a.driver)==null?void 0:p.delivery_orders_count)??0),1),e("p",null,[t[20]||(t[20]=M("Available: ")),e("span",{class:f((B=a.driver)!=null&&B.canAcceptNewAssignment?"text-green-600":"text-red-600")},o((D=a.driver)!=null&&D.canAcceptNewAssignment?"Yes":"No"),3)]),a.available_for_backhaul?(r(),i("p",Oa," Current: "+o(((j=a.current_region)==null?void 0:j.name)??"N/A"),1)):(r(),i("p",Wa," Home: "+o(((_=a.region)==null?void 0:_.name)??"N/A"),1))])]),e("div",Ha,[e("div",Ua,[t[21]||(t[21]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-500",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1 1 0 11-3 0 1 1 0 013 0z"}),e("path",{d:"M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1v-1a1 1 0 011-1h2a1 1 0 011 1v1a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H19a1 1 0 001-1V5a1 1 0 00-1-1H3z"})],-1)),e("div",null,[e("p",Ea,o(((w=a.truck)==null?void 0:w.license_plate)??"N/A"),1),e("p",Ga,o(((T=a.truck)==null?void 0:T.make)??"")+" "+o(((H=a.truck)==null?void 0:H.model)??""),1),((G=a.truck)==null?void 0:G.status)==="available_for_backhaul"?(r(),i("span",Ya," Backhaul ")):c("",!0)])]),e("div",Ja,[e("div",null,[e("p",Ka,"Volume: "+o((a.current_volume??0).toFixed(2))+" / "+o(((ge=a.truck)==null?void 0:ge.volume_capacity)??0)+" mÂ³",1),e("div",Qa,[e("div",{class:"bg-blue-600 h-1.5 rounded-full",style:Ne({width:`${Math.min(100,(a.current_volume??0)/(((Ge=a.truck)==null?void 0:Ge.volume_capacity)||1)*100)}%`})},null,4)])]),e("div",null,[e("p",Xa,"Weight: "+o((a.current_weight??0).toFixed(2))+" / "+o(((Ye=a.truck)==null?void 0:Ye.weight_capacity)??0)+" kg",1),e("div",Za,[e("div",{class:"bg-green-600 h-1.5 rounded-full",style:Ne({width:`${Math.min(100,(a.current_weight??0)/(((Je=a.truck)==null?void 0:Je.weight_capacity)||1)*100)}%`})},null,4)])])])])]),a.is_available&&!a.available_for_backhaul?(r(),i("div",el,[k(he,{size:"xs",class:"w-full",onClick:Be(Ke=>ct(a),["stop"]),disabled:!Oe(a)},{default:$(()=>t[22]||(t[22]=[M(" Enable Backhaul ")])),_:2},1032,["onClick","disabled"])])):c("",!0),k(Ve,{class:"mt-4 w-full",disabled:!a.is_available||Q.value===a.id,onClick:Be(Ke=>et(a),["stop"])},{default:$(()=>[Q.value===a.id?(r(),i("span",tl,[k(qe,{size:"xs",class:"mr-2"}),t[23]||(t[23]=M(" Dispatching... "))])):(r(),i("span",sl," Dispatch "))]),_:2},1032,["disabled","onClick"])],10,Va)}),128)):(r(),i("div",al," No available driver-truck sets found "))])])])])])]),e("div",ll,[t[26]||(t[26]=e("div",{class:"p-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-700"},[e("h3",{class:"font-medium text-gray-900 dark:text-gray-100"}," Batch Assignment Suggestions ")],-1)),e("div",rl,[ve.value.length>0?(r(),i("div",il,[(r(!0),i(Y,null,J(ve.value,a=>{var g,p,B,D,j;return r(),i("div",{key:((g=a.destination_region)==null?void 0:g.id)||((p=a.pickup_region)==null?void 0:p.id),class:"border rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50"},[e("div",ol,[e("div",null,[e("p",nl," From: "+o(((B=a.pickup_region)==null?void 0:B.name)??"N/A")+" â†’ To: "+o(((D=a.destination_region)==null?void 0:D.name)??"N/A"),1),e("p",dl,o(((j=a.delivery_requests)==null?void 0:j.length)??0)+" deliveries ",1),e("p",ul," Total Volume: "+o((a.total_volume||0).toFixed(2))+" mÂ³ | Total Weight: "+o((a.total_weight||0).toFixed(2))+" kg ",1),Fe(a)?(r(),i("p",cl," ðŸ’¡ Backhaul Opportunity: Deliveries from current region to home region ")):c("",!0),Le(a)?(r(),i("p",gl," âš ï¸ Some deliveries have packages without stickers ")):c("",!0)]),k(Ve,{size:"sm",onClick:_=>dt(a),disabled:!De(a).length||Le(a)},{default:$(()=>t[24]||(t[24]=[M(" Assign Batch ")])),_:2},1032,["onClick","disabled"])]),De(a).length?(r(),i("div",vl,[t[25]||(t[25]=e("p",{class:"text-sm font-medium"},"Suitable Driver-Truck Sets:",-1)),e("div",ml,[(r(!0),i(Y,null,J(De(a),_=>{var w,T,H,G;return r(),i("div",{key:_.id,class:f(["p-2 border rounded cursor-pointer",{"border-blue-500":((w=m.value)==null?void 0:w.id)===_.id,"border-purple-500":_.available_for_backhaul}]),onClick:ge=>pe(_)},[e("p",_l,o(((T=_.driver)==null?void 0:T.name)??"N/A"),1),e("p",kl,o(((H=_.truck)==null?void 0:H.license_plate)??"N/A"),1),e("p",hl,"Available: "+o((_.available_volume??0).toFixed(2))+"mÂ³ "+o((_.available_weight??0).toFixed(2))+"kg",1),e("p",bl,"Region: "+o(((G=_.region)==null?void 0:G.name)??"N/A"),1),_.available_for_backhaul?(r(),i("span",fl," Backhaul ")):c("",!0)],10,pl)}),128))])])):(r(),i("div",xl," No suitable driver-truck sets available "))])}),128))])):(r(),i("div",yl," No batch assignment suggestions available "))])]),k(Qe,{show:y.value,onClose:F,onConfirmed:Ze,title:"Confirm Assignment","confirm-text":"Confirm Assignment","confirm-disabled":!W.value.isValid},{default:$(()=>{var a,g,p,B,D,j,_;return[e("div",wl,[e("div",{class:f(["p-4 rounded-lg",{"bg-green-50 text-green-800":W.value.isValid,"bg-red-50 text-red-800":!W.value.isValid}])},[e("p",$l,o(W.value.message),1),W.value.details?(r(),i("ul",Cl,[(r(!0),i(Y,null,J(W.value.details,w=>(r(),i("li",{key:w},o(w),1))),128))])):c("",!0)],2),e("div",Al,[e("div",null,[t[27]||(t[27]=e("p",{class:"text-sm font-medium"},"Total Selected Volume",-1)),e("p",Ml,o(le.value.toFixed(2))+" mÂ³",1),e("p",Sl,"Available: "+o((W.value.availableVolume||0).toFixed(2))+" mÂ³",1)]),e("div",null,[t[28]||(t[28]=e("p",{class:"text-sm font-medium"},"Total Selected Weight",-1)),e("p",Dl,o(re.value.toFixed(2))+" kg",1),e("p",Bl,"Available: "+o((W.value.availableWeight||0).toFixed(2))+" kg",1)])]),e("div",zl,[t[29]||(t[29]=e("p",{class:"text-sm font-medium mb-2"},"Selected Deliveries:",-1)),e("div",Vl,[(r(!0),i(Y,null,J(v.value,w=>{var T,H,G,ge;return r(),i("div",{key:w.id,class:"flex justify-between text-sm"},[e("span",null,"DO-"+o(w.id.toString().padStart(6,"0")),1),e("span",null,o(((H=(T=w.delivery_request)==null?void 0:T.pick_up_region)==null?void 0:H.name)??"N/A")+" â†’ "+o(((ge=(G=w.delivery_request)==null?void 0:G.drop_off_region)==null?void 0:ge.name)??"N/A"),1),w.is_backhaul?(r(),i("span",Nl,"Backhaul")):c("",!0)])}),128))])]),e("div",Fl,[t[30]||(t[30]=e("p",{class:"text-sm font-medium mb-2"},"Selected Driver-Truck Set:",-1)),e("div",jl,[e("div",Tl,[e("span",ql,o(((g=(a=m.value)==null?void 0:a.driver)==null?void 0:g.initials)??""),1)]),e("div",null,[e("p",Rl,o(((B=(p=m.value)==null?void 0:p.driver)==null?void 0:B.name)??"N/A"),1),e("p",Pl,o(((j=(D=m.value)==null?void 0:D.truck)==null?void 0:j.license_plate)??"N/A"),1),(_=m.value)!=null&&_.available_for_backhaul?(r(),i("span",Il," Backhaul Available ")):c("",!0)])])])])]}),_:1},8,["show","confirm-disabled"]),k(Ps,{show:l.value,set:Z.value,onClose:Re,onDispatched:tt},null,8,["show","set"]),k(Qe,{show:!!I.value,onClose:at,onConfirmed:lt,title:"Cancel Delivery Order","confirm-text":"Cancel Delivery",variant:"danger"},{default:$(()=>{var a,g,p;return[e("p",null,"Are you sure you want to cancel delivery order DO-"+o((p=(g=(a=I.value)==null?void 0:a.id)==null?void 0:g.toString())==null?void 0:p.padStart(6,"0"))+"?",1),t[31]||(t[31]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400 mt-2"},"This action cannot be undone.",-1))]}),_:1},8,["show"])]}),_:1}))}};export{sr as default};
