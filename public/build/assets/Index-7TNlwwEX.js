import{c as u,o as r,b as e,g as b,p as de,i as H,j as Ve,d as q,w as g,a as n,t as i,f as v,F as ue,u as V,e as f,r as Ie,n as N,q as Le,W as I}from"./app-BRlF4EhB.js";import{E as Me}from"./EmployeeLayout-C1kqUmLf.js";import{_ as B}from"./PrimaryButton-D8Y0EbxS.js";import{_ as h}from"./SecondaryButton-BSdBhKLO.js";import{D as ce}from"./DangerButton-dJovAgRZ.js";import{M as G}from"./Modal-CyNUxeX5.js";import{S as C}from"./SelectInput-frmwb_XR.js";import{_ as je}from"./SearchInput-Bk70t47v.js";import{T as $e}from"./TextInput-DUthdhhO.js";import{r as ge}from"./TruckIcon-C3nzPWq0.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./NavLink-CmY0AIOJ.js";/* empty css                                                                  */function Ne(m,w){return r(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}function Be(m,w){return r(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})])}function Fe(m,w){return r(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}const Oe={key:0,class:"mt-4 p-4 bg-red-50 border border-red-200 rounded"},ze={class:"flex flex-wrap justify-between items-center gap-4 px-4 md:px-6 max-w-screen-xl mx-auto w-full"},Ue={class:"flex space-x-2 mb-4"},Pe={class:"flex flex-wrap items-center gap-2"},He={class:"py-6 px-2 md:px-6"},qe={key:0,class:"flex justify-center items-center py-12"},Ge={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6 text-center mb-6"},We={class:"mt-1 text-sm text-red-600"},Ke={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 max-w-screen-xl mx-auto"},Ye={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4"},Ze={class:"flex items-center"},Je={class:"rounded-full bg-blue-100 p-3 mr-4"},Qe={class:"text-2xl font-bold text-gray-900"},Xe={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4"},et={class:"flex items-center"},tt={class:"text-2xl font-bold text-purple-600"},st={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4"},lt={class:"flex items-center"},ot={class:"text-2xl font-bold text-yellow-600"},nt={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4"},at={class:"flex items-center"},rt={class:"text-2xl font-bold text-green-600"},it={class:"bg-white shadow-sm rounded-lg overflow-hidden border border-gray-200 max-w-screen-xl mx-auto"},dt={class:"px-4 py-5 sm:px-6 border-b border-gray-200 flex flex-col md:flex-row md:items-center md:justify-between gap-4"},ut={class:"flex flex-wrap items-center gap-2 md:ml-auto"},ct={class:"overflow-x-auto px-2 md:px-4"},gt={class:"min-w-full divide-y divide-gray-200"},mt={class:"bg-white divide-y divide-gray-200"},pt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},vt={class:"flex items-center"},xt={class:"text-xs text-gray-500"},bt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ft={class:"flex items-center"},wt={class:"text-xs text-gray-500"},yt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},_t={key:0,class:"text-xs text-purple-600"},kt={class:"px-6 py-4 whitespace-nowrap text-sm"},ht={key:0,class:"text-xs mt-1"},Ct={class:"text-yellow-600"},At={key:0,class:"text-green-600 font-semibold ml-1"},Rt={key:0,class:"text-red-600 font-semibold"},Tt={class:"px-6 py-4 whitespace-nowrap text-sm"},St={key:0,class:"flex items-center"},Dt={key:1,class:"flex items-center"},Et={class:"px-6 py-4 whitespace-nowrap text-sm"},Vt={class:"text-gray-400"},It={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Lt={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Mt={class:"flex justify-end space-x-2"},jt={key:0},$t={class:"bg-white px-4 py-3 flex items-center justify-center border-t border-gray-200 sm:px-6"},Nt={class:"flex items-center space-x-2"},Bt=["disabled"],Ft=["disabled"],Ot={class:"p-6"},zt={class:"space-y-4"},Ut={class:"mt-6 flex justify-end space-x-4"},Pt={class:"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded"},Ht={key:0,class:"p-6"},qt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Gt={class:"bg-gray-50 rounded-lg p-4 shadow-sm border"},Wt={class:"space-y-2"},Kt={class:"flex justify-between"},Yt={class:"font-medium text-gray-900"},Zt={class:"flex justify-between"},Jt={class:"font-medium text-gray-900"},Qt={class:"flex justify-between"},Xt={class:"font-medium text-gray-900"},es={class:"flex justify-between"},ts={class:"font-medium text-gray-900"},ss={class:"flex justify-between"},ls={key:0,class:"flex justify-between"},os={class:"font-medium text-yellow-600"},ns={key:0,class:"text-green-600 font-semibold"},as={key:1,class:"flex justify-between"},rs={class:"bg-gray-50 rounded-lg p-4 shadow-sm border"},is={class:"space-y-2"},ds={class:"flex justify-between"},us={class:"font-medium text-gray-900"},cs={class:"flex justify-between"},gs={class:"font-medium text-gray-900"},ms={class:"flex justify-between"},ps={class:"flex justify-between"},vs={class:"font-medium text-gray-900"},xs={class:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4"},bs={class:"text-sm text-blue-700 space-y-1"},fs={key:0},ws={key:1},ys={key:2},_s={key:3},ks={key:4},hs={class:"mt-6 flex justify-end"},Cs={class:"p-6"},As={class:"mt-6 flex justify-end space-x-4"},Os={__name:"Index",props:{assignments:Object,regions:Array,metrics:Object,filters:Object},setup(m){var ee,te,se,le,oe;const w=m,F=b(!1),L=b(null),M=b(!1),A=b(!1),S=b(!1),o=b(null),y=b(null),O=b(!1),z=b(!1),j=b([]),$=b([]),_=b(""),U=b(null),a=de({region_id:null,driver_id:null,truck_id:null,processing:!1}),p=de({search:((ee=w.filters)==null?void 0:ee.search)||"",region_id:((te=w.filters)==null?void 0:te.region_id)||"",status:((se=w.filters)==null?void 0:se.status)||"all",driver_status:((le=w.filters)==null?void 0:le.driver_status)||"",cooldown_completed:((oe=w.filters)==null?void 0:oe.cooldown_completed)||""}),W=H(()=>{var s;return[{value:"",label:"All Regions"},...((s=w.regions)==null?void 0:s.map(t=>({value:t.id,label:t.name})))||[]]}),me=H(()=>[{value:"",label:"All Statuses"},{value:"active",label:"Active"},{value:"cooldown",label:"Cooldown"},{value:"backhaul_eligible",label:"Backhaul Eligible"},{value:"returning",label:"Returning"},{value:"completed",label:"Completed"}]),pe=H(()=>[{value:"",label:"All Cooldown Status"},{value:"pending",label:"Cooldown Pending"},{value:"completed",label:"Cooldown Completed"},{value:"final",label:"Final Cooldown"}]),R=async()=>{F.value=!0,L.value=null;try{await I.reload({data:p,preserveState:!0,preserveScroll:!0})}catch(s){L.value=s.message||"Failed to load assignments"}finally{F.value=!1}},T=()=>{R()},ve=()=>{p.search="",p.region_id="",p.status="all",p.driver_status="",p.cooldown_completed="",R()},K=s=>{s>=1&&s<=w.assignments.last_page&&I.get(route("driver-truck-assignments.index"),{...p,page:s},{preserveState:!0,preserveScroll:!0})},xe=()=>{console.log("ðŸ†• Opening create modal"),M.value=!0,a.region_id=null,a.driver_id=null,a.truck_id=null,setTimeout(()=>{console.log("â° Modal should be open now")},1e3)},Y=()=>{M.value=!1},Z=async()=>{if(console.log("ðŸŽ¯ loadAvailableResources CALLED"),!a.region_id){console.log("âŒ No region_id - aborting"),j.value=[],$.value=[];return}console.log("âœ… Region ID found:",a.region_id);try{O.value=!0,z.value=!0,console.log("ðŸ”„ Starting fetch request...");const s=route("driver-truck-assignments.available-resources")+`?region_id=${a.region_id}`;console.log("ðŸ“¡ Fetch URL:",s);const t=await fetch(s,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(console.log("ðŸ“¡ Response status:",t.status),console.log("ðŸ“¡ Response OK:",t.ok),!t.ok){console.error("âŒ Response not OK");const d=await t.text();throw console.error("âŒ Response text:",d),new Error(`HTTP error! status: ${t.status}`)}const l=await t.json();console.log("âœ… Received data:",l),j.value=Array.isArray(l.drivers)?l.drivers.map(d=>{var x;return{value:d.id,label:`${d.name} (${((x=d.employee_profile)==null?void 0:x.employee_id)||"No ID"})`}}):Object.values(l.drivers||{}).map(d=>{var x;return{value:d.id,label:`${d.name} (${((x=d.employee_profile)==null?void 0:x.employee_id)||"No ID"})`}}),console.log("ðŸ‘¥ Final driver options:",j.value);const c=Array.isArray(l.trucks)?l.trucks:Object.values(l.trucks||{});$.value=c.map(d=>({value:d.id,label:`${d.license_plate} - ${d.make} ${d.model}`})),console.log("ðŸš› Final truck options:",$.value)}catch(s){console.error("âŒ Error in loadAvailableResources:",s),console.error("âŒ Error stack:",s.stack),alert("Failed to load available drivers and trucks: "+s.message)}finally{console.log("ðŸ Finally block - setting loading to false"),O.value=!1,z.value=!1}},be=async()=>{if(o.value){console.log("ðŸ§ª TESTING CANCELLATION ELIGIBILITY",o.value);try{const t=await(await fetch(`/debug-cancel-assignment/${o.value.id}`)).json();console.log("ðŸ§ª ELIGIBILITY TEST RESULT:",t),alert(`Can be cancelled: ${t.assignment.canBeCancelled}
Has active deliveries: ${t.assignment.hasActiveDeliveries}`)}catch(s){console.error("ðŸ§ª ELIGIBILITY TEST FAILED:",s)}}},fe=()=>{a.processing=!0,I.post(route("driver-truck-assignments.store"),a,{onSuccess:()=>{M.value=!1,a.region_id=null,a.driver_id=null,a.truck_id=null,R()},onError:s=>{console.error("Failed to create assignment:",s)},onFinish:()=>{a.processing=!1}})},we=s=>{o.value=s,A.value=!0},ye=s=>{console.log("ðŸŽ¯ Region changed:",a.region_id),console.log("ðŸŽ¯ Event:",s),Z()},_e=s=>{y.value=s,_.value="",S.value=!0},ke=async()=>{if(console.log("ðŸ§ª Manual test triggered"),console.log("ðŸ§ª Current region_id:",a.region_id),!a.region_id){console.log("âŒ No region selected"),alert("Please select a region first");return}console.log("ðŸ§ª Calling loadAvailableResources with region:",a.region_id),await Z()},he=async()=>{if(!y.value||!_.value.trim()){alert("Please provide a cancellation reason");return}U.value=y.value.id,console.log("ðŸ”„ STARTING CANCELLATION PROCESS",{assignmentId:y.value.id,assignment:y.value,reason:_.value}),I.post(route("driver-truck-assignments.cancel",{assignment:y.value.id}),{reason:_.value,remarks:_.value},{onSuccess:s=>{console.log("âœ… CANCELLATION SUCCESS - Response:",s),console.log("ðŸ”„ Reloading data..."),R(),S.value=!1,A.value&&(A.value=!1),s.props.flash.success&&console.log("ðŸŽ‰ Success message:",s.props.flash.success)},onError:s=>{var l,c;console.error("âŒ CANCELLATION FAILED - Errors:",s);let t="Unknown error occurred";if(typeof s=="string")t=s;else if(s.message)t=s.message;else if(s.reason&&Array.isArray(s.reason))t=s.reason[0];else if(s.remarks&&Array.isArray(s.remarks))t=s.remarks[0];else if((l=page==null?void 0:page.props)!=null&&l.errors){const d=page.props.errors;t=d.message||((c=Object.values(d)[0])==null?void 0:c[0])||"Validation error"}console.error("âŒ Extracted error message:",t),alert("Failed to cancel assignment: "+t)},onFinish:()=>{console.log("ðŸ CANCELLATION PROCESS FINISHED"),U.value=null,y.value=null}})},Ce=s=>{I.visit(route("driver-truck-assignments.status-timeline.show",{assignment:s.id}))},J=s=>({active:"bg-green-100 text-green-800 border border-green-300",cooldown:"bg-yellow-100 text-yellow-800 border border-yellow-300",backhaul_eligible:"bg-purple-100 text-purple-800 border border-purple-300",returning:"bg-blue-100 text-blue-800 border border-blue-300",completed:"bg-gray-100 text-gray-800 border border-gray-300",cancelled:"bg-red-100 text-red-800 border border-red-300"})[s]||"bg-gray-100 text-gray-800 border border-gray-300",Q=s=>({active:"Active",cooldown:"Cooldown",backhaul_eligible:"Backhaul Eligible",returning:"Returning",completed:"Completed",cancelled:"Cancelled"})[s]||s,Ae=s=>({available:"bg-green-100 text-green-800",assigned:"bg-blue-100 text-blue-800",maintenance:"bg-red-100 text-red-800",unavailable:"bg-gray-100 text-gray-800"})[s]||"bg-gray-100 text-gray-800",Re=s=>({available:"Available",assigned:"Assigned",maintenance:"Maintenance",unavailable:"Unavailable"})[s]||s,X=s=>{var t;return s.current_region?s.current_region.name:((t=s.region)==null?void 0:t.name)||"N/A"},Te=s=>new Date(s).toLocaleDateString(),Se=s=>new Date(s).toLocaleString(),De=s=>{const t=new Date,c=new Date(s)-t;if(c<=0)return"Finished";const d=Math.floor(c/6e4),x=Math.floor(d/60),k=d%60;return x>0?`${x}h ${k}m`:`${k}m`},P=s=>s.current_status!=="cooldown"||!s.cooldown_ends_at?!1:new Date(s.cooldown_ends_at)<=new Date,Ee=s=>s.is_active&&(s.current_status==="active"||s.current_status==="cooldown"||s.current_status==="backhaul_eligible");return Ve(()=>{setInterval(()=>{var t,l;((l=(t=w.assignments)==null?void 0:t.data)==null?void 0:l.some(c=>c.current_status==="cooldown"&&!P(c)))&&R()},3e4)}),(s,t)=>(r(),q(Me,null,{header:g(()=>[o.value?(r(),u("div",Oe,[t[19]||(t[19]=e("p",{class:"text-sm text-red-800 mb-2"},"Debug: Test cancellation eligibility",-1)),n(h,{onClick:be,size:"xs"},{default:g(()=>t[18]||(t[18]=[v(" Test Cancellation Eligibility ")])),_:1})])):f("",!0),e("div",ze,[t[23]||(t[23]=e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Driver-Truck Assignments & Monitoring ",-1)),e("div",Ue,[n(B,{onClick:t[0]||(t[0]=l=>s.$inertia.visit(s.route("driver-truck-assignments.backhaul-eligible.show"))),class:"flex items-center"},{default:g(()=>t[20]||(t[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z","clip-rule":"evenodd"})],-1),v(" Backhaul Eligible ")])),_:1}),n(B,{onClick:xe,class:"flex items-center"},{default:g(()=>t[21]||(t[21]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z","clip-rule":"evenodd"})],-1),v(" Create New Assignment ")])),_:1})]),e("div",Pe,[n(je,{modelValue:p.search,"onUpdate:modelValue":t[1]||(t[1]=l=>p.search=l),placeholder:"Search by Driver, Truck, or Region",onKeyup:Le(T,["enter"]),onInput:T,class:"w-64"},null,8,["modelValue"]),n(h,{onClick:ve},{default:g(()=>t[22]||(t[22]=[v(" Reset ")])),_:1})])])]),default:g(()=>[e("div",He,[F.value?(r(),u("div",qe,t[24]||(t[24]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1)]))):L.value?(r(),u("div",Ge,[t[26]||(t[26]=e("svg",{class:"mx-auto h-12 w-12 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)),t[27]||(t[27]=e("h3",{class:"mt-2 text-sm font-medium text-red-800"},"Failed to load assignments",-1)),e("p",We,i(L.value),1),n(B,{onClick:R,class:"mt-4"},{default:g(()=>t[25]||(t[25]=[v(" Try Again ")])),_:1})])):(r(),u(ue,{key:2},[e("div",Ke,[e("div",Ye,[e("div",Ze,[e("div",Je,[n(V(ge),{class:"h-6 w-6 text-blue-600"})]),e("div",null,[t[28]||(t[28]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Assignments",-1)),e("p",Qe,i(m.metrics.total_assignments||0),1)])])]),e("div",Xe,[e("div",et,[t[30]||(t[30]=e("div",{class:"rounded-full bg-purple-100 p-3 mr-4"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})])],-1)),e("div",null,[t[29]||(t[29]=e("p",{class:"text-sm font-medium text-gray-600"},"Backhaul Eligible",-1)),e("p",tt,i(m.metrics.backhaul_eligible||0),1)])])]),e("div",st,[e("div",lt,[t[32]||(t[32]=e("div",{class:"rounded-full bg-yellow-100 p-3 mr-4"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",null,[t[31]||(t[31]=e("p",{class:"text-sm font-medium text-gray-600"},"In Cooldown",-1)),e("p",ot,i(m.metrics.in_cooldown||0),1)])])]),e("div",nt,[e("div",at,[t[34]||(t[34]=e("div",{class:"rounded-full bg-green-100 p-3 mr-4"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),e("div",null,[t[33]||(t[33]=e("p",{class:"text-sm font-medium text-gray-600"},"Active",-1)),e("p",rt,i(m.metrics.active_assignments||0),1)])])])]),e("div",it,[e("div",dt,[t[35]||(t[35]=e("div",null,[e("h3",{class:"text-lg font-medium leading-6 text-gray-900"}," Driver-Truck Assignments & Monitoring "),e("p",{class:"mt-1 text-sm text-gray-500"}," Monitor and manage driver-truck assignments across regions. ")],-1)),e("div",ut,[n(C,{modelValue:p.region_id,"onUpdate:modelValue":t[2]||(t[2]=l=>p.region_id=l),options:W.value,placeholder:"Filter by Region",class:"w-44",onChange:T},null,8,["modelValue","options"]),n(C,{modelValue:p.status,"onUpdate:modelValue":t[3]||(t[3]=l=>p.status=l),options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"all",label:"All"}],class:"w-32",placeholder:"Status",onChange:T},null,8,["modelValue"]),n(C,{modelValue:p.driver_status,"onUpdate:modelValue":t[4]||(t[4]=l=>p.driver_status=l),options:me.value,class:"w-40",placeholder:"Driver Status",onChange:T},null,8,["modelValue","options"]),n(C,{modelValue:p.cooldown_completed,"onUpdate:modelValue":t[5]||(t[5]=l=>p.cooldown_completed=l),options:pe.value,class:"w-48",placeholder:"Cooldown Status",onChange:T},null,8,["modelValue","options"])])]),e("div",ct,[e("table",gt,[t[40]||(t[40]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Driver"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Truck"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Region"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assignment Status"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assignment Type"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned At"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Current Region"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",mt,[(r(!0),u(ue,null,Ie(m.assignments.data,l=>{var c,d,x,k,D;return r(),u("tr",{key:l.id,class:"hover:bg-gray-50"},[e("td",pt,[e("div",vt,[n(V(Fe),{class:"h-5 w-5 text-gray-400 mr-2"}),e("div",null,[e("span",null,i(((c=l.driver)==null?void 0:c.name)||"N/A"),1),e("div",xt,i(((x=(d=l.driver)==null?void 0:d.employee_profile)==null?void 0:x.employee_id)||"No ID"),1)])])]),e("td",bt,[e("div",ft,[n(V(ge),{class:"h-5 w-5 text-gray-400 mr-2"}),e("div",null,[e("div",null,i(((k=l.truck)==null?void 0:k.license_plate)||"N/A"),1),e("div",wt,i(l.truck?`${l.truck.make} ${l.truck.model}`:""),1)])])]),e("td",yt,[e("div",null,[e("div",null,i(((D=l.region)==null?void 0:D.name)||"N/A"),1),l.current_status==="backhaul_eligible"&&l.current_region?(r(),u("div",_t," Current: "+i(l.current_region.name),1)):f("",!0)])]),e("td",kt,[e("span",{class:N(["px-2 py-1 rounded-full text-xs font-semibold",J(l.current_status)])},i(Q(l.current_status)),3),l.current_status==="cooldown"?(r(),u("div",ht,[e("div",Ct,[v(" Ends: "+i(De(l.cooldown_ends_at))+" ",1),P(l)?(r(),u("span",At," (Ready) ")):f("",!0)]),l.is_final_cooldown?(r(),u("div",Rt," Final Cooldown ")):f("",!0)])):f("",!0)]),e("td",Tt,[e("span",{class:N(["px-2 py-1 rounded-full text-xs font-semibold",l.current_status==="backhaul_eligible"?"bg-purple-100 text-purple-800 border border-purple-300":"bg-blue-100 text-blue-800 border border-blue-300"])},[l.current_status==="backhaul_eligible"?(r(),u("span",St,t[36]||(t[36]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z","clip-rule":"evenodd"})],-1),v(" Backhaul ")]))):(r(),u("span",Dt,t[37]||(t[37]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1 1 0 11-3 0 1 1 0 013 0z"}),e("path",{d:"M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1v-1a1 1 0 011-1h2a1 1 0 011 1v1a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H19a1 1 0 001-1V5a1 1 0 00-1-1H3z"})],-1),v(" Regular ")])))],2)]),e("td",Et,[e("span",Vt,i(Te(l.assigned_at)),1)]),e("td",It,[e("div",null,[e("div",null,i(X(l)),1)])]),e("td",Lt,[e("div",Mt,[n(h,{onClick:E=>we(l),size:"xs",title:"View Details"},{default:g(()=>[n(V(Ne),{class:"w-3 h-3"})]),_:2},1032,["onClick"]),n(h,{onClick:E=>Ce(l),size:"xs",title:"View Status History"},{default:g(()=>t[38]||(t[38]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z","clip-rule":"evenodd"})],-1)])),_:2},1032,["onClick"]),Ee(l)?(r(),q(ce,{key:0,onClick:E=>_e(l),size:"xs",title:"Cancel Assignment"},{default:g(()=>[n(V(Be),{class:"w-3 h-3"})]),_:2},1032,["onClick"])):f("",!0)])])])}),128)),!m.assignments.data||m.assignments.data.length===0?(r(),u("tr",jt,t[39]||(t[39]=[e("td",{colspan:"8",class:"px-6 py-4 text-center text-sm text-gray-500"}," No assignments found ",-1)]))):f("",!0)])])]),e("div",$t,[e("div",Nt,[e("button",{onClick:t[6]||(t[6]=l=>K(m.assignments.current_page-1)),disabled:m.assignments.current_page<=1,class:"px-3 py-1 rounded border text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50"},"Previous",8,Bt),e("span",null,"Page "+i(m.assignments.current_page)+" of "+i(m.assignments.last_page),1),e("button",{onClick:t[7]||(t[7]=l=>K(m.assignments.current_page+1)),disabled:m.assignments.current_page>=m.assignments.last_page,class:"px-3 py-1 rounded border text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50"},"Next",8,Ft)])])])],64))]),n(G,{show:M.value,onClose:Y},{default:g(()=>[e("div",Ot,[t[43]||(t[43]=e("h2",{class:"text-lg font-medium mb-4"}," Create New Assignment ",-1)),e("div",zt,[n(C,{label:"Region",modelValue:a.region_id,"onUpdate:modelValue":[t[8]||(t[8]=l=>a.region_id=l),t[9]||(t[9]=l=>{console.log("ðŸ”§ SelectInput modelValue updated:",l),a.region_id=l,ye(l)})],options:W.value.filter(l=>l.value),required:""},null,8,["modelValue","options"]),n(C,{label:"Driver",modelValue:a.driver_id,"onUpdate:modelValue":t[10]||(t[10]=l=>a.driver_id=l),options:j.value,required:"",disabled:!a.region_id,loading:O.value},null,8,["modelValue","options","disabled","loading"]),n(C,{label:"Truck",modelValue:a.truck_id,"onUpdate:modelValue":t[11]||(t[11]=l=>a.truck_id=l),options:$.value,required:"",disabled:!a.region_id,loading:z.value},null,8,["modelValue","options","disabled","loading"])]),e("div",Ut,[n(h,{onClick:Y},{default:g(()=>t[41]||(t[41]=[v(" Cancel ")])),_:1}),n(B,{onClick:fe,disabled:a.processing||!a.region_id,loading:a.processing},{default:g(()=>t[42]||(t[42]=[v(" Create Assignment ")])),_:1},8,["disabled","loading"])])]),e("div",Pt,[t[45]||(t[45]=e("p",{class:"text-sm text-yellow-800 mb-2"},"Debug: Test resource loading",-1)),n(h,{onClick:ke,size:"xs"},{default:g(()=>t[44]||(t[44]=[v(" Test Load Resources ")])),_:1})])]),_:1},8,["show"]),n(G,{show:A.value,onClose:t[13]||(t[13]=l=>A.value=!1),"max-width":"2xl"},{default:g(()=>{var l,c,d,x,k,D,E,ne,ae,re,ie;return[o.value?(r(),u("div",Ht,[t[66]||(t[66]=e("h2",{class:"text-xl font-semibold mb-6 text-gray-800"},"Assignment Details",-1)),e("div",qt,[e("div",Gt,[t[53]||(t[53]=e("h3",{class:"font-semibold text-gray-700 mb-3 border-b pb-2"},"Driver Information",-1)),e("div",Wt,[e("div",Kt,[t[46]||(t[46]=e("span",{class:"text-gray-500"},"Name",-1)),e("span",Yt,i(((l=o.value.driver)==null?void 0:l.name)||"N/A"),1)]),e("div",Zt,[t[47]||(t[47]=e("span",{class:"text-gray-500"},"Employee ID",-1)),e("span",Jt,i(((d=(c=o.value.driver)==null?void 0:c.employee_profile)==null?void 0:d.employee_id)||"N/A"),1)]),e("div",Qt,[t[48]||(t[48]=e("span",{class:"text-gray-500"},"Home Region",-1)),e("span",Xt,i(((x=o.value.region)==null?void 0:x.name)||"N/A"),1)]),e("div",es,[t[49]||(t[49]=e("span",{class:"text-gray-500"},"Current Region",-1)),e("span",ts,i(X(o.value)),1)]),e("div",ss,[t[50]||(t[50]=e("span",{class:"text-gray-500"},"Driver Status",-1)),e("span",{class:N(["font-medium px-2 py-1 rounded text-xs",J(o.value.current_status)])},i(Q(o.value.current_status)),3)]),o.value.current_status==="cooldown"&&o.value.cooldown_ends_at?(r(),u("div",ls,[t[51]||(t[51]=e("span",{class:"text-gray-500"},"Cooldown Ends",-1)),e("span",os,i(Se(o.value.cooldown_ends_at)),1),P(o.value)?(r(),u("span",ns," (Ready for action) ")):f("",!0)])):f("",!0),o.value.is_final_cooldown?(r(),u("div",as,t[52]||(t[52]=[e("span",{class:"text-gray-500"},"Cooldown Type",-1),e("span",{class:"font-medium text-red-600"},"Final Cooldown",-1)]))):f("",!0)])]),e("div",rs,[t[58]||(t[58]=e("h3",{class:"font-semibold text-gray-700 mb-3 border-b pb-2"},"Truck Information",-1)),e("div",is,[e("div",ds,[t[54]||(t[54]=e("span",{class:"text-gray-500"},"License Plate",-1)),e("span",us,i(((k=o.value.truck)==null?void 0:k.license_plate)||"N/A"),1)]),e("div",cs,[t[55]||(t[55]=e("span",{class:"text-gray-500"},"Make/Model",-1)),e("span",gs,i(`${((D=o.value.truck)==null?void 0:D.make)||""} ${((E=o.value.truck)==null?void 0:E.model)||""}`.trim()||"N/A"),1)]),e("div",ms,[t[56]||(t[56]=e("span",{class:"text-gray-500"},"Status",-1)),e("span",{class:N(["font-medium px-2 py-1 rounded text-xs",Ae((ne=o.value.truck)==null?void 0:ne.status)])},i(Re((ae=o.value.truck)==null?void 0:ae.status)),3)]),e("div",ps,[t[57]||(t[57]=e("span",{class:"text-gray-500"},"Current Load",-1)),e("span",vs,i(`${((re=o.value.truck)==null?void 0:re.current_volume)??0}mÂ³ / ${((ie=o.value.truck)==null?void 0:ie.volume_capacity)??0}mÂ³`),1)])])])]),e("div",xs,[t[64]||(t[64]=e("h3",{class:"font-semibold text-blue-800 mb-2"},"Current Workflow Status",-1)),e("div",bs,[o.value.current_status==="cooldown"&&o.value.is_final_cooldown?(r(),u("div",fs,t[59]||(t[59]=[e("p",null,[e("strong",null,"Final Cooldown Period Active")],-1),e("p",null,"Driver will complete cooldown to finish assignment and free up driver/truck.",-1)]))):o.value.current_status==="cooldown"?(r(),u("div",ws,t[60]||(t[60]=[e("p",null,[e("strong",null,"Regular Cooldown Period Active")],-1),e("p",null,"Driver can choose:",-1),e("ul",{class:"ml-4 list-disc"},[e("li",null,[e("strong",null,"Option A:"),v(" Skip cooldown to become backhaul eligible immediately")]),e("li",null,[e("strong",null,"Option B:"),v(" Return without backhaul to home region")]),e("li",null,[e("strong",null,"Wait:"),v(" Cooldown will automatically finish and become backhaul eligible")])],-1)]))):o.value.current_status==="backhaul_eligible"?(r(),u("div",ys,t[61]||(t[61]=[e("p",null,[e("strong",null,"Backhaul Eligible")],-1),e("p",null,"Driver is waiting for backhaul assignments or can choose to return without backhaul.",-1)]))):o.value.current_status==="returning"?(r(),u("div",_s,t[62]||(t[62]=[e("p",null,[e("strong",null,"Returning to Home Region (Option B)")],-1),e("p",null,"Driver is returning to home base without backhaul. Will enter final cooldown upon arrival.",-1)]))):o.value.current_status==="active"?(r(),u("div",ks,t[63]||(t[63]=[e("p",null,[e("strong",null,"Active Assignment")],-1),e("p",null,"Driver is actively working on their primary assignment.",-1)]))):f("",!0)])]),e("div",hs,[n(h,{onClick:t[12]||(t[12]=Rs=>A.value=!1)},{default:g(()=>t[65]||(t[65]=[v(" Close ")])),_:1})])])):f("",!0)]}),_:1},8,["show"]),n(G,{show:S.value,onClose:t[17]||(t[17]=l=>S.value=!1)},{default:g(()=>{var l;return[e("div",Cs,[t[69]||(t[69]=e("h2",{class:"text-lg font-medium mb-4 text-red-600"}," Cancel Assignment ",-1)),t[70]||(t[70]=e("p",{class:"text-gray-600 mb-4"}," This will cancel the assignment and free up both driver and truck for new assignments. Please provide a reason for cancellation. ",-1)),n(C,{label:"Cancellation Reason",modelValue:_.value,"onUpdate:modelValue":t[14]||(t[14]=c=>_.value=c),options:[{value:"driver_unavailable",label:"Driver Unavailable"},{value:"truck_maintenance",label:"Truck Maintenance"},{value:"reassigned",label:"Reassigned"},{value:"other",label:"Other Reason"}],required:""},null,8,["modelValue"]),_.value==="other"?(r(),q($e,{key:0,label:"Additional Remarks",modelValue:s.cancelRemarks,"onUpdate:modelValue":t[15]||(t[15]=c=>s.cancelRemarks=c),placeholder:"Please specify the reason...",class:"mt-4"},null,8,["modelValue"])):f("",!0),e("div",As,[n(h,{onClick:t[16]||(t[16]=c=>S.value=!1)},{default:g(()=>t[67]||(t[67]=[v(" Cancel ")])),_:1}),n(ce,{onClick:he,loading:U.value===((l=y.value)==null?void 0:l.id)},{default:g(()=>t[68]||(t[68]=[v(" Cancel Assignment ")])),_:1},8,["loading"])])])]}),_:1},8,["show"])]),_:1}))}};export{Os as default};
