import{g as u,i as R,h as ne,W as f,d as re,o as d,w as l,c as p,e as j,b as s,a as o,t as r,f as n,l as ie,J as ue}from"./app-B0R_bMJi.js";import{E as de}from"./EmployeeLayout-BQLa5PLV.js";import{_ as M}from"./PrimaryButton-z6gddSkS.js";import{_ as S}from"./SecondaryButton-BDpVYXxA.js";import{D as $}from"./DangerButton-DlTel5kP.js";import{P as pe}from"./Pagination-Cqnyvcnt.js";import{_ as ce}from"./SearchInput-BHbkz-wy.js";import{S as U}from"./SelectInput-f4kpY-DU.js";import{_ as me}from"./DataTable-C_2NMP2T.js";import{_ as E}from"./InputLabel-BebyH7Kw.js";import{_ as ve}from"./TextArea-DUZFOSeU.js";import{M as I}from"./Modal-Oa0ozw3w.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./NavLink-BchASNUp.js";/* empty css                                                                    */const fe={class:"flex justify-between items-center"},ye={class:"flex space-x-2"},_e={key:0,class:"mb-6 mx-4 sm:mx-0"},ge={key:0,class:"p-4 bg-blue-100 text-blue-800 rounded"},he={key:1,class:"p-4 bg-green-100 text-green-800 rounded"},xe={key:2,class:"p-4 bg-red-100 text-red-800 rounded"},be={class:"mb-6 mx-4 sm:mx-0 flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},ke={class:"flex flex-wrap gap-2 w-full md:w-auto"},we={class:"mx-4 sm:mx-0"},Ce={key:0},Re={key:1},je={class:"flex space-x-2"},Ae={class:"mt-4 mx-4 sm:mx-0 flex justify-center"},Pe={class:"p-6"},Ve={class:"mt-1 text-sm text-gray-600"},Se={key:0,class:"mt-4"},qe={class:"mt-2 text-sm text-gray-700"},Ne={class:"mt-6 flex justify-end space-x-4"},Te={key:0},De={key:1},Me={class:"p-6"},$e={class:"mt-1 text-sm text-gray-600"},Ue={class:"mt-4"},Oe={key:0,class:"mt-4"},Fe={class:"mt-6 flex justify-end space-x-4"},Le={key:0},Be={key:1},st={__name:"PendingRequests",props:{requests:{type:Array,required:!0,default:()=>[]},pagination:{type:Object,default:()=>({current_page:1,last_page:1,links:[]})},filters:{type:Object,default:()=>({search:"",payment_method:"",date_range:"all"})},status:String,success:String,error:String},setup(m){const x=m,v=u(x.filters.search||""),b=u(x.filters.payment_method||""),A=u(x.filters.date_range||"all"),y=u("created_at"),P=u("desc"),q=u(!1),N=u(!1),i=u(null),k=u(null),_=u(!1),g=u(""),V=u(""),w=u(""),W=[{value:"",text:"All Payment Types"},{value:"prepaid",text:"Prepaid"},{value:"postpaid",text:"Postpaid"}],O=R(()=>{var a;return Number((a=x.pagination)==null?void 0:a.current_page)||1}),F=R(()=>{var a;return Number((a=x.pagination)==null?void 0:a.last_page)||1}),J=R(()=>{var a;return{current_page:O.value,last_page:F.value,links:((a=x.pagination)==null?void 0:a.links)||[]}}),Y=[{value:"",text:"All Methods"},{value:"cash",text:"Cash"},{value:"card",text:"Card"},{value:"online",text:"Online"}],z=[{value:"all",text:"All Time"},{value:"today",text:"Today"},{value:"week",text:"This Week"},{value:"month",text:"This Month"},{value:"year",text:"This Year"}],G=[{field:"id",header:"ID",sortable:!0},{field:"sender",header:"Sender",sortable:!0},{field:"receiver",header:"Receiver",sortable:!0},{field:"pick_up_region",header:"Pick-up",sortable:!0},{field:"drop_off_region",header:"Drop-off",sortable:!0},{field:"total_price",header:"Amount",sortable:!0},{field:"payment_type",header:"Payment Type",sortable:!0},{field:"created_at",header:"Date",sortable:!0},{field:"payment_terms",header:"Payment Terms",sortable:!1},{field:"actions",header:"Actions",sortable:!1}],L=R(()=>(x.requests||[]).map(a=>({...a,payment_type:a.payment_type??(["cash","gcash","bank"].includes(a.payment_method)?"prepaid":"postpaid")}))),H=R(()=>L.value?L.value.filter(a=>{var h,C;const e=v.value===""||((h=a.sender)==null?void 0:h.toLowerCase().includes(v.value.toLowerCase()))||((C=a.receiver)==null?void 0:C.toLowerCase().includes(v.value.toLowerCase()))||a.id.toString().includes(v.value),t=b.value===""||a.payment_method===b.value,c=w.value===""||a.payment_type===w.value;return e&&t&&c}).sort((a,e)=>{if(!y.value)return 0;const t=P.value==="asc"?1:-1;return a[y.value]<e[y.value]?-1*t:a[y.value]>e[y.value]?1*t:0}):[]),B=R(()=>g.value==="other"?V.value.trim().length>0:g.value!=="");ne([v,b,A,w],()=>{f.get(route("deliveries.pending"),{search:v.value,payment_method:b.value,date_range:A.value,payment_type:w.value,page:1},{preserveState:!0,replace:!0})});function K(a){y.value===a?P.value=P.value==="asc"?"desc":"asc":(y.value=a,P.value="asc")}function Q(a){f.get(route("deliveries.show",a))}function X(a){f.get(route("deliveries.edit",a))}function Z(){f.get(route("deliveries.index"))}function ee(){f.get(route("deliveries.rejected"))}function te(a){f.get(route("deliveries.pending"),{page:a,search:v.value,payment_method:b.value,date_range:A.value},{preserveState:!0})}function ae(a){i.value=a,q.value=!0}function T(){q.value=!1,i.value=null}function se(a){k.value=a,N.value=!0}function D(){N.value=!1,k.value=null,g.value="",V.value=""}async function le(){if(i.value){_.value=!0;try{await f.post(route("deliveries.approve",i.value.id),{},{preserveScroll:!0,onSuccess:()=>{T(),f.reload({only:["requests","pagination","status","success","error"]})},onError:a=>{}})}catch{}finally{_.value=!1}}}async function oe(){if(!(!k.value||!B.value)){_.value=!0;try{const a=g.value==="other"?V.value:g.value;await f.post(route("deliveries.reject",k.value.id),{rejection_reason:a},{preserveScroll:!0,onSuccess:()=>{D()}})}catch(a){console.error("Rejection failed:",a)}finally{_.value=!1}}}return(a,e)=>(d(),re(de,null,{header:l(()=>[s("div",fe,[e[8]||(e[8]=s("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Pending Delivery Requests ",-1)),s("div",ye,[o(S,{onClick:Z},{default:l(()=>e[6]||(e[6]=[n(" Approved Requests ")])),_:1}),o($,{onClick:ee},{default:l(()=>e[7]||(e[7]=[n(" Rejected Requests ")])),_:1})])])]),default:l(()=>[m.status||m.success||m.error?(d(),p("div",_e,[m.status?(d(),p("div",ge,r(m.status),1)):j("",!0),m.success?(d(),p("div",he,r(m.success),1)):j("",!0),m.error?(d(),p("div",xe,r(m.error),1)):j("",!0)])):j("",!0),s("div",be,[o(ce,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),placeholder:"Search requests...",class:"w-full md:w-64"},null,8,["modelValue"]),s("div",ke,[o(U,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=t=>w.value=t),options:W,"option-value":"value","option-label":"text",placeholder:"All Payment Types",class:"w-full md:w-48"},null,8,["modelValue"]),o(U,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),options:Y,"option-value":"value","option-label":"text",placeholder:"All Payment Methods",class:"w-full md:w-48"},null,8,["modelValue"]),o(U,{modelValue:A.value,"onUpdate:modelValue":e[3]||(e[3]=t=>A.value=t),options:z,"option-value":"value","option-label":"text",placeholder:"Filter by date",class:"w-full md:w-48"},null,8,["modelValue"])])]),s("div",we,[o(me,{columns:G,data:H.value,"sort-field":y.value,"sort-direction":P.value,onSort:K},{sender:l(({row:t})=>[n(r(t.sender),1)]),receiver:l(({row:t})=>[n(r(t.receiver),1)]),pick_up_region:l(({row:t})=>[n(r(t.pick_up_region||"N/A"),1)]),drop_off_region:l(({row:t})=>[n(r(t.drop_off_region||"N/A"),1)]),total_price:l(({row:t})=>[n(" â‚±"+r(t.total_price),1)]),payment_type:l(({row:t})=>[n(r(t.payment_type?t.payment_type.charAt(0).toUpperCase()+t.payment_type.slice(1):"N/A"),1)]),created_at:l(({row:t})=>[n(r(new Date(t.created_at).toLocaleDateString()),1)]),payment_terms:l(({row:t})=>[t.payment_terms?(d(),p("span",Ce,r(t.payment_terms==="net_7"?"Net 7":t.payment_terms==="net_15"?"Net 15":t.payment_terms==="net_30"?"Net 30":t.payment_terms==="cnd"?"CND":t.payment_terms),1)):(d(),p("span",Re,"-"))]),actions:l(({row:t})=>[s("div",je,[o(S,{onClick:c=>Q(t.id)},{default:l(()=>e[9]||(e[9]=[n(" View ")])),_:2},1032,["onClick"]),o(M,{onClick:c=>X(t.id)},{default:l(()=>e[10]||(e[10]=[n(" Edit ")])),_:2},1032,["onClick"]),o(M,{onClick:c=>ae(t)},{default:l(()=>e[11]||(e[11]=[n(" Approve ")])),_:2},1032,["onClick"]),o($,{onClick:c=>se(t)},{default:l(()=>e[12]||(e[12]=[n(" Reject ")])),_:2},1032,["onClick"])])]),_:1},8,["data","sort-field","sort-direction"])]),s("div",Ae,[o(pe,{"current-page":O.value,"total-pages":F.value,pagination:J.value,onPageChanged:te},null,8,["current-page","total-pages","pagination"])]),o(I,{show:q.value,onClose:T},{default:l(()=>{var t,c,h;return[s("div",Pe,[e[17]||(e[17]=s("h2",{class:"text-lg font-medium text-gray-900"}," Approve Delivery Request? ",-1)),s("p",Ve,[n(" Are you sure you want to approve request #"+r((t=i.value)==null?void 0:t.id)+" from ",1),s("strong",null,r((c=i.value)==null?void 0:c.sender),1),e[13]||(e[13]=n(" to ")),s("strong",null,r((h=i.value)==null?void 0:h.receiver),1),e[14]||(e[14]=n("? "))]),i.value?(d(),p("div",Se,[s("div",qe,[e[15]||(e[15]=s("span",{class:"font-semibold"},"Payment Terms:",-1)),s("span",null,r(i.value.payment_terms==="net_7"?"Net 7":i.value.payment_terms==="net_15"?"Net 15":i.value.payment_terms==="net_30"?"Net 30":i.value.payment_terms==="cnd"?"CND":i.value.payment_terms||"-"),1)])])):j("",!0),s("div",Ne,[o(S,{onClick:T},{default:l(()=>e[16]||(e[16]=[n(" Cancel ")])),_:1}),o(M,{onClick:le,disabled:_.value},{default:l(()=>[_.value?(d(),p("span",Te,"Approving...")):(d(),p("span",De,"Approve"))]),_:1},8,["disabled"])])])]}),_:1},8,["show"]),o(I,{show:N.value,onClose:D},{default:l(()=>{var t,c,h;return[s("div",Me,[e[22]||(e[22]=s("h2",{class:"text-lg font-medium text-gray-900"}," Reject Delivery Request? ",-1)),s("p",$e,[n(" Are you sure you want to reject request #"+r((t=k.value)==null?void 0:t.id)+" from ",1),s("strong",null,r((c=k.value)==null?void 0:c.sender),1),e[18]||(e[18]=n(" to ")),s("strong",null,r((h=k.value)==null?void 0:h.receiver),1),e[19]||(e[19]=n("? "))]),s("div",Ue,[o(E,{for:"rejection_reason",value:"Reason for Rejection",required:""}),ie(s("select",{id:"rejection_reason","onUpdate:modelValue":e[4]||(e[4]=C=>g.value=C),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",required:""},e[20]||(e[20]=[s("option",{value:"",disabled:""},"Select a reason",-1),s("option",{value:"Incomplete information"},"Incomplete information",-1),s("option",{value:"Unserviceable location"},"Unserviceable location",-1),s("option",{value:"Payment issues"},"Payment issues",-1),s("option",{value:"Prohibited items"},"Prohibited items",-1),s("option",{value:"other"},"Other (specify below)",-1)]),512),[[ue,g.value]])]),g.value==="other"?(d(),p("div",Oe,[o(E,{for:"custom_reason",value:"Custom Reason",required:""}),o(ve,{id:"custom_reason",class:"mt-1 block w-full",modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=C=>V.value=C),rows:3,placeholder:"Please specify the reason for rejection...",required:""},null,8,["modelValue"])])):j("",!0),s("div",Fe,[o(S,{onClick:D},{default:l(()=>e[21]||(e[21]=[n(" Cancel ")])),_:1}),o($,{onClick:oe,disabled:_.value||!B.value},{default:l(()=>[_.value?(d(),p("span",Le,"Rejecting...")):(d(),p("span",Be,"Reject"))]),_:1},8,["disabled"])])])]}),_:1},8,["show"])]),_:1}))}};export{st as default};
