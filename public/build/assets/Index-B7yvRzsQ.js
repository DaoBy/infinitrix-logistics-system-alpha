import{i as S,c as i,o as r,a as v,l as dt,v as ut,b as e,n as O,g as w,C as ct,W as R,h as vt,d as ve,w as y,e as p,f as C,t as l,p as ge,F as W,r as B,u as M,q as Oe}from"./app-B0R_bMJi.js";import{l as gt}from"./lodash-B2rxDOCG.js";import{E as mt}from"./EmployeeLayout-BQLa5PLV.js";import{_ as me}from"./PrimaryButton-z6gddSkS.js";import{_ as pe}from"./SecondaryButton-BDpVYXxA.js";import{D as pt}from"./DangerButton-DlTel5kP.js";import{_ as He}from"./InputLabel-BebyH7Kw.js";import{S as Ee}from"./SelectInput-f4kpY-DU.js";import"./Modal-Oa0ozw3w.js";import{_ as _t}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ht,a as ie}from"./FlashMessages-IjaA0uKo.js";import{_ as ft}from"./DataTable-C_2NMP2T.js";import{P as yt}from"./Pagination-Cqnyvcnt.js";import{_ as bt}from"./StatusBadge-c3owwLTJ.js";import{L as Ie}from"./LoadingSpinner-ZMvEcnIG.js";import{_ as xt}from"./SearchInput-BHbkz-wy.js";import{_ as kt}from"./InputError-BoXW6i3M.js";import{u as wt}from"./index-4gnSGlTA.js";import"./NavLink-BchASNUp.js";/* empty css                                                                    */function _e(g=[]){if(!Array.isArray(g))return 0;const h=g.reduce((f,V)=>{const k=parseFloat(V.volume)||0;return f+k},0);return parseFloat(h.toFixed(2))}function he(g=[]){if(!Array.isArray(g))return 0;const h=g.reduce((f,V)=>{const k=parseFloat(V.weight)||0;return f+k},0);return parseFloat(h.toFixed(2))}function St(g){if(!g)return"N/A";try{return new Date(g).toLocaleDateString()}catch{return"N/A"}}function Pe(g){if(!g)return"N/A";try{return new Date(g).toLocaleString()}catch{return"N/A"}}const At=["id","min"],je={__name:"DateTimeInput",props:{modelValue:String,label:String,error:String,minDate:String,id:{type:String,default:()=>`datetime-${Math.random().toString(36).substring(2,9)}`}},emits:["update:modelValue"],setup(g,{emit:h}){const f=g,V=h,k=S({get(){return f.modelValue},set(ee){V("update:modelValue",ee)}});return(ee,P)=>(r(),i("div",null,[v(He,{for:g.id,value:g.label},null,8,["for","value"]),dt(e("input",{id:g.id,type:"datetime-local","onUpdate:modelValue":P[0]||(P[0]=m=>k.value=m),class:O(["mt-1 block w-full border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 focus:border-indigo-500 dark:focus:border-indigo-600 focus:ring-indigo-500 dark:focus:ring-indigo-600 rounded-md shadow-sm",{"border-red-500 dark:border-red-500":g.error}]),min:g.minDate},null,10,At),[[ut,k.value]]),v(kt,{message:g.error,class:"mt-2"},null,8,["message"])]))}},Dt={class:"flex justify-between items-center px-6"},Ct={class:"flex space-x-2"},Vt={key:0,class:"px-6 py-2"},Mt={class:"px-6 py-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600"},Ft={class:"flex flex-row items-center gap-4"},Tt={class:"flex-1 flex flex-row items-center gap-4"},Nt={class:"px-6 py-4"},zt={class:"bg-white dark:bg-gray-800 shadow-sm rounded-lg border border-gray-200 dark:border-gray-700 mb-6"},$t={class:"p-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"},qt={class:"text-sm text-gray-500 dark:text-gray-400"},Wt={class:"flex flex-col items-center"},Bt={key:0,class:"text-yellow-500",title:"Some packages are missing stickers"},Ot={class:"flex space-x-1"},Et={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},It={class:"lg:col-span-1"},Pt={class:"bg-white dark:bg-gray-800 shadow-sm rounded-lg border border-gray-200 dark:border-gray-700"},jt={class:"p-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-700"},Ht={class:"flex justify-between items-center"},Rt={class:"font-medium text-gray-900 dark:text-gray-100"},Ut={class:"divide-y divide-gray-200 dark:divide-gray-700 max-h-96 overflow-y-auto"},Lt={class:"flex justify-between items-start"},Yt={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Gt={class:"text-xs text-gray-500 dark:text-gray-400"},Jt={class:"mt-1 text-xs"},Kt={key:0,class:"text-yellow-600 dark:text-yellow-400 flex items-center"},Qt=["onClick"],Xt={key:1,class:"p-4 text-center text-gray-500 dark:text-gray-400"},Zt={key:0,class:"p-4 border-t border-gray-200 dark:border-gray-700"},es={class:"text-sm"},ts={key:0,class:"text-yellow-600 dark:text-yellow-400 font-medium"},ss={class:"lg:col-span-2"},as={class:"bg-white dark:bg-gray-800 shadow-sm rounded-lg border border-gray-200 dark:border-gray-700"},ls={class:"p-4"},rs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},is=["onClick"],os={class:"flex items-start space-x-3"},ns={class:"flex-1"},ds={class:"flex items-center space-x-2"},us={class:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center"},cs={class:"text-gray-600 dark:text-gray-300 font-medium"},vs={class:"font-medium"},gs={class:"text-xs text-gray-500 dark:text-gray-400"},ms={class:"mt-2 text-xs"},ps={class:"flex-1"},_s={class:"flex items-center space-x-2"},hs={class:"font-medium"},fs={class:"text-xs text-gray-500 dark:text-gray-400"},ys={class:"mt-2 space-y-2"},bs={class:"text-xs"},xs={class:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5"},ks={class:"text-xs"},ws={class:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5"},Ss={key:0,class:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700"},As={key:0},Ds={key:1},Cs={key:1,class:"p-4 text-center text-gray-500 dark:text-gray-400"},Vs={class:"mt-8 bg-white dark:bg-gray-800 shadow-sm rounded-lg border border-gray-200 dark:border-gray-700"},Ms={class:"p-4"},Fs={key:0,class:"space-y-4"},Ts={class:"flex justify-between items-start"},Ns={class:"font-medium"},zs={class:"text-sm text-gray-600 dark:text-gray-400"},$s={class:"text-sm mt-2"},qs={key:0,class:"text-yellow-600 dark:text-yellow-400 text-sm mt-1"},Ws={key:0,class:"mt-4"},Bs={class:"text-sm font-medium"},Os={class:"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2"},Es=["onClick"],Is={class:"font-medium"},Ps={class:"text-xs"},js={class:"text-xs"},Hs={class:"text-xs text-gray-500"},Rs={key:1,class:"mt-4 text-sm text-yellow-600"},Us={key:1,class:"text-center text-gray-500 dark:text-gray-400"},Ls={class:"space-y-4"},Ys={class:"font-medium"},Gs={key:0,class:"mt-2 list-disc list-inside"},Js={key:1,class:"mt-2 text-yellow-700 text-xs"},Ks={class:"grid grid-cols-2 gap-4"},Qs={class:"text-lg"},Xs={class:"text-xs"},Zs={class:"text-lg"},ea={class:"text-xs"},ta={class:"mt-4"},sa={key:0,class:"text-xs text-blue-600 mt-1"},aa={key:0,class:"mt-2 text-sm"},la={key:0},ra={class:"space-y-4"},ia={class:"font-medium"},oa={key:0,class:"mt-2 list-disc list-inside"},na={class:"grid grid-cols-2 gap-4"},da={class:"text-lg"},ua={class:"text-xs"},ca={class:"text-lg"},va={class:"text-xs"},ga={key:0,class:"mt-4"},ma={class:"flex items-center"},pa={class:"text-xs"},_a={key:1,class:"mt-4"},ha={key:2,class:"mt-2 text-sm"},fa={class:"space-y-3"},ya={key:0,class:"flex items-center space-x-2"},ba={key:1},xa={key:0,class:"bg-green-50 text-green-800 p-2 rounded"},ka={key:1,class:"bg-red-50 text-red-800 p-2 rounded"},wa={key:0},Sa={key:1},Aa={key:2},Da={__name:"Index",props:{deliveries:{type:Object,default:()=>({data:[]})},driverTruckSets:{type:Array,default:()=>[]},regions:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},flash:{type:Object,default:()=>({})}},setup(g){var Me,Fe,Te;const h=wt(),f=g,V=S(()=>f.driverTruckSets),k=S(()=>f.deliveries),ee=S(()=>f.regions),P=w(!1),m=w([]),o=w(null),oe=w(!1),te=w(null),U=w(((Me=f.filters)==null?void 0:Me.search)||""),L=w(((Fe=f.filters)==null?void 0:Fe.status)||""),Y=w(((Te=f.filters)==null?void 0:Te.region_id)||""),D=ct({driver_truck_assignment_id:null,delivery_request_ids:[],estimated_departure:(()=>{const a=new Date;return a.setDate(a.getDate()+1),a.toISOString().slice(0,16)})(),notes:null}),Re=[{value:"",label:"All Statuses"},{value:"ready",label:"Ready"},{value:"assigned",label:"Assigned"},{value:"dispatched",label:"Dispatched"},{value:"in_transit",label:"In Transit"},{value:"delivered",label:"Delivered"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"},{value:"pending_payment",label:"Pending Payment"}],Ue=S(()=>[{value:"",label:"All Regions"},...ee.value.map(a=>({value:a.id,label:a.name}))]),Le=[{field:"id",header:"DO #",class:"w-24",sortable:!0,formatter:a=>a?`DO-${a.toString().padStart(6,"0")}`:"N/A"},{field:"delivery_request",header:"Route",formatter:a=>{var n,c;if(!a)return"N/A";const t=((n=a.pick_up_region)==null?void 0:n.name)||"N/A",d=((c=a.drop_off_region)==null?void 0:c.name)||"N/A";return`${t} → ${d}`},sortable:!0},{field:"status",header:"Status",slot:!0,sortable:!0},{field:"packages",header:"Packages",slot:!0,class:"text-center",sortable:!1},{field:"estimated_departure",header:"Est. Departure",formatter:a=>a?St(a):"N/A",class:"whitespace-nowrap",sortable:!0},{field:"actions",header:"Actions",slot:!0,class:"w-32 text-right"}],Ye=S(()=>f.flash&&(f.flash.status||f.flash.success||f.flash.error)),G=S(()=>m.value.length?m.value.reduce((a,t)=>{var n;const d=((n=t.delivery_request)==null?void 0:n.packages)||[];return a+_e(d)},0):0),J=S(()=>m.value.length?m.value.reduce((a,t)=>{var n;const d=((n=t.delivery_request)==null?void 0:n.packages)||[];return a+he(d)},0):0),ne=S(()=>m.value.some(a=>se(a))),se=a=>{var d;return(((d=a.delivery_request)==null?void 0:d.packages)||[]).some(n=>n.sticker_printed_at===null)},fe=a=>a.delivery_requests.some(t=>se(t)),Ge=a=>{m.value=a},Je=a=>{m.value=m.value.filter(t=>t.id!==a)},Ke=()=>{m.value=[]},ye=a=>{o.value=a},be=()=>{P.value=!0,R.reload({preserveState:!0,preserveScroll:!0,onFinish:()=>{P.value=!1}})},de=gt.debounce(()=>{R.get(route("cargo-assignments.index"),{search:U.value,status:L.value,region_id:Y.value},{preserveState:!0,preserveScroll:!0,replace:!0})},300),Qe=()=>{U.value="",L.value="",Y.value="",de()},Xe=a=>{R.get(route("employee.assignments.index"),{...f.filters,page:a},{preserveState:!0,preserveScroll:!0})},Ze=a=>{R.get(route("employee.delivery-orders.show",a))},et=a=>{te.value=a,oe.value=!0},xe=()=>{oe.value=!1,te.value=null},tt=()=>{te.value&&R.delete(route("employee.delivery-orders.cancel",te.value.id),{preserveScroll:!0,onSuccess:()=>{h.success("Delivery order cancelled successfully"),xe()},onError:a=>{h.error("Failed to cancel delivery order")}})},st=a=>({ready:"bg-blue-100 text-blue-800",assigned:"bg-yellow-100 text-yellow-800",dispatched:"bg-purple-100 text-purple-800",in_transit:"bg-indigo-100 text-indigo-800",delivered:"bg-green-100 text-green-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",pending_payment:"bg-orange-100 text-orange-800"})[a]||"bg-gray-100 text-gray-800",at=a=>({ready:"Ready",assigned:"Assigned",dispatched:"Dispatched",in_transit:"In Transit",delivered:"Delivered",completed:"Completed",cancelled:"Cancelled",pending_payment:"Pending Payment"})[a]||a;vt([U,L,Y],de);const ke=S(()=>{var d;const a=((d=k.value.data)==null?void 0:d.filter(n=>n.status==="ready"))||[],t={};return a.forEach(n=>{var I,F,T,N,Q;const c=(F=(I=n.delivery_request)==null?void 0:I.drop_off_region)==null?void 0:F.id,j=(N=(T=n.delivery_request)==null?void 0:T.pick_up_region)==null?void 0:N.id;if(!c||!j)return;t[c]||(t[c]={destination_region:n.delivery_request.drop_off_region,pickup_region:n.delivery_request.pick_up_region,delivery_requests:[],total_volume:0,total_weight:0}),t[c].delivery_requests.push(n);const E=((Q=n.delivery_request)==null?void 0:Q.packages)||[];t[c].total_volume+=_e(E),t[c].total_weight+=he(E)}),Object.values(t)}),ae=a=>{var d,n;const t=(n=(d=a.delivery_requests[0])==null?void 0:d.delivery_request)==null?void 0:n.pick_up_region_id;return t?V.value.filter(c=>{var F,T,N;const j=((F=c.region)==null?void 0:F.id)==t,E=(((T=c.truck)==null?void 0:T.volume_capacity)||0)-(c.current_volume||0),I=(((N=c.truck)==null?void 0:N.weight_capacity)||0)-(c.current_weight||0);return j&&c.is_available&&E>=a.total_volume&&I>=a.total_weight}):[]},lt=a=>{m.value=a.delivery_requests;const t=ae(a);t.length>0?(o.value=t[0],we()):h.error("No suitable driver-truck sets available for this batch")},le=w(!1),_=w({isValid:!1,message:"",details:[],availableVolume:0,availableWeight:0,etaWarning:""}),we=()=>{if(!o.value||m.value.length===0){h.error("Please select both deliveries and a driver-truck set");return}if(ne.value){_.value={isValid:!1,message:"Cannot assign deliveries with packages missing stickers",details:["One or more packages have not been labeled (sticker_printed_at is null)"],availableVolume:o.value.truck.volume_capacity-o.value.current_volume,availableWeight:o.value.truck.weight_capacity-o.value.current_weight},le.value=!0;return}const a=o.value.truck.volume_capacity-o.value.current_volume,t=o.value.truck.weight_capacity-o.value.current_weight,d=G.value<=a,n=J.value<=t,c=o.value.driver.canAcceptNewAssignment;_.value={isValid:d&&n&&c,message:d&&n&&c?"Assignment is valid":"Assignment validation failed",details:[d?null:`Volume exceeds capacity by ${(G.value-a).toFixed(2)} m³`,n?null:`Weight exceeds capacity by ${(J.value-t).toFixed(2)} kg`,c?null:"Driver cannot accept new assignments"].filter(Boolean),availableVolume:a,availableWeight:t},le.value=!0},Se=()=>{le.value=!1},Ae=()=>{if(!o.value||m.value.length===0){h.error("Please select both deliveries and a driver-truck set");return}D.driver_truck_assignment_id=o.value.id,D.delivery_request_ids=m.value.map(a=>a.id),D.post(route("cargo-assignments.assign.batch"),{preserveScroll:!0,onSuccess:()=>{h.success("Assignment created successfully"),Se(),m.value=[],o.value=null},onError:a=>{h.error("Failed to create assignment")}})},ue=w(!1),K=w(null),b=w({can_dispatch:!1,has_manifest:!1,missing_waybills:[],message:"",loading:!1}),rt=async a=>{o.value=a,ue.value=!0,b.value.loading=!0;try{const d=await(await fetch(route("cargo-assignments.dispatch.driver-truck-set.validate",a.id))).json();b.value={can_dispatch:d.can_dispatch,has_manifest:d.has_manifest,missing_waybills:d.missing_waybills||[],message:d.message||"",loading:!1}}catch{h.error("Failed to validate dispatch"),b.value.loading=!1}},De=()=>{ue.value=!1,b.value={can_dispatch:!1,has_manifest:!1,missing_waybills:[],message:"",loading:!1}},it=()=>{o.value&&(K.value=o.value.id,R.post(route("cargo-assignments.dispatch.driver-truck-set",o.value.id),{},{preserveScroll:!0,onSuccess:()=>{h.success("Driver-truck set dispatched successfully"),De(),K.value=null,be()},onError:a=>{h.error("Failed to dispatch driver-truck set"),K.value=null}}))},Ce=w(!1),ot=()=>{Ce.value=!1},re=S(()=>{if(!D.estimated_departure)return null;const a=new Date(D.estimated_departure);return a.setDate(a.getDate()+2),a}),nt=S(()=>new Date().toISOString().slice(0,16)),Ve=S(()=>{const a=new Date(D.estimated_departure),t=new Date;return t.setDate(t.getDate()+1),a.toDateString()===t.toDateString()?"Default departure time set to tomorrow":null});return(a,t)=>(r(),ve(mt,null,{header:y(()=>[e("div",Dt,[t[6]||(t[6]=e("h2",{class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},"Cargo Assignment Dashboard",-1)),e("div",Ct,[v(xt,{modelValue:U.value,"onUpdate:modelValue":t[0]||(t[0]=d=>U.value=d),placeholder:"Search deliveries...",class:"w-64",onSearch:M(de)},null,8,["modelValue","onSearch"]),v(pe,{onClick:be,class:"inline-flex items-center"},{default:y(()=>t[5]||(t[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),C(" Refresh ")])),_:1})])])]),default:y(()=>{var d,n,c,j,E,I,F,T,N,Q;return[Ye.value?(r(),i("div",Vt,[v(ht,{flash:g.flash},null,8,["flash"])])):p("",!0),e("div",Mt,[e("div",Ft,[e("div",Tt,[v(Ee,{modelValue:L.value,"onUpdate:modelValue":t[1]||(t[1]=s=>L.value=s),options:Re,placeholder:"Filter by status",class:"flex-1 min-w-0"},null,8,["modelValue"]),v(Ee,{modelValue:Y.value,"onUpdate:modelValue":t[2]||(t[2]=s=>Y.value=s),options:Ue.value,placeholder:"Filter by region",class:"flex-1 min-w-0"},null,8,["modelValue","options"])]),v(pe,{onClick:Qe,size:"sm"},{default:y(()=>t[7]||(t[7]=[C(" Clear Filters ")])),_:1})])]),e("div",Nt,[e("div",zt,[e("div",$t,[t[8]||(t[8]=e("h3",{class:"font-medium text-gray-900 dark:text-gray-100"}," Delivery Orders ",-1)),e("div",qt," Showing "+l(((d=k.value)==null?void 0:d.from)??0)+" to "+l(((n=k.value)==null?void 0:n.to)??0)+" of "+l(((c=k.value)==null?void 0:c.total)??0)+" entries ",1)]),v(ft,{columns:Le,data:((j=k.value)==null?void 0:j.data)??[],loading:P.value,selectable:"",onSelectionChange:Ge},{status:y(({row:s})=>[v(bt,{status:s.status,class:O(st(s.status))},{default:y(()=>[C(l(at(s.status)),1)]),_:2},1032,["status","class"])]),packages:y(({row:s})=>{var u,A;return[e("div",Wt,[e("span",null,l(((A=(u=s.delivery_request)==null?void 0:u.packages)==null?void 0:A.length)??0),1),se(s)?(r(),i("span",Bt,t[9]||(t[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]))):p("",!0)])]}),actions:y(({row:s})=>[e("div",Ot,[v(pe,{onClick:ge(u=>Ze(s.id),["stop"]),size:"xs",title:"Details"},{default:y(()=>t[10]||(t[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)])),_:2},1032,["onClick"]),s.status!=="completed"&&s.status!=="cancelled"?(r(),ve(pt,{key:0,onClick:ge(u=>et(s),["stop"]),size:"xs",title:"Cancel"},{default:y(()=>t[11]||(t[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)])),_:2},1032,["onClick"])):p("",!0)])]),_:1},8,["data","loading"]),((E=k.value)==null?void 0:E.last_page)>1?(r(),ve(yt,{key:0,pagination:k.value,onPageChanged:Xe},null,8,["pagination"])):p("",!0)]),e("div",Et,[e("div",It,[e("div",Pt,[e("div",jt,[e("div",Ht,[e("h3",Rt," Selected Deliveries ("+l(((I=m.value)==null?void 0:I.length)??0)+") ",1),((F=m.value)==null?void 0:F.length)>0?(r(),i("button",{key:0,onClick:Ke,class:"text-xs text-red-500 hover:text-red-700"}," Clear All ")):p("",!0)])]),e("div",Ut,[((T=m.value)==null?void 0:T.length)>0?(r(!0),i(W,{key:0},B(m.value,s=>{var u,A,z,x,$,q,H,X;return r(),i("div",{key:s.id,class:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50"},[e("div",Lt,[e("div",null,[e("p",Yt," DO-"+l((A=(u=s.id)==null?void 0:u.toString())==null?void 0:A.padStart(6,"0")),1),e("p",Gt,l(((x=(z=s.delivery_request)==null?void 0:z.pick_up_region)==null?void 0:x.name)??"N/A")+" → "+l(((q=($=s.delivery_request)==null?void 0:$.drop_off_region)==null?void 0:q.name)??"N/A"),1),e("div",Jt,[e("p",null,"Volume: "+l(M(_e)(((H=s.delivery_request)==null?void 0:H.packages)??[]))+" m³",1),e("p",null,"Weight: "+l(M(he)(((X=s.delivery_request)==null?void 0:X.packages)??[]))+" kg",1),se(s)?(r(),i("p",Kt,t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1),C(" Missing stickers ")]))):p("",!0)])]),e("button",{onClick:ce=>Je(s.id),class:"text-red-500 hover:text-red-700",title:"Remove"},t[13]||(t[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]),8,Qt)])])}),128)):(r(),i("div",Xt," No deliveries selected "))]),((N=m.value)==null?void 0:N.length)>0?(r(),i("div",Zt,[e("div",es,[t[14]||(t[14]=e("p",{class:"font-medium"},"Total Selected:",-1)),e("p",null,"Volume: "+l(G.value)+" m³",1),e("p",null,"Weight: "+l(J.value)+" kg",1),ne.value?(r(),i("p",ts," ⚠️ Some packages are missing stickers ")):p("",!0)]),v(me,{class:"mt-4 w-full",disabled:!o.value||!m.value.length||ne.value,onClick:we},{default:y(()=>t[15]||(t[15]=[C(" Assign Selected ")])),_:1},8,["disabled"])])):p("",!0)])]),e("div",ss,[e("div",as,[t[20]||(t[20]=e("div",{class:"p-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-700"},[e("h3",{class:"font-medium text-gray-900 dark:text-gray-100"}," Available Driver-Truck Sets ")],-1)),e("div",ls,[e("div",rs,[((Q=V.value)==null?void 0:Q.length)>0?(r(!0),i(W,{key:0},B(V.value,s=>{var u,A,z,x,$,q,H,X,ce,Ne,ze,$e,qe,We,Be;return r(),i("div",{key:s.id,class:O(["border rounded-lg p-4 hover:border-blue-500 transition-colors cursor-pointer",{"border-blue-500 bg-blue-50 dark:bg-blue-900/20":((u=o.value)==null?void 0:u.id)===s.id,"opacity-50 cursor-not-allowed":!s.is_available,"cursor-pointer":s.is_available}]),onClick:Z=>s.is_available&&ye(s)},[e("div",os,[e("div",ns,[e("div",ds,[e("div",us,[e("span",cs,l(((A=s.driver)==null?void 0:A.initials)??""),1)]),e("div",null,[e("p",vs,l(((z=s.driver)==null?void 0:z.name)??"N/A"),1),e("p",gs,l(((x=s.driver)==null?void 0:x.employee_id)??""),1)])]),e("div",ms,[e("p",null,"Current Assignments: "+l((($=s.driver)==null?void 0:$.current_assignments)??0),1),e("p",null,[t[16]||(t[16]=C("Available: ")),e("span",{class:O((q=s.driver)!=null&&q.canAcceptNewAssignment?"text-green-600":"text-red-600")},l((H=s.driver)!=null&&H.canAcceptNewAssignment?"Yes":"No"),3)])])]),e("div",ps,[e("div",_s,[t[17]||(t[17]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-indigo-500",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1 1 0 11-3 0 1 1 0 013 0z"}),e("path",{d:"M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1v-1a1 1 0 011-1h2a1 1 0 011 1v1a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H19a1 1 0 001-1V5a1 1 0 00-1-1H3z"})],-1)),e("div",null,[e("p",hs,l(((X=s.truck)==null?void 0:X.license_plate)??"N/A"),1),e("p",fs,l(((ce=s.truck)==null?void 0:ce.make)??"")+" "+l(((Ne=s.truck)==null?void 0:Ne.model)??""),1)])]),e("div",ys,[e("div",null,[e("p",bs,"Volume: "+l((s.current_volume??0).toFixed(2))+" / "+l(((ze=s.truck)==null?void 0:ze.volume_capacity)??0)+" m³",1),e("div",xs,[e("div",{class:"bg-blue-600 h-1.5 rounded-full",style:Oe({width:`${Math.min(100,(s.current_volume??0)/((($e=s.truck)==null?void 0:$e.volume_capacity)||1)*100)}%`})},null,4)])]),e("div",null,[e("p",ks,"Weight: "+l((s.current_weight??0).toFixed(2))+" / "+l(((qe=s.truck)==null?void 0:qe.weight_capacity)??0)+" kg",1),e("div",ws,[e("div",{class:"bg-green-600 h-1.5 rounded-full",style:Oe({width:`${Math.min(100,(s.current_weight??0)/(((We=s.truck)==null?void 0:We.weight_capacity)||1)*100)}%`})},null,4)])])])])]),((Be=s.active_orders)==null?void 0:Be.length)>0?(r(),i("div",Ss,[t[18]||(t[18]=e("p",{class:"text-xs font-medium mb-1"},"Current Trips:",-1)),(r(!0),i(W,null,B(s.active_orders,Z=>(r(),i("div",{key:Z.id,class:"text-xs"},[e("p",null,"DO-"+l(Z.id)+": "+l(Z.status),1)]))),128))])):p("",!0),v(me,{class:"mt-4 w-full",disabled:!s.is_available||K.value===s.id,onClick:ge(Z=>rt(s),["stop"])},{default:y(()=>[K.value===s.id?(r(),i("span",As,[v(Ie,{size:"xs",class:"mr-2"}),t[19]||(t[19]=C(" Dispatching... "))])):(r(),i("span",Ds," Dispatch "))]),_:2},1032,["disabled","onClick"])],10,is)}),128)):(r(),i("div",Cs," No available driver-truck sets found "))])])])])])]),e("div",Vs,[t[22]||(t[22]=e("div",{class:"p-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-700"},[e("h3",{class:"font-medium text-gray-900 dark:text-gray-100"}," Batch Assignment Suggestions ")],-1)),e("div",Ms,[ke.value.length>0?(r(),i("div",Fs,[(r(!0),i(W,null,B(ke.value,s=>{var u,A,z;return r(),i("div",{key:s.destination_region.id,class:"border rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50"},[e("div",Ts,[e("div",null,[e("p",Ns," From: "+l(((u=s.pickup_region)==null?void 0:u.name)??"N/A")+" → To: "+l(s.destination_region.name),1),e("p",zs,l(s.delivery_requests.length)+" deliveries ",1),e("p",$s," Total Volume: "+l(s.total_volume.toFixed(2))+" m³ | Total Weight: "+l(s.total_weight.toFixed(2))+" kg ",1),fe(s)?(r(),i("p",qs," ⚠️ Some deliveries have packages without stickers ")):p("",!0)]),v(me,{size:"sm",onClick:x=>lt(s),disabled:!ae(s).length||fe(s)},{default:y(()=>t[21]||(t[21]=[C(" Assign Batch ")])),_:2},1032,["onClick","disabled"])]),ae(s).length?(r(),i("div",Ws,[e("p",Bs,"Suitable Driver-Truck Sets (Region: "+l(((A=s.pickup_region)==null?void 0:A.name)??"N/A")+"):",1),e("div",Os,[(r(!0),i(W,null,B(ae(s),x=>{var $,q;return r(),i("div",{key:x.id,class:O(["p-2 border rounded cursor-pointer",{"border-blue-500":(($=o.value)==null?void 0:$.id)===x.id}]),onClick:H=>ye(x)},[e("p",Is,l(x.driver.name),1),e("p",Ps,l(x.truck.license_plate),1),e("p",js,"Available: "+l(x.available_volume.toFixed(2))+"m³ "+l(x.available_weight.toFixed(2))+"kg",1),e("p",Hs,"Region: "+l(((q=x.region)==null?void 0:q.name)??"N/A"),1)],10,Es)}),128))])])):(r(),i("div",Rs," No suitable driver-truck sets available in region: "+l(((z=s.pickup_region)==null?void 0:z.name)??"N/A"),1))])}),128))])):(r(),i("div",Us," No batch assignment suggestions available "))])]),v(ie,{show:le.value,onClose:Se,onConfirmed:Ae,title:"Confirm Assignment","confirm-text":"Confirm Assignment","confirm-disabled":!_.value.isValid},{default:y(()=>[e("div",Ls,[e("div",{class:O(["p-4 rounded-lg",{"bg-green-50 text-green-800":_.value.isValid,"bg-red-50 text-red-800":!_.value.isValid}])},[e("p",Ys,l(_.value.message),1),_.value.details?(r(),i("ul",Gs,[(r(!0),i(W,null,B(_.value.details,s=>(r(),i("li",{key:s},l(s),1))),128))])):p("",!0),_.value.etaWarning?(r(),i("div",Js," ⚠️ "+l(_.value.etaWarning),1)):p("",!0)],2),e("div",Ks,[e("div",null,[t[23]||(t[23]=e("p",{class:"text-sm font-medium"},"Total Selected Volume",-1)),e("p",Qs,l(G.value)+" m³",1),e("p",Xs,"Available: "+l(_.value.availableVolume.toFixed(2))+" m³",1)]),e("div",null,[t[24]||(t[24]=e("p",{class:"text-sm font-medium"},"Total Selected Weight",-1)),e("p",Zs,l(J.value)+" kg",1),e("p",ea,"Available: "+l(_.value.availableWeight.toFixed(2))+" kg",1)])]),e("div",ta,[v(He,{value:"Estimated Departure Time"}),v(je,{modelValue:M(D).estimated_departure,"onUpdate:modelValue":t[3]||(t[3]=s=>M(D).estimated_departure=s),class:"w-full",min:nt.value},null,8,["modelValue","min"]),Ve.value?(r(),i("div",sa,l(Ve.value),1)):p("",!0)]),re.value?(r(),i("div",aa,[e("p",null,"Estimated Arrival: "+l(M(Pe)(re.value)),1)])):p("",!0)])]),_:1},8,["show","confirm-disabled"]),v(ie,{show:oe.value,onClose:xe,onConfirmed:tt,title:"Cancel Assignment","confirm-text":"Yes, Cancel","confirm-variant":"danger"},{default:y(()=>t[25]||(t[25]=[e("p",null,"Are you sure you want to cancel this assignment?",-1),e("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},"This action cannot be undone.",-1)])),_:1},8,["show"]),v(ie,{show:Ce.value,onClose:ot,onConfirmed:Ae,title:"Assignment Validation","confirm-text":"Confirm Assignment","confirm-disabled":!_.value.isValid},{default:y(()=>{var s;return[_.value.value?(r(),i("div",la,[e("div",ra,[e("div",{class:O(["p-4 rounded-lg",{"bg-green-50 text-green-800":_.value.value.isValid,"bg-red-50 text-red-800":!_.value.value.isValid}])},[e("p",ia,l(_.value.value.message),1),_.value.value.details?(r(),i("ul",oa,[(r(!0),i(W,null,B(_.value.value.details,u=>(r(),i("li",{key:u},l(u),1))),128))])):p("",!0)],2),e("div",na,[e("div",null,[t[26]||(t[26]=e("p",{class:"text-sm font-medium"},"Total Selected Volume",-1)),e("p",da,l(G.value)+" m³",1),e("p",ua,"Available: "+l(_.value.value.availableVolume.toFixed(2))+" m³",1)]),e("div",null,[t[27]||(t[27]=e("p",{class:"text-sm font-medium"},"Total Selected Weight",-1)),e("p",ca,l(J.value)+" kg",1),e("p",va,"Available: "+l(_.value.value.availableWeight.toFixed(2))+" kg",1)])]),o.value?(r(),i("div",ga,[t[28]||(t[28]=e("p",{class:"text-sm font-medium"},"Driver Status",-1)),e("p",ma,[e("span",{class:O(["inline-block w-2 h-2 rounded-full mr-2",{"bg-green-500":o.value.driver.available,"bg-red-500":!o.value.driver.available}])},null,2),C(" "+l(o.value.driver.available?"Available":"Unavailable"),1)]),e("p",pa,"Current assignments: "+l(o.value.driver.current_assignments),1)])):p("",!0),o.value&&((s=o.value.active_orders)!=null&&s.length)?(r(),i("div",_a,[t[29]||(t[29]=e("p",{class:"text-sm font-medium"},"Current Trips",-1)),(r(!0),i(W,null,B(o.value.active_orders,u=>(r(),i("div",{key:u.id,class:"text-xs"}," DO-"+l(u.id)+": "+l(u.status),1))),128))])):p("",!0),v(je,{modelValue:M(D).estimated_departure,"onUpdate:modelValue":t[4]||(t[4]=u=>M(D).estimated_departure=u),label:"Estimated Departure",class:"mt-4"},null,8,["modelValue"]),re.value?(r(),i("div",ha,[e("p",null,"Estimated Arrival: "+l(M(Pe)(re.value)),1)])):p("",!0)])])):p("",!0)]}),_:1},8,["show","confirm-disabled"]),v(ie,{show:ue.value,onClose:De,onConfirmed:it,title:"Dispatch Driver-Truck Set","confirm-text":"Confirm Dispatch","confirm-disabled":!b.value.can_dispatch||b.value.loading},{default:y(()=>{var s;return[e("div",fa,[b.value.loading?(r(),i("div",ya,[v(Ie,{size:"sm"}),t[30]||(t[30]=e("span",null,"Validating manifest and waybills...",-1))])):(r(),i("div",ba,[b.value.can_dispatch?(r(),i("div",xa,t[31]||(t[31]=[e("p",null,"All checks passed. Ready to dispatch this set.",-1)]))):(r(),i("div",ka,[b.value.has_manifest?p("",!0):(r(),i("p",wa," Missing Manifest: Manifest must be created and finalized. ")),(s=b.value.missing_waybills)!=null&&s.length?(r(),i("p",Sa,[t[32]||(t[32]=C(" Missing waybills: ")),e("span",null,l(b.value.missing_waybills.map(u=>`DO-${u.toString().padStart(6,"0")}`).join(", ")),1)])):p("",!0),b.value.message&&!b.value.can_dispatch&&b.value.has_manifest?(r(),i("p",Aa,l(b.value.message),1)):p("",!0)]))]))])]}),_:1},8,["show","confirm-disabled"])]}),_:1}))}},Ya=_t(Da,[["__scopeId","data-v-86de00b7"]]);export{Ya as default};
