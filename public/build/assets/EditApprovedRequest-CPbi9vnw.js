import{C as B,g as A,h as W,j as E,d as q,o as d,w as _,b as e,c,e as v,t as s,s as M,F as z,r as I,u,a as r,n as y,f as k,W as D}from"./app-BOCrhSfO.js";import{E as L}from"./EmployeeLayout-D01AghRc.js";import{_ as $}from"./PrimaryButton-7U4Qu6md.js";import{_ as O}from"./SecondaryButton-BoCxbQ9w.js";import{_ as F}from"./InputLabel-ByB8oFns.js";import{T as V}from"./TextInput-fgBIPllX.js";import{_ as C}from"./InputError-D12BKN4o.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./NavLink-DsrNUkqS.js";import"./DangerButton-CBhu99um.js";/* empty css                                                                  */const G={class:"flex justify-between items-center w-full px-6 md:px-8"},H={class:"text-xl font-semibold leading-tight text-gray-800"},X={class:"flex gap-2"},J={key:0},K={key:1},Q={class:"px-6 py-4"},Y={key:0,class:"mb-6"},Z={key:0,class:"p-4 bg-blue-100 text-blue-800 rounded"},ee={key:1,class:"p-4 bg-green-100 text-green-800 rounded"},te={key:2,class:"p-4 bg-red-100 text-red-800 rounded"},se={class:"bg-gray-50 border border-gray-200 rounded-lg p-6 mb-6"},ae={class:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm"},le={class:"text-gray-900 font-mono"},oe={class:"text-gray-900"},ie={class:"text-gray-900"},re={class:"text-gray-900 capitalize"},de={class:"text-gray-900"},ne={class:"bg-white shadow-sm rounded-lg p-6"},ce={class:"flex items-center justify-between"},ue={class:"text-md font-medium text-gray-900"},me={class:"text-sm text-gray-500"},ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-50 p-4 rounded-lg"},pe={class:"text-gray-900"},he={class:"text-gray-900 capitalize"},ve={key:0},_e={class:"text-gray-900"},xe={class:"text-gray-900"},fe={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ye={class:"text-xs text-gray-500 mt-1"},be={class:"text-xs text-gray-500 mt-1"},we={class:"text-xs text-gray-500 mt-1"},Fe={class:"text-xs text-gray-500 mt-1"},Ve={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Ce={class:"grid grid-cols-2 gap-4 text-sm"},je={class:"font-semibold text-blue-800"},ke={class:"font-semibold text-green-800"},Te={key:0,class:"bg-green-50 border border-green-200 rounded-lg p-4 mt-6"},Ue={class:"grid grid-cols-3 gap-4 text-sm"},Pe={class:"font-semibold text-green-800"},Se={class:"text-xs text-gray-500"},Ne={class:"font-semibold text-green-800"},Ae={class:"text-xs text-gray-500"},De={class:"mt-4 pt-4 border-t border-green-200"},$e={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-xs"},Oe={class:"font-semibold text-green-800"},Re={class:"font-semibold text-green-800"},Be={class:"font-semibold text-green-800"},We={class:"font-semibold text-green-800"},Ee={class:"mt-2 text-xs text-gray-600"},qe={class:"font-semibold"},Me={key:1,class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-6"},ze={class:"flex justify-end space-x-4 pt-6"},Ie={key:0},Le={key:1},Ge={key:2},lt={__name:"EditApprovedRequest",props:{delivery:Object,status:String,success:String,error:String,csrf_token:String},setup(i){var N;const p=i,o=B({_method:"PUT",packages:((N=p.delivery.packages)==null?void 0:N.map(a=>({id:a.id,item_name:a.item_name,description:a.description,category:a.category,length:parseFloat(a.length)||0,height:parseFloat(a.height)||0,width:parseFloat(a.width)||0,weight:parseFloat(a.weight)||0,value:parseFloat(a.value)||0,actual_length:parseFloat(a.actual_length)||parseFloat(a.length)||0,actual_height:parseFloat(a.actual_height)||parseFloat(a.height)||0,actual_width:parseFloat(a.actual_width)||parseFloat(a.width)||0,actual_weight:parseFloat(a.actual_weight)||parseFloat(a.weight)||0})))||[]}),n=A(null),x=A(!1),T=(a,t,g)=>(a*t*g/1e6).toFixed(4),R=a=>Math.abs(parseFloat(a).toFixed(2)),U=async()=>{if(!(!o.packages||o.packages.length===0)){x.value=!0;try{const a=await fetch(route("deliveries.calculate-approved-price"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":p.csrf_token,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({packages:o.packages.map(t=>({height:parseFloat(t.actual_height)||0,width:parseFloat(t.actual_width)||0,length:parseFloat(t.actual_length)||0,weight:parseFloat(t.actual_weight)||0})),original_total:p.delivery.total_price,delivery_id:p.delivery.id,processing_fee:200})});if(a.ok){const t=await a.json();if(t.success){const g=t.comparison,f=parseFloat(p.delivery.total_price)+200,b=parseFloat(g.adjusted_total)+200,w=g.adjusted_total-p.delivery.total_price;n.value={original_total:p.delivery.total_price,adjusted_total:g.adjusted_total,difference:w,breakdown:g.breakdown,original_gross:f,adjusted_gross:b,processing_fee:200}}else console.error("Price calculation failed:",t.error)}else console.error("Failed to calculate price - server error:",a.status)}catch(a){console.error("Error calculating price comparison:",a)}finally{x.value=!1}}},P=()=>{console.log("Saving changes with data:",o.packages);const a={_method:"PUT",packages:o.packages.map(t=>({id:t.id,actual_height:parseFloat(t.actual_height)||0,actual_width:parseFloat(t.actual_width)||0,actual_length:parseFloat(t.actual_length)||0,actual_weight:parseFloat(t.actual_weight)||0}))};console.log("Submit data:",a),o.put(route("deliveries.approved.update",p.delivery.id),a,{preserveScroll:!0,onSuccess:()=>{console.log("Update successful"),D.visit(route("deliveries.index"))},onError:t=>{console.log("Form errors:",t)},onFinish:()=>{console.log("Request finished")}})},S=()=>{D.visit(route("deliveries.index"))};let j=null;return W(()=>o.packages,()=>{j&&clearTimeout(j),j=setTimeout(()=>{U()},500)},{deep:!0}),E(()=>{setTimeout(()=>{U()},100)}),(a,t)=>(d(),q(L,null,{header:_(()=>[e("div",G,[e("div",null,[e("h2",H," Update Package Details - Request #DR-"+s(String(i.delivery.id).padStart(6,"0")),1),t[0]||(t[0]=e("p",{class:"mt-1 text-sm text-gray-500"}," Update package dimensions and weights for accurate pricing ",-1))]),e("div",X,[r(O,{onClick:S},{default:_(()=>t[1]||(t[1]=[k(" Cancel ")])),_:1}),r($,{onClick:P,disabled:u(o).processing},{default:_(()=>[u(o).processing?(d(),c("span",J,"Updating...")):(d(),c("span",K,"Update Packages"))]),_:1},8,["disabled"])])])]),default:_(()=>{var g,f,b,w;return[e("div",Q,[i.status||i.success||i.error?(d(),c("div",Y,[i.status?(d(),c("div",Z,s(i.status),1)):v("",!0),i.success?(d(),c("div",ee,s(i.success),1)):v("",!0),i.error?(d(),c("div",te,s(i.error),1)):v("",!0)])):v("",!0),e("div",se,[t[7]||(t[7]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Request Information (Read-only)",-1)),e("div",ae,[e("div",null,[t[2]||(t[2]=e("label",{class:"font-medium text-gray-700"},"Reference Number:",-1)),e("p",le,s(i.delivery.reference_number||"N/A"),1)]),e("div",null,[t[3]||(t[3]=e("label",{class:"font-medium text-gray-700"},"Sender:",-1)),e("p",oe,s(((g=i.delivery.sender)==null?void 0:g.name)||((f=i.delivery.sender)==null?void 0:f.company_name)),1)]),e("div",null,[t[4]||(t[4]=e("label",{class:"font-medium text-gray-700"},"Receiver:",-1)),e("p",ie,s(((b=i.delivery.receiver)==null?void 0:b.name)||((w=i.delivery.receiver)==null?void 0:w.company_name)),1)]),e("div",null,[t[5]||(t[5]=e("label",{class:"font-medium text-gray-700"},"Payment Method:",-1)),e("p",re,s(i.delivery.payment_method),1)]),e("div",null,[t[6]||(t[6]=e("label",{class:"font-medium text-gray-700"},"Original Total:",-1)),e("p",de,"₱"+s(i.delivery.total_price),1)])])]),e("form",{onSubmit:M(P,["prevent"]),class:"space-y-8"},[e("div",ne,[t[27]||(t[27]=e("div",{class:"flex justify-between items-center mb-4"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Package Details"),e("div",{class:"text-sm text-gray-500"}," Update package dimensions and weights as measured during handover ")],-1)),(d(!0),c(z,null,I(u(o).packages,(l,m)=>(d(),c("div",{key:m,class:"border border-gray-200 rounded-lg p-6 space-y-4 mb-6"},[e("div",ce,[e("h4",ue,"Package "+s(m+1),1),e("div",me," ID: "+s(l.id),1)]),e("div",ge,[e("div",null,[t[8]||(t[8]=e("label",{class:"font-medium text-gray-700 text-sm"},"Item Name:",-1)),e("p",pe,s(l.item_name),1)]),e("div",null,[t[9]||(t[9]=e("label",{class:"font-medium text-gray-700 text-sm"},"Category:",-1)),e("p",he,s(l.category),1)]),l.description?(d(),c("div",ve,[t[10]||(t[10]=e("label",{class:"font-medium text-gray-700 text-sm"},"Description:",-1)),e("p",_e,s(l.description),1)])):v("",!0),e("div",null,[t[11]||(t[11]=e("label",{class:"font-medium text-gray-700 text-sm"},"Declared Value:",-1)),e("p",xe,"₱"+s(l.value||"0.00"),1)])]),e("div",fe,[e("div",null,[r(F,{value:"Actual Length (cm) *"}),r(V,{modelValue:l.actual_length,"onUpdate:modelValue":h=>l.actual_length=h,type:"number",step:"0.1",min:"0.1",class:y(["mt-1 block w-full",{"border-red-500":u(o).errors[`packages.${m}.actual_length`]}]),placeholder:"0.0"},null,8,["modelValue","onUpdate:modelValue","class"]),e("p",ye,"Original: "+s(l.length)+" cm",1),r(C,{message:u(o).errors[`packages.${m}.actual_length`]},null,8,["message"])]),e("div",null,[r(F,{value:"Actual Height (cm) *"}),r(V,{modelValue:l.actual_height,"onUpdate:modelValue":h=>l.actual_height=h,type:"number",step:"0.1",min:"0.1",class:y(["mt-1 block w-full",{"border-red-500":u(o).errors[`packages.${m}.actual_height`]}]),placeholder:"0.0"},null,8,["modelValue","onUpdate:modelValue","class"]),e("p",be,"Original: "+s(l.height)+" cm",1),r(C,{message:u(o).errors[`packages.${m}.actual_height`]},null,8,["message"])]),e("div",null,[r(F,{value:"Actual Width (cm) *"}),r(V,{modelValue:l.actual_width,"onUpdate:modelValue":h=>l.actual_width=h,type:"number",step:"0.1",min:"0.1",class:y(["mt-1 block w-full",{"border-red-500":u(o).errors[`packages.${m}.actual_width`]}]),placeholder:"0.0"},null,8,["modelValue","onUpdate:modelValue","class"]),e("p",we,"Original: "+s(l.width)+" cm",1),r(C,{message:u(o).errors[`packages.${m}.actual_width`]},null,8,["message"])]),e("div",null,[r(F,{value:"Actual Weight (kg) *"}),r(V,{modelValue:l.actual_weight,"onUpdate:modelValue":h=>l.actual_weight=h,type:"number",step:"0.1",min:"0.1",class:y(["mt-1 block w-full",{"border-red-500":u(o).errors[`packages.${m}.actual_weight`]}]),placeholder:"0.0"},null,8,["modelValue","onUpdate:modelValue","class"]),e("p",Fe,"Original: "+s(l.weight)+" kg",1),r(C,{message:u(o).errors[`packages.${m}.actual_weight`]},null,8,["message"])])]),e("div",Ve,[t[14]||(t[14]=e("h5",{class:"font-medium text-blue-800 text-sm mb-2"},"Volume Comparison",-1)),e("div",Ce,[e("div",null,[t[12]||(t[12]=e("span",{class:"text-blue-600"},"Original Volume:",-1)),e("p",je,s(T(l.length,l.height,l.width))+" m³",1)]),e("div",null,[t[13]||(t[13]=e("span",{class:"text-green-600"},"Actual Volume:",-1)),e("p",ke,s(T(l.actual_length||l.length,l.actual_height||l.height,l.actual_width||l.width))+" m³",1)])])])]))),128)),n.value?(d(),c("div",Te,[t[24]||(t[24]=e("h4",{class:"text-md font-semibold text-green-800 mb-3"},"Price Adjustment",-1)),t[25]||(t[25]=e("div",{class:"bg-blue-50 border border-blue-200 rounded p-3 mb-4"},[e("p",{class:"text-sm text-blue-700"},[e("strong",null,"Note:"),k(" All prices shown are net amounts after ₱200 processing fee deduction ")])],-1)),e("div",Ue,[e("div",null,[t[15]||(t[15]=e("p",{class:"text-green-600"},"Original Total (Net)",-1)),e("p",Pe,"₱"+s(n.value.original_total),1),e("p",Se,"Gross: ₱"+s((parseFloat(n.value.original_total)+200).toFixed(2)),1)]),e("div",null,[t[16]||(t[16]=e("p",{class:"text-green-600"},"Adjusted Total (Net)",-1)),e("p",Ne,"₱"+s(n.value.adjusted_total.toFixed(2)),1),e("p",Ae,"Gross: ₱"+s((parseFloat(n.value.adjusted_total)+200).toFixed(2)),1)]),e("div",null,[t[17]||(t[17]=e("p",{class:"text-green-600"},"Net Difference",-1)),e("p",{class:y([n.value.difference>=0?"text-red-600":"text-blue-600","font-semibold"])},s(n.value.difference>=0?"+":"")+"₱"+s(R(n.value.difference)),3)])]),e("div",De,[t[23]||(t[23]=e("h5",{class:"font-medium text-green-800 text-sm mb-2"},"Detailed Breakdown (Gross Amounts)",-1)),e("div",$e,[e("div",null,[t[18]||(t[18]=e("p",{class:"text-green-600"},"Base Fee",-1)),e("p",Oe,"₱"+s(n.value.breakdown.base_fee),1)]),e("div",null,[t[19]||(t[19]=e("p",{class:"text-green-600"},"Volume Fee",-1)),e("p",Re,"₱"+s(n.value.breakdown.volume_fee),1)]),e("div",null,[t[20]||(t[20]=e("p",{class:"text-green-600"},"Weight Fee",-1)),e("p",Be,"₱"+s(n.value.breakdown.weight_fee),1)]),e("div",null,[t[21]||(t[21]=e("p",{class:"text-green-600"},"Package Fee",-1)),e("p",We,"₱"+s(n.value.breakdown.package_fee),1)])]),e("div",Ee,[t[22]||(t[22]=e("p",null,"Processing Fee: -₱200.00",-1)),e("p",qe,"Net Total: ₱"+s(n.value.adjusted_total.toFixed(2)),1)])])])):v("",!0),x.value?(d(),c("div",Me,t[26]||(t[26]=[e("div",{class:"flex items-center justify-center"},[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-yellow-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),e("span",{class:"text-yellow-700"},"Calculating price adjustment...")],-1)]))):v("",!0)]),e("div",ze,[r(O,{onClick:S,type:"button"},{default:_(()=>t[28]||(t[28]=[k(" Cancel ")])),_:1}),r($,{type:"submit",disabled:u(o).processing||x.value},{default:_(()=>[u(o).processing?(d(),c("span",Ie,"Updating Packages...")):x.value?(d(),c("span",Le,"Calculating...")):(d(),c("span",Ge,"Update Packages & Pricing"))]),_:1},8,["disabled"])])],32)])]}),_:1}))}};export{lt as default};
